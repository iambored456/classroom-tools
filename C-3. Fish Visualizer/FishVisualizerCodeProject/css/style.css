body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f0f0f0;
    overflow: hidden;
}

/* --- Main Layout --- */
#main-container {
    display: flex;
    width: 100vw;
    height: 100vh;
}

/* --- SIDEBAR STYLES --- */
#sidebar {
    width: 380px;
    flex-shrink: 0;
    background-color: #f8f9fa;
    border-right: 1px solid #dee2e6;
    height: 100vh;
    display: flex;
    flex-direction: column;
}

.sidebar-content {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    min-height: 0; /* Important for flex overflow */
}

.sidebar-section {
    display: flex;
    flex-direction: column;
    border-bottom: 1px solid #ccc;
    min-height: 0; /* Important for flex overflow */
}

.sidebar-section[open] {
    flex-grow: 1; /* Open sections will grow to fill available space */
}

.sidebar-section > summary {
    padding: 12px 15px;
    font-weight: bold;
    cursor: pointer;
    background-color: #e9ecef;
    outline: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.sidebar-section > summary:hover {
    background-color: #dde2e6;
}

.sidebar-list {
    flex-grow: 1;
    overflow-y: auto; /* This will now correctly add a scrollbar when needed */
    background-color: #fff;
    padding: 0;
    min-height: 0; /* <<< *** THIS IS THE FIX! *** */
}

/* --- END OF SIDEBAR FIX --- */


.list-item {
    display: flex;
    align-items: center;
    padding: 6px 15px 6px 40px;
    font-size: 0.9em;
    cursor: pointer;
    border-bottom: 1px solid #f0f0f0;
}
.list-item:hover {
    background-color: #e0f0ff;
}
.list-item label {
    display: flex;
    align-items: center;
    cursor: pointer;
    width: 100%;
}
.list-item input[type="checkbox"] {
    margin-right: 10px;
}
.list-item .code {
    font-weight: bold;
    min-width: 70px;
    color: #333;
}
.list-item .skill {
    color: #555;
}

#graph-container {
    position: relative; 
    flex-grow: 1; 
    height: 100vh;
}

/* --- Graph Styles --- */
svg {
    width: 100%;
    height: 100%;
    cursor: grab;
}
svg:active {
    cursor: grabbing;
}
.link {
    stroke: #999;
    stroke-opacity: 0.6;
    stroke-width: 1.5px;
    transition: stroke 0.2s, stroke-opacity 0.2s;
}
.node circle {
    stroke-width: 1.5px;
    cursor: pointer;
    transition: all 0.2s;
}
.node:hover circle {
    stroke: #000;
}
.node-label {
    font-weight: bold;
    fill: #333;
    text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
    pointer-events: none;
}

/* --- UI Panels --- */
#info-panel, #legend, #controls {
    position: absolute;
    background-color: rgba(255, 255, 255, 0.9);
    padding: 10px 15px;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
#info-panel { top: 10px; left: 10px; max-width: 300px; font-size: 0.9em; }
#info-panel h2 { margin: 0 0 5px 0; font-size: 1.2em; }
#legend { top: 10px; right: 10px; }
#controls { bottom: 10px; left: 10px; display: flex; flex-direction: column; gap: 15px; }

/* ... (other existing styles for legend, controls, etc. remain the same) ... */
.legend-item { display: flex; align-items: center; margin-bottom: 4px; font-size: 0.9em; }
.legend-color { width: 15px; height: 15px; margin-right: 8px; border-radius: 50%; border: 1px solid #ccc; }
.search-group { width: 100%; }
#search-input { flex-grow: 1; padding: 6px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.9em; }
.shake { animation: shake 0.5s; }
@keyframes shake {
    10%, 90% { transform: translate3d(-1px, 0, 0); }
    20%, 80% { transform: translate3d(2px, 0, 0); }
    30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
    40%, 60% { transform: translate3d(4px, 0, 0); }
}
.control-group { display: flex; gap: 10px; align-items: center; }
.control-group.sliders { flex-direction: column; gap: 8px; align-items: flex-start; }
.slider-container { display: flex; align-items: center; gap: 8px; width: 280px; }
.slider-container label { min-width: 110px; font-size: 0.9em; }
.slider-container input[type="range"] { flex-grow: 1; }
.value-display { min-width: 35px; font-size: 0.9em; font-family: monospace; text-align: right; }
#controls button { font-family: inherit; font-size: 0.9em; padding: 5px 10px; border: 1px solid #ccc; border-radius: 4px; background-color: #f7f7f7; cursor: pointer; }
#controls button:hover { background-color: #e9e9e9; border-color: #999; }

/* --- Highlight & Interaction Styles --- */
#selection-box {
    fill: rgba(0, 123, 255, 0.2);
    stroke: #007bff;
    stroke-width: 1px;
    stroke-dasharray: 4 2;
}

.node.greyed-out circle {
    fill-opacity: 0.1;
    stroke-opacity: 0.2;
}
.link.greyed-out {
    stroke-opacity: 0.05;
}

.node.selected circle { stroke: #007bff; stroke-width: 3px; }
.node.neighbor circle { stroke: #ff9900; stroke-width: 3px; }
.node.primary-selection circle { stroke: #d9534f; stroke-width: 4px; }
.link.highlighted { stroke: #d9534f; stroke-opacity: 1; }
.link.selection-highlighted { stroke: #28a745; stroke-opacity: 0.9; }


/* --- STYLES FOR NESTED LISTS & TOOLTIP --- */
.category-group {
    border-bottom: 1px solid #e0e0e0;
}
.category-group:last-child {
    border-bottom: none;
}
.category-group > summary {
    font-weight: bold;
    font-size: 0.95em;
    padding: 8px 10px 8px 20px;
    cursor: pointer;
    background-color: #fdfdfd;
    display: flex; 
    justify-content: space-between;
    align-items: center;
}
.category-group > summary:hover {
    background-color: #f0f0f0;
}
.category-group[open] {
    flex-grow: 1;
}
.category-group .sidebar-list {
    padding-left: 20px;
}

#tooltip {
    position: absolute;
    display: none;
    background-color: rgba(0, 0, 0, 0.8);
    color: #fff;
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 0.9em;
    pointer-events: none;
    max-width: 300px;
    line-height: 1.4;
    z-index: 10;
}
#tooltip .code {
    font-weight: bold;
    margin-bottom: 4px;
}

.sort-button {
    font-size: 0.8em;
    font-weight: normal;
    padding: 3px 8px;
    border: 1px solid #ccc;
    border-radius: 12px;
    background-color: #fff;
    cursor: pointer;
}
.sort-button:hover {
    background-color: #e0f0ff;
    border-color: #999;
}