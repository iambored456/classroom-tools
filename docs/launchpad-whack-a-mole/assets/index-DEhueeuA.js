(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))v(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&v(s)}).observe(document,{childList:!0,subtree:!0});function f(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function v(r){if(r.ep)return;r.ep=!0;const o=f(r);fetch(r.href,o)}})();document.addEventListener("DOMContentLoaded",()=>{const g=document.getElementById("connect-button"),i=document.getElementById("midi-output"),f=document.getElementById("status"),v=document.getElementById("grid"),r=document.getElementById("score-display"),o=document.getElementById("timer-select"),s=document.getElementById("start-button"),d=document.getElementById("reset-button"),b=document.getElementById("timer-display");let u=null;const m=[],N=11,K=88,O=10,A=[{hex:"#f090ae",velocity:10},{hex:"#f59383",velocity:20},{hex:"#ea9e5e",velocity:30},{hex:"#d0ae4e",velocity:40},{hex:"#a8bd61",velocity:50},{hex:"#76c788",velocity:60},{hex:"#41cbb5",velocity:70},{hex:"#33c6dc",velocity:80},{hex:"#62bbf7",velocity:90},{hex:"#94adff",velocity:100},{hex:"#bea0f3",velocity:110},{hex:"#dd95d6",velocity:120}];for(let e=7;e>=0;e--)for(let t=0;t<8;t++){const n=N+e*O+t;n<=K&&m.push(n)}m.forEach(e=>{const t=document.createElement("div");t.classList.add("square"),t.dataset.note=String(e),v.appendChild(t)});function $(e){const t=Array.from(e.outputs.values());i.innerHTML="",t.forEach((n,a)=>{const l=document.createElement("option");l.value=String(a),l.text=`${n.name} (${n.manufacturer})`,i.appendChild(l)}),t.length>0?(i.selectedIndex=0,u=t[0],f.innerText=`Connected to: ${u.name}`,B(),setTimeout(()=>{p(),M()},500)):f.innerText="No MIDI Output Devices Found."}function T(e){if(u)try{u.send(new Uint8Array(e))}catch(t){console.error("Failed to send MIDI message:",t),alert("Failed to send MIDI message. Ensure SysEx access is enabled.")}}function B(){T([240,0,32,41,2,12,14,1,247])}function p(){m.forEach(e=>x(e))}function L(e,t,n=1){T([n===2?145:n===3?146:144,e,t])}function x(e){T([128,e,0])}let y=null;function C(){y!==null&&(x(y),F(y));const e=m[Math.floor(Math.random()*m.length)];y=e;const t=P();L(e,t.velocity,1);const n=document.querySelector(`.square[data-note="${e}"]`);n&&(n.classList.add("active-web"),n.style.backgroundColor=t.hex)}function P(){return A[Math.floor(Math.random()*A.length)]}function F(e){const t=document.querySelector(`.square[data-note="${e}"]`);t&&(t.classList.remove("active-web"),t.style.backgroundColor="#333333")}function G(e){if(!e.data)return;const t=e.data[0],n=e.data[1],a=e.data[2];(t&240)===144&&a>0&&n===y&&(E(),x(n),F(n),C())}function U(){if(!navigator.requestMIDIAccess){alert("Web MIDI API is not supported in this browser.");return}navigator.requestMIDIAccess({sysex:!0}).then(e=>{$(e);for(const t of e.inputs.values())t.onmidimessage=G;e.onstatechange=t=>{const n=t.port;n&&(n.type==="input"&&n.state==="connected"&&(n.onmidimessage=G),n.type==="output"&&$(e))},B(),setTimeout(()=>{p(),M()},500)}).catch(e=>{console.error("Failed to get MIDI access",e),alert("Could not access your MIDI devices. Ensure SysEx access is enabled and the device is connected.")})}let h=0;function E(){h++,r.innerText=`Score: ${h}`}let c=null,I=0;function R(e){return e<10?"0"+e:String(e)}function W(){b.innerText=`Time: ${R(Math.floor(I/60))}:${R(I%60)}`}function j(){I--,W(),I<=0&&(clearInterval(c),z())}function M(){c&&(clearInterval(c),c=null),h=0,E(),b.innerText="Time: --:--",p(),C()}function k(){s.disabled=!0,d.disabled=!0,o.disabled=!0,Q().then(()=>{h=0,E(),I=parseInt(o.value,10),W(),c&&clearInterval(c),c=setInterval(j,1e3),C(),d.disabled=!1}).catch(e=>{console.error("Error during Launchpad countdown:",e),s.disabled=!1,d.disabled=!1,o.disabled=!1})}function z(){J(),s.disabled=!1,o.disabled=!1,d.disabled=!1}function J(){let e=0;const t=setInterval(()=>{m.forEach(n=>L(n,P().velocity,2)),++e>=20&&(clearInterval(t),p())},100)}function Q(){const e={5:[11,12,13,14,25,35,44,43,42,41,51,61,71,72,73,74,75,76],4:[14,24,34,44,35,36,33,32,31,41,51,61,71],3:[21,12,13,14,25,35,44,43,55,65,74,73,72,61],2:[11,12,13,14,15,21,32,43,54,65,74,73,72,61],1:[11,12,13,14,15,23,33,43,53,63,73,62,61]};function t(n){const a=String(n),l=parseInt(a.charAt(0),10)-1,D=parseInt(a.charAt(1),10)-1;return N+l*O+D}return new Promise((n,a)=>{let l=0;const D=[5,4,3,2,1];function H(){if(l>=D.length){n();return}const S=D[l],w=e[S];if(!w){a(`No pattern defined for digit ${S}`);return}w.forEach(q=>L(t(q),100,1)),b.innerText=`Get Ready: ${S}`,setTimeout(()=>{w.forEach(q=>x(t(q))),l++,H()},1e3)}H()})}function V(){c&&(clearInterval(c),c=null),h=0,E(),b.innerText="Time: 00:00",p(),s.disabled=!1,o.disabled=!1,d.disabled=!1,M()}g.addEventListener("click",()=>{U(),g.disabled=!0,g.innerText="MIDI Connected"}),i.addEventListener("change",()=>{const e=i.selectedIndex;navigator.requestMIDIAccess({sysex:!0}).then(t=>{const n=Array.from(t.outputs.values());e>=0&&e<n.length?(u=n[e],f.innerText=`Connected to: ${u.name}`,B(),setTimeout(()=>{p(),M()},500)):(u=null,f.innerText="Selected MIDI Output not found.")}).catch(t=>{console.error("Failed to get MIDI access during output change",t),alert("Could not access your MIDI devices. Ensure SysEx access is enabled and the device is connected.")})}),s.addEventListener("click",()=>{k(),s.disabled=!0,o.disabled=!0,d.disabled=!1}),d.addEventListener("click",V)});
