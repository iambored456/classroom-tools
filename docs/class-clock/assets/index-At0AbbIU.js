(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))M(l);new MutationObserver(l=>{for(const e of l)if(e.type==="childList")for(const r of e.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&M(r)}).observe(document,{childList:!0,subtree:!0});function p(l){const e={};return l.integrity&&(e.integrity=l.integrity),l.referrerPolicy&&(e.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?e.credentials="include":l.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function M(l){if(l.ep)return;l.ep=!0;const e=p(l);fetch(l.href,e)}})();function Le(){return{clockDisplayArea:document.getElementById("clock-display-area"),timeEl:document.getElementById("time"),dateEl:document.getElementById("date"),scheduleCirclesDisplayEl:document.getElementById("schedule-circles-display"),periodContainerEl:document.getElementById("period-container"),periodLabelEl:document.getElementById("period-label"),progressBarEl:document.getElementById("progress-bar"),progressEl:document.getElementById("progress"),timeLeftEl:document.getElementById("time-left"),sandBarsContainerEl:document.getElementById("sand-bars-container"),sandBarsCanvas:document.getElementById("sand-bars-canvas"),alertModal:document.getElementById("alert-modal"),alertModalTitle:document.getElementById("modal-title"),alertModalBody:document.getElementById("modal-body"),closeModalBtn:document.querySelector("#alert-modal .close-modal-btn"),menuToggle:document.getElementById("menu-toggle"),settingsMenu:document.getElementById("settings-menu"),menuResizer:document.getElementById("menu-resizer"),settingsNav:document.getElementById("settings-nav"),tabsContainer:document.getElementById("tabs"),tabContentsContainer:document.getElementById("tab-contents"),appearanceTab:document.getElementById("appearance-tab"),scheduleAlertsTab:document.getElementById("schedule-alerts-tab"),displayElementsChecklist:document.getElementById("display-elements-checklist"),fontSelect:document.getElementById("pref-font"),dateFontSizeInput:document.getElementById("pref-date-font"),timeFontSizeInput:document.getElementById("pref-time-font"),labelFontSizeInput:document.getElementById("pref-schedule-label-font"),timeLeftFontSizeInput:document.getElementById("pref-time-left-font"),progressHeightInput:document.getElementById("pref-progress-height"),resetAppearanceBtn:document.getElementById("reset-appearance-defaults"),resetSchemesBtn:document.getElementById("reset-schemes-defaults"),colorSchemeTabsContainer:document.getElementById("colour-scheme-tabs"),colorSchemeContentContainer:document.getElementById("colour-scheme-content"),scheduleTableBody:document.querySelector("#schedule-table tbody"),addScheduleRowBtn:document.getElementById("add-schedule-row"),deleteScheduleRowBtn:document.getElementById("delete-schedule-row"),timeSyncSection:document.getElementById("time-sync-section"),syncToBellBtn:document.getElementById("sync-to-bell"),offsetMinDownBtn:document.getElementById("offset-min-down"),offsetMinUpBtn:document.getElementById("offset-min-up"),offsetSecDownBtn:document.getElementById("offset-sec-down"),offsetSecUpBtn:document.getElementById("offset-sec-up"),resetOffsetBtn:document.getElementById("reset-offset"),currentOffsetDisplay:document.getElementById("current-offset")}}let T={};function Te(){T=Le(),console.log("DOM Cache Updated",T)}const J={getTodayTime:function(g){if(!g||!/^\d{2}:\d{2}$/.test(g)){const l=new Date;return l.setSeconds(0,0),l}const[y,p]=g.split(":").map(Number),M=new Date;return M.setHours(y,p,0,0),M},formatTime:function(g){let y=g.getHours();const p=g.getMinutes(),M=y>=12?"PM":"AM";return y=y%12||12,`${y}:${p<10?"0"+p:p} ${M}`},formatDate:function(g){const y={weekday:"long",month:"long",day:"numeric"};return g.toLocaleDateString(void 0,y)},showFeedback:function(g,y,p=!0){g&&(g.textContent=y,g.classList.remove("success","error"),g.classList.add(p?"success":"error"),g.style.display="block",setTimeout(()=>{g&&(g.style.display="none")},3e3))},showButtonFeedback:function(g,y="Saved!",p=1500){if(!g)return;const M=g.textContent;g.textContent=y,g.classList.add("button-success"),g.disabled=!0,setTimeout(()=>{g&&(g.textContent=M,g.classList.remove("button-success"),g.disabled=!1)},p)},lightenColor:function(g,y){if(!g||(g=g.replace(/^#/,""),g.length!==6))return"#cccccc";try{let p=parseInt(g.substring(0,2),16),M=parseInt(g.substring(2,4),16),l=parseInt(g.substring(4,6),16);p=Math.min(255,Math.floor(p*(1+y/100))),M=Math.min(255,Math.floor(M*(1+y/100))),l=Math.min(255,Math.floor(l*(1+y/100)));const e=p.toString(16).padStart(2,"0"),r=M.toString(16).padStart(2,"0"),s=l.toString(16).padStart(2,"0");return`#${e}${r}${s}`}catch(p){return console.error("Error lightening color:",g,p),"#cccccc"}}};function se(){const g=S.preferences&&S.preferences.timeOffsetMs?Number(S.preferences.timeOffsetMs):0,y=new Date;return new Date(y.getTime()+g)}const R={currentPeriodLabel:null,currentPeriodIndex:null,activeVisualAlertInterval:null,activeVisualAlertTimeout:null,originalBodyStyles:{},selectedScheduleRowIndex:null,isResizingMenu:!1,dragStartIndex:null,SAND_COLORS:["#fba1bd","#dfb37a","#8aca91","#54cce2","#b6b6fd"],physicsCheckIntervalId:null,physicsCheckIntervalMs:100,physicsParticlesAdded:0,totalParticlesForPeriod:0};var Ce=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function be(g){return g&&g.__esModule&&Object.prototype.hasOwnProperty.call(g,"default")?g.default:g}var ue={exports:{}};var Ae=ue.exports,we;function De(){return we||(we=1,(function(g,y){(function(M,l){g.exports=l()})(Ae,function(){return(function(p){var M={};function l(e){if(M[e])return M[e].exports;var r=M[e]={i:e,l:!1,exports:{}};return p[e].call(r.exports,r,r.exports,l),r.l=!0,r.exports}return l.m=p,l.c=M,l.d=function(e,r,s){l.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:s})},l.r=function(e){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,r){if(r&1&&(e=l(e)),r&8||r&4&&typeof e=="object"&&e&&e.__esModule)return e;var s=Object.create(null);if(l.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),r&2&&typeof e!="string")for(var i in e)l.d(s,i,(function(f){return e[f]}).bind(null,i));return s},l.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(r,"a",r),r},l.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},l.p="",l(l.s=20)})([(function(p,M){var l={};p.exports=l,(function(){l._baseDelta=1e3/60,l._nextId=0,l._seed=0,l._nowStartTime=+new Date,l._warnedOnce={},l._decomp=null,l.extend=function(r,s){var i,f;typeof s=="boolean"?(i=2,f=s):(i=1,f=!0);for(var c=i;c<arguments.length;c++){var d=arguments[c];if(d)for(var o in d)f&&d[o]&&d[o].constructor===Object&&(!r[o]||r[o].constructor===Object)?(r[o]=r[o]||{},l.extend(r[o],f,d[o])):r[o]=d[o]}return r},l.clone=function(r,s){return l.extend({},s,r)},l.keys=function(r){if(Object.keys)return Object.keys(r);var s=[];for(var i in r)s.push(i);return s},l.values=function(r){var s=[];if(Object.keys){for(var i=Object.keys(r),f=0;f<i.length;f++)s.push(r[i[f]]);return s}for(var c in r)s.push(r[c]);return s},l.get=function(r,s,i,f){s=s.split(".").slice(i,f);for(var c=0;c<s.length;c+=1)r=r[s[c]];return r},l.set=function(r,s,i,f,c){var d=s.split(".").slice(f,c);return l.get(r,s,0,-1)[d[d.length-1]]=i,i},l.shuffle=function(r){for(var s=r.length-1;s>0;s--){var i=Math.floor(l.random()*(s+1)),f=r[s];r[s]=r[i],r[i]=f}return r},l.choose=function(r){return r[Math.floor(l.random()*r.length)]},l.isElement=function(r){return typeof HTMLElement<"u"?r instanceof HTMLElement:!!(r&&r.nodeType&&r.nodeName)},l.isArray=function(r){return Object.prototype.toString.call(r)==="[object Array]"},l.isFunction=function(r){return typeof r=="function"},l.isPlainObject=function(r){return typeof r=="object"&&r.constructor===Object},l.isString=function(r){return toString.call(r)==="[object String]"},l.clamp=function(r,s,i){return r<s?s:r>i?i:r},l.sign=function(r){return r<0?-1:1},l.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-l._nowStartTime},l.random=function(r,s){return r=typeof r<"u"?r:0,s=typeof s<"u"?s:1,r+e()*(s-r)};var e=function(){return l._seed=(l._seed*9301+49297)%233280,l._seed/233280};l.colorToNumber=function(r){return r=r.replace("#",""),r.length==3&&(r=r.charAt(0)+r.charAt(0)+r.charAt(1)+r.charAt(1)+r.charAt(2)+r.charAt(2)),parseInt(r,16)},l.logLevel=1,l.log=function(){console&&l.logLevel>0&&l.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},l.info=function(){console&&l.logLevel>0&&l.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},l.warn=function(){console&&l.logLevel>0&&l.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},l.warnOnce=function(){var r=Array.prototype.slice.call(arguments).join(" ");l._warnedOnce[r]||(l.warn(r),l._warnedOnce[r]=!0)},l.deprecated=function(r,s,i){r[s]=l.chain(function(){l.warnOnce("ðŸ”… deprecated ðŸ”…",i)},r[s])},l.nextId=function(){return l._nextId++},l.indexOf=function(r,s){if(r.indexOf)return r.indexOf(s);for(var i=0;i<r.length;i++)if(r[i]===s)return i;return-1},l.map=function(r,s){if(r.map)return r.map(s);for(var i=[],f=0;f<r.length;f+=1)i.push(s(r[f]));return i},l.topologicalSort=function(r){var s=[],i=[],f=[];for(var c in r)!i[c]&&!f[c]&&l._topologicalSort(c,i,f,r,s);return s},l._topologicalSort=function(r,s,i,f,c){var d=f[r]||[];i[r]=!0;for(var o=0;o<d.length;o+=1){var t=d[o];i[t]||s[t]||l._topologicalSort(t,s,i,f,c)}i[r]=!1,s[r]=!0,c.push(r)},l.chain=function(){for(var r=[],s=0;s<arguments.length;s+=1){var i=arguments[s];i._chained?r.push.apply(r,i._chained):r.push(i)}var f=function(){for(var c,d=new Array(arguments.length),o=0,t=arguments.length;o<t;o++)d[o]=arguments[o];for(o=0;o<r.length;o+=1){var n=r[o].apply(c,d);typeof n<"u"&&(c=n)}return c};return f._chained=r,f},l.chainPathBefore=function(r,s,i){return l.set(r,s,l.chain(i,l.get(r,s)))},l.chainPathAfter=function(r,s,i){return l.set(r,s,l.chain(l.get(r,s),i))},l.setDecomp=function(r){l._decomp=r},l.getDecomp=function(){var r=l._decomp;try{!r&&typeof window<"u"&&(r=window.decomp),!r&&typeof Ce<"u"&&(r=Ce.decomp)}catch{r=null}return r}})()}),(function(p,M){var l={};p.exports=l,(function(){l.create=function(e){var r={min:{x:0,y:0},max:{x:0,y:0}};return e&&l.update(r,e),r},l.update=function(e,r,s){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var i=0;i<r.length;i++){var f=r[i];f.x>e.max.x&&(e.max.x=f.x),f.x<e.min.x&&(e.min.x=f.x),f.y>e.max.y&&(e.max.y=f.y),f.y<e.min.y&&(e.min.y=f.y)}s&&(s.x>0?e.max.x+=s.x:e.min.x+=s.x,s.y>0?e.max.y+=s.y:e.min.y+=s.y)},l.contains=function(e,r){return r.x>=e.min.x&&r.x<=e.max.x&&r.y>=e.min.y&&r.y<=e.max.y},l.overlaps=function(e,r){return e.min.x<=r.max.x&&e.max.x>=r.min.x&&e.max.y>=r.min.y&&e.min.y<=r.max.y},l.translate=function(e,r){e.min.x+=r.x,e.max.x+=r.x,e.min.y+=r.y,e.max.y+=r.y},l.shift=function(e,r){var s=e.max.x-e.min.x,i=e.max.y-e.min.y;e.min.x=r.x,e.max.x=r.x+s,e.min.y=r.y,e.max.y=r.y+i}})()}),(function(p,M){var l={};p.exports=l,(function(){l.create=function(e,r){return{x:e||0,y:r||0}},l.clone=function(e){return{x:e.x,y:e.y}},l.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},l.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},l.rotate=function(e,r,s){var i=Math.cos(r),f=Math.sin(r);s||(s={});var c=e.x*i-e.y*f;return s.y=e.x*f+e.y*i,s.x=c,s},l.rotateAbout=function(e,r,s,i){var f=Math.cos(r),c=Math.sin(r);i||(i={});var d=s.x+((e.x-s.x)*f-(e.y-s.y)*c);return i.y=s.y+((e.x-s.x)*c+(e.y-s.y)*f),i.x=d,i},l.normalise=function(e){var r=l.magnitude(e);return r===0?{x:0,y:0}:{x:e.x/r,y:e.y/r}},l.dot=function(e,r){return e.x*r.x+e.y*r.y},l.cross=function(e,r){return e.x*r.y-e.y*r.x},l.cross3=function(e,r,s){return(r.x-e.x)*(s.y-e.y)-(r.y-e.y)*(s.x-e.x)},l.add=function(e,r,s){return s||(s={}),s.x=e.x+r.x,s.y=e.y+r.y,s},l.sub=function(e,r,s){return s||(s={}),s.x=e.x-r.x,s.y=e.y-r.y,s},l.mult=function(e,r){return{x:e.x*r,y:e.y*r}},l.div=function(e,r){return{x:e.x/r,y:e.y/r}},l.perp=function(e,r){return r=r===!0?-1:1,{x:r*-e.y,y:r*e.x}},l.neg=function(e){return{x:-e.x,y:-e.y}},l.angle=function(e,r){return Math.atan2(r.y-e.y,r.x-e.x)},l._temp=[l.create(),l.create(),l.create(),l.create(),l.create(),l.create()]})()}),(function(p,M,l){var e={};p.exports=e;var r=l(2),s=l(0);(function(){e.create=function(i,f){for(var c=[],d=0;d<i.length;d++){var o=i[d],t={x:o.x,y:o.y,index:d,body:f,isInternal:!1};c.push(t)}return c},e.fromPath=function(i,f){var c=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,d=[];return i.replace(c,function(o,t,n){d.push({x:parseFloat(t),y:parseFloat(n)})}),e.create(d,f)},e.centre=function(i){for(var f=e.area(i,!0),c={x:0,y:0},d,o,t,n=0;n<i.length;n++)t=(n+1)%i.length,d=r.cross(i[n],i[t]),o=r.mult(r.add(i[n],i[t]),d),c=r.add(c,o);return r.div(c,6*f)},e.mean=function(i){for(var f={x:0,y:0},c=0;c<i.length;c++)f.x+=i[c].x,f.y+=i[c].y;return r.div(f,i.length)},e.area=function(i,f){for(var c=0,d=i.length-1,o=0;o<i.length;o++)c+=(i[d].x-i[o].x)*(i[d].y+i[o].y),d=o;return f?c/2:Math.abs(c)/2},e.inertia=function(i,f){for(var c=0,d=0,o=i,t,n,a=0;a<o.length;a++)n=(a+1)%o.length,t=Math.abs(r.cross(o[n],o[a])),c+=t*(r.dot(o[n],o[n])+r.dot(o[n],o[a])+r.dot(o[a],o[a])),d+=t;return f/6*(c/d)},e.translate=function(i,f,c){c=typeof c<"u"?c:1;var d=i.length,o=f.x*c,t=f.y*c,n;for(n=0;n<d;n++)i[n].x+=o,i[n].y+=t;return i},e.rotate=function(i,f,c){if(f!==0){var d=Math.cos(f),o=Math.sin(f),t=c.x,n=c.y,a=i.length,u,m,P,E;for(E=0;E<a;E++)u=i[E],m=u.x-t,P=u.y-n,u.x=t+(m*d-P*o),u.y=n+(m*o+P*d);return i}},e.contains=function(i,f){for(var c=f.x,d=f.y,o=i.length,t=i[o-1],n,a=0;a<o;a++){if(n=i[a],(c-t.x)*(n.y-t.y)+(d-t.y)*(t.x-n.x)>0)return!1;t=n}return!0},e.scale=function(i,f,c,d){if(f===1&&c===1)return i;d=d||e.centre(i);for(var o,t,n=0;n<i.length;n++)o=i[n],t=r.sub(o,d),i[n].x=d.x+t.x*f,i[n].y=d.y+t.y*c;return i},e.chamfer=function(i,f,c,d,o){typeof f=="number"?f=[f]:f=f||[8],c=typeof c<"u"?c:-1,d=d||2,o=o||14;for(var t=[],n=0;n<i.length;n++){var a=i[n-1>=0?n-1:i.length-1],u=i[n],m=i[(n+1)%i.length],P=f[n<f.length?n:f.length-1];if(P===0){t.push(u);continue}var E=r.normalise({x:u.y-a.y,y:a.x-u.x}),B=r.normalise({x:m.y-u.y,y:u.x-m.x}),h=Math.sqrt(2*Math.pow(P,2)),x=r.mult(s.clone(E),P),C=r.normalise(r.mult(r.add(E,B),.5)),v=r.sub(u,r.mult(C,h)),I=c;c===-1&&(I=Math.pow(P,.32)*1.75),I=s.clamp(I,d,o),I%2===1&&(I+=1);for(var w=Math.acos(r.dot(E,B)),b=w/I,L=0;L<I;L++)t.push(r.add(r.rotate(x,b*L),v))}return t},e.clockwiseSort=function(i){var f=e.mean(i);return i.sort(function(c,d){return r.angle(f,c)-r.angle(f,d)}),i},e.isConvex=function(i){var f=0,c=i.length,d,o,t,n;if(c<3)return null;for(d=0;d<c;d++)if(o=(d+1)%c,t=(d+2)%c,n=(i[o].x-i[d].x)*(i[t].y-i[o].y),n-=(i[o].y-i[d].y)*(i[t].x-i[o].x),n<0?f|=1:n>0&&(f|=2),f===3)return!1;return f!==0?!0:null},e.hull=function(i){var f=[],c=[],d,o;for(i=i.slice(0),i.sort(function(t,n){var a=t.x-n.x;return a!==0?a:t.y-n.y}),o=0;o<i.length;o+=1){for(d=i[o];c.length>=2&&r.cross3(c[c.length-2],c[c.length-1],d)<=0;)c.pop();c.push(d)}for(o=i.length-1;o>=0;o-=1){for(d=i[o];f.length>=2&&r.cross3(f[f.length-2],f[f.length-1],d)<=0;)f.pop();f.push(d)}return f.pop(),c.pop(),f.concat(c)}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(3),s=l(2),i=l(7),f=l(0),c=l(1),d=l(11);(function(){e._timeCorrection=!0,e._inertiaScale=4,e._nextCollidingGroupId=1,e._nextNonCollidingGroupId=-1,e._nextCategory=1,e._baseDelta=1e3/60,e.create=function(t){var n={id:f.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:r.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:16.666666666666668,_original:null},a=f.extend(n,t);return o(a,t),a},e.nextGroup=function(t){return t?e._nextNonCollidingGroupId--:e._nextCollidingGroupId++},e.nextCategory=function(){return e._nextCategory=e._nextCategory<<1,e._nextCategory};var o=function(t,n){n=n||{},e.set(t,{bounds:t.bounds||c.create(t.vertices),positionPrev:t.positionPrev||s.clone(t.position),anglePrev:t.anglePrev||t.angle,vertices:t.vertices,parts:t.parts||[t],isStatic:t.isStatic,isSleeping:t.isSleeping,parent:t.parent||t}),r.rotate(t.vertices,t.angle,t.position),d.rotate(t.axes,t.angle),c.update(t.bounds,t.vertices,t.velocity),e.set(t,{axes:n.axes||t.axes,area:n.area||t.area,mass:n.mass||t.mass,inertia:n.inertia||t.inertia});var a=t.isStatic?"#14151f":f.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),u=t.isStatic?"#555":"#ccc",m=t.isStatic&&t.render.fillStyle===null?1:0;t.render.fillStyle=t.render.fillStyle||a,t.render.strokeStyle=t.render.strokeStyle||u,t.render.lineWidth=t.render.lineWidth||m,t.render.sprite.xOffset+=-(t.bounds.min.x-t.position.x)/(t.bounds.max.x-t.bounds.min.x),t.render.sprite.yOffset+=-(t.bounds.min.y-t.position.y)/(t.bounds.max.y-t.bounds.min.y)};e.set=function(t,n,a){var u;typeof n=="string"&&(u=n,n={},n[u]=a);for(u in n)if(Object.prototype.hasOwnProperty.call(n,u))switch(a=n[u],u){case"isStatic":e.setStatic(t,a);break;case"isSleeping":i.set(t,a);break;case"mass":e.setMass(t,a);break;case"density":e.setDensity(t,a);break;case"inertia":e.setInertia(t,a);break;case"vertices":e.setVertices(t,a);break;case"position":e.setPosition(t,a);break;case"angle":e.setAngle(t,a);break;case"velocity":e.setVelocity(t,a);break;case"angularVelocity":e.setAngularVelocity(t,a);break;case"speed":e.setSpeed(t,a);break;case"angularSpeed":e.setAngularSpeed(t,a);break;case"parts":e.setParts(t,a);break;case"centre":e.setCentre(t,a);break;default:t[u]=a}},e.setStatic=function(t,n){for(var a=0;a<t.parts.length;a++){var u=t.parts[a];u.isStatic=n,n?(u._original={restitution:u.restitution,friction:u.friction,mass:u.mass,inertia:u.inertia,density:u.density,inverseMass:u.inverseMass,inverseInertia:u.inverseInertia},u.restitution=0,u.friction=1,u.mass=u.inertia=u.density=1/0,u.inverseMass=u.inverseInertia=0,u.positionPrev.x=u.position.x,u.positionPrev.y=u.position.y,u.anglePrev=u.angle,u.angularVelocity=0,u.speed=0,u.angularSpeed=0,u.motion=0):u._original&&(u.restitution=u._original.restitution,u.friction=u._original.friction,u.mass=u._original.mass,u.inertia=u._original.inertia,u.density=u._original.density,u.inverseMass=u._original.inverseMass,u.inverseInertia=u._original.inverseInertia,u._original=null)}},e.setMass=function(t,n){var a=t.inertia/(t.mass/6);t.inertia=a*(n/6),t.inverseInertia=1/t.inertia,t.mass=n,t.inverseMass=1/t.mass,t.density=t.mass/t.area},e.setDensity=function(t,n){e.setMass(t,n*t.area),t.density=n},e.setInertia=function(t,n){t.inertia=n,t.inverseInertia=1/t.inertia},e.setVertices=function(t,n){n[0].body===t?t.vertices=n:t.vertices=r.create(n,t),t.axes=d.fromVertices(t.vertices),t.area=r.area(t.vertices),e.setMass(t,t.density*t.area);var a=r.centre(t.vertices);r.translate(t.vertices,a,-1),e.setInertia(t,e._inertiaScale*r.inertia(t.vertices,t.mass)),r.translate(t.vertices,t.position),c.update(t.bounds,t.vertices,t.velocity)},e.setParts=function(t,n,a){var u;for(n=n.slice(0),t.parts.length=0,t.parts.push(t),t.parent=t,u=0;u<n.length;u++){var m=n[u];m!==t&&(m.parent=t,t.parts.push(m))}if(t.parts.length!==1){if(a=typeof a<"u"?a:!0,a){var P=[];for(u=0;u<n.length;u++)P=P.concat(n[u].vertices);r.clockwiseSort(P);var E=r.hull(P),B=r.centre(E);e.setVertices(t,E),r.translate(t.vertices,B)}var h=e._totalProperties(t);t.area=h.area,t.parent=t,t.position.x=h.centre.x,t.position.y=h.centre.y,t.positionPrev.x=h.centre.x,t.positionPrev.y=h.centre.y,e.setMass(t,h.mass),e.setInertia(t,h.inertia),e.setPosition(t,h.centre)}},e.setCentre=function(t,n,a){a?(t.positionPrev.x+=n.x,t.positionPrev.y+=n.y,t.position.x+=n.x,t.position.y+=n.y):(t.positionPrev.x=n.x-(t.position.x-t.positionPrev.x),t.positionPrev.y=n.y-(t.position.y-t.positionPrev.y),t.position.x=n.x,t.position.y=n.y)},e.setPosition=function(t,n,a){var u=s.sub(n,t.position);a?(t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.velocity.x=u.x,t.velocity.y=u.y,t.speed=s.magnitude(u)):(t.positionPrev.x+=u.x,t.positionPrev.y+=u.y);for(var m=0;m<t.parts.length;m++){var P=t.parts[m];P.position.x+=u.x,P.position.y+=u.y,r.translate(P.vertices,u),c.update(P.bounds,P.vertices,t.velocity)}},e.setAngle=function(t,n,a){var u=n-t.angle;a?(t.anglePrev=t.angle,t.angularVelocity=u,t.angularSpeed=Math.abs(u)):t.anglePrev+=u;for(var m=0;m<t.parts.length;m++){var P=t.parts[m];P.angle+=u,r.rotate(P.vertices,u,t.position),d.rotate(P.axes,u),c.update(P.bounds,P.vertices,t.velocity),m>0&&s.rotateAbout(P.position,u,t.position,P.position)}},e.setVelocity=function(t,n){var a=t.deltaTime/e._baseDelta;t.positionPrev.x=t.position.x-n.x*a,t.positionPrev.y=t.position.y-n.y*a,t.velocity.x=(t.position.x-t.positionPrev.x)/a,t.velocity.y=(t.position.y-t.positionPrev.y)/a,t.speed=s.magnitude(t.velocity)},e.getVelocity=function(t){var n=e._baseDelta/t.deltaTime;return{x:(t.position.x-t.positionPrev.x)*n,y:(t.position.y-t.positionPrev.y)*n}},e.getSpeed=function(t){return s.magnitude(e.getVelocity(t))},e.setSpeed=function(t,n){e.setVelocity(t,s.mult(s.normalise(e.getVelocity(t)),n))},e.setAngularVelocity=function(t,n){var a=t.deltaTime/e._baseDelta;t.anglePrev=t.angle-n*a,t.angularVelocity=(t.angle-t.anglePrev)/a,t.angularSpeed=Math.abs(t.angularVelocity)},e.getAngularVelocity=function(t){return(t.angle-t.anglePrev)*e._baseDelta/t.deltaTime},e.getAngularSpeed=function(t){return Math.abs(e.getAngularVelocity(t))},e.setAngularSpeed=function(t,n){e.setAngularVelocity(t,f.sign(e.getAngularVelocity(t))*n)},e.translate=function(t,n,a){e.setPosition(t,s.add(t.position,n),a)},e.rotate=function(t,n,a,u){if(!a)e.setAngle(t,t.angle+n,u);else{var m=Math.cos(n),P=Math.sin(n),E=t.position.x-a.x,B=t.position.y-a.y;e.setPosition(t,{x:a.x+(E*m-B*P),y:a.y+(E*P+B*m)},u),e.setAngle(t,t.angle+n,u)}},e.scale=function(t,n,a,u){var m=0,P=0;u=u||t.position;for(var E=0;E<t.parts.length;E++){var B=t.parts[E];r.scale(B.vertices,n,a,u),B.axes=d.fromVertices(B.vertices),B.area=r.area(B.vertices),e.setMass(B,t.density*B.area),r.translate(B.vertices,{x:-B.position.x,y:-B.position.y}),e.setInertia(B,e._inertiaScale*r.inertia(B.vertices,B.mass)),r.translate(B.vertices,{x:B.position.x,y:B.position.y}),E>0&&(m+=B.area,P+=B.inertia),B.position.x=u.x+(B.position.x-u.x)*n,B.position.y=u.y+(B.position.y-u.y)*a,c.update(B.bounds,B.vertices,t.velocity)}t.parts.length>1&&(t.area=m,t.isStatic||(e.setMass(t,t.density*m),e.setInertia(t,P))),t.circleRadius&&(n===a?t.circleRadius*=n:t.circleRadius=null)},e.update=function(t,n){n=(typeof n<"u"?n:1e3/60)*t.timeScale;var a=n*n,u=e._timeCorrection?n/(t.deltaTime||n):1,m=1-t.frictionAir*(n/f._baseDelta),P=(t.position.x-t.positionPrev.x)*u,E=(t.position.y-t.positionPrev.y)*u;t.velocity.x=P*m+t.force.x/t.mass*a,t.velocity.y=E*m+t.force.y/t.mass*a,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.deltaTime=n,t.angularVelocity=(t.angle-t.anglePrev)*m*u+t.torque/t.inertia*a,t.anglePrev=t.angle,t.angle+=t.angularVelocity;for(var B=0;B<t.parts.length;B++){var h=t.parts[B];r.translate(h.vertices,t.velocity),B>0&&(h.position.x+=t.velocity.x,h.position.y+=t.velocity.y),t.angularVelocity!==0&&(r.rotate(h.vertices,t.angularVelocity,t.position),d.rotate(h.axes,t.angularVelocity),B>0&&s.rotateAbout(h.position,t.angularVelocity,t.position,h.position)),c.update(h.bounds,h.vertices,t.velocity)}},e.updateVelocities=function(t){var n=e._baseDelta/t.deltaTime,a=t.velocity;a.x=(t.position.x-t.positionPrev.x)*n,a.y=(t.position.y-t.positionPrev.y)*n,t.speed=Math.sqrt(a.x*a.x+a.y*a.y),t.angularVelocity=(t.angle-t.anglePrev)*n,t.angularSpeed=Math.abs(t.angularVelocity)},e.applyForce=function(t,n,a){var u={x:n.x-t.position.x,y:n.y-t.position.y};t.force.x+=a.x,t.force.y+=a.y,t.torque+=u.x*a.y-u.y*a.x},e._totalProperties=function(t){for(var n={mass:0,area:0,inertia:0,centre:{x:0,y:0}},a=t.parts.length===1?0:1;a<t.parts.length;a++){var u=t.parts[a],m=u.mass!==1/0?u.mass:1;n.mass+=m,n.area+=u.area,n.inertia+=u.inertia,n.centre=s.add(n.centre,s.mult(u.position,m))}return n.centre=s.div(n.centre,n.mass),n}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(0);(function(){e.on=function(s,i,f){for(var c=i.split(" "),d,o=0;o<c.length;o++)d=c[o],s.events=s.events||{},s.events[d]=s.events[d]||[],s.events[d].push(f);return f},e.off=function(s,i,f){if(!i){s.events={};return}typeof i=="function"&&(f=i,i=r.keys(s.events).join(" "));for(var c=i.split(" "),d=0;d<c.length;d++){var o=s.events[c[d]],t=[];if(f&&o)for(var n=0;n<o.length;n++)o[n]!==f&&t.push(o[n]);s.events[c[d]]=t}},e.trigger=function(s,i,f){var c,d,o,t,n=s.events;if(n&&r.keys(n).length>0){f||(f={}),c=i.split(" ");for(var a=0;a<c.length;a++)if(d=c[a],o=n[d],o){t=r.clone(f,!1),t.name=d,t.source=s;for(var u=0;u<o.length;u++)o[u].apply(s,[t])}}}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(5),s=l(0),i=l(1),f=l(4);(function(){e.create=function(c){return s.extend({id:s.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},c)},e.setModified=function(c,d,o,t){if(c.isModified=d,d&&c.cache&&(c.cache.allBodies=null,c.cache.allConstraints=null,c.cache.allComposites=null),o&&c.parent&&e.setModified(c.parent,d,o,t),t)for(var n=0;n<c.composites.length;n++){var a=c.composites[n];e.setModified(a,d,o,t)}},e.add=function(c,d){var o=[].concat(d);r.trigger(c,"beforeAdd",{object:d});for(var t=0;t<o.length;t++){var n=o[t];switch(n.type){case"body":if(n.parent!==n){s.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}e.addBody(c,n);break;case"constraint":e.addConstraint(c,n);break;case"composite":e.addComposite(c,n);break;case"mouseConstraint":e.addConstraint(c,n.constraint);break}}return r.trigger(c,"afterAdd",{object:d}),c},e.remove=function(c,d,o){var t=[].concat(d);r.trigger(c,"beforeRemove",{object:d});for(var n=0;n<t.length;n++){var a=t[n];switch(a.type){case"body":e.removeBody(c,a,o);break;case"constraint":e.removeConstraint(c,a,o);break;case"composite":e.removeComposite(c,a,o);break;case"mouseConstraint":e.removeConstraint(c,a.constraint);break}}return r.trigger(c,"afterRemove",{object:d}),c},e.addComposite=function(c,d){return c.composites.push(d),d.parent=c,e.setModified(c,!0,!0,!1),c},e.removeComposite=function(c,d,o){var t=s.indexOf(c.composites,d);if(t!==-1&&e.removeCompositeAt(c,t),o)for(var n=0;n<c.composites.length;n++)e.removeComposite(c.composites[n],d,!0);return c},e.removeCompositeAt=function(c,d){return c.composites.splice(d,1),e.setModified(c,!0,!0,!1),c},e.addBody=function(c,d){return c.bodies.push(d),e.setModified(c,!0,!0,!1),c},e.removeBody=function(c,d,o){var t=s.indexOf(c.bodies,d);if(t!==-1&&e.removeBodyAt(c,t),o)for(var n=0;n<c.composites.length;n++)e.removeBody(c.composites[n],d,!0);return c},e.removeBodyAt=function(c,d){return c.bodies.splice(d,1),e.setModified(c,!0,!0,!1),c},e.addConstraint=function(c,d){return c.constraints.push(d),e.setModified(c,!0,!0,!1),c},e.removeConstraint=function(c,d,o){var t=s.indexOf(c.constraints,d);if(t!==-1&&e.removeConstraintAt(c,t),o)for(var n=0;n<c.composites.length;n++)e.removeConstraint(c.composites[n],d,!0);return c},e.removeConstraintAt=function(c,d){return c.constraints.splice(d,1),e.setModified(c,!0,!0,!1),c},e.clear=function(c,d,o){if(o)for(var t=0;t<c.composites.length;t++)e.clear(c.composites[t],d,!0);return d?c.bodies=c.bodies.filter(function(n){return n.isStatic}):c.bodies.length=0,c.constraints.length=0,c.composites.length=0,e.setModified(c,!0,!0,!1),c},e.allBodies=function(c){if(c.cache&&c.cache.allBodies)return c.cache.allBodies;for(var d=[].concat(c.bodies),o=0;o<c.composites.length;o++)d=d.concat(e.allBodies(c.composites[o]));return c.cache&&(c.cache.allBodies=d),d},e.allConstraints=function(c){if(c.cache&&c.cache.allConstraints)return c.cache.allConstraints;for(var d=[].concat(c.constraints),o=0;o<c.composites.length;o++)d=d.concat(e.allConstraints(c.composites[o]));return c.cache&&(c.cache.allConstraints=d),d},e.allComposites=function(c){if(c.cache&&c.cache.allComposites)return c.cache.allComposites;for(var d=[].concat(c.composites),o=0;o<c.composites.length;o++)d=d.concat(e.allComposites(c.composites[o]));return c.cache&&(c.cache.allComposites=d),d},e.get=function(c,d,o){var t,n;switch(o){case"body":t=e.allBodies(c);break;case"constraint":t=e.allConstraints(c);break;case"composite":t=e.allComposites(c).concat(c);break}return t?(n=t.filter(function(a){return a.id.toString()===d.toString()}),n.length===0?null:n[0]):null},e.move=function(c,d,o){return e.remove(c,d),e.add(o,d),c},e.rebase=function(c){for(var d=e.allBodies(c).concat(e.allConstraints(c)).concat(e.allComposites(c)),o=0;o<d.length;o++)d[o].id=s.nextId();return c},e.translate=function(c,d,o){for(var t=o?e.allBodies(c):c.bodies,n=0;n<t.length;n++)f.translate(t[n],d);return c},e.rotate=function(c,d,o,t){for(var n=Math.cos(d),a=Math.sin(d),u=t?e.allBodies(c):c.bodies,m=0;m<u.length;m++){var P=u[m],E=P.position.x-o.x,B=P.position.y-o.y;f.setPosition(P,{x:o.x+(E*n-B*a),y:o.y+(E*a+B*n)}),f.rotate(P,d)}return c},e.scale=function(c,d,o,t,n){for(var a=n?e.allBodies(c):c.bodies,u=0;u<a.length;u++){var m=a[u],P=m.position.x-t.x,E=m.position.y-t.y;f.setPosition(m,{x:t.x+P*d,y:t.y+E*o}),f.scale(m,d,o)}return c},e.bounds=function(c){for(var d=e.allBodies(c),o=[],t=0;t<d.length;t+=1){var n=d[t];o.push(n.bounds.min,n.bounds.max)}return i.create(o)}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(4),s=l(5),i=l(0);(function(){e._motionWakeThreshold=.18,e._motionSleepThreshold=.08,e._minBias=.9,e.update=function(f,c){for(var d=c/i._baseDelta,o=e._motionSleepThreshold,t=0;t<f.length;t++){var n=f[t],a=r.getSpeed(n),u=r.getAngularSpeed(n),m=a*a+u*u;if(n.force.x!==0||n.force.y!==0){e.set(n,!1);continue}var P=Math.min(n.motion,m),E=Math.max(n.motion,m);n.motion=e._minBias*P+(1-e._minBias)*E,n.sleepThreshold>0&&n.motion<o?(n.sleepCounter+=1,n.sleepCounter>=n.sleepThreshold/d&&e.set(n,!0)):n.sleepCounter>0&&(n.sleepCounter-=1)}},e.afterCollisions=function(f){for(var c=e._motionSleepThreshold,d=0;d<f.length;d++){var o=f[d];if(o.isActive){var t=o.collision,n=t.bodyA.parent,a=t.bodyB.parent;if(!(n.isSleeping&&a.isSleeping||n.isStatic||a.isStatic)&&(n.isSleeping||a.isSleeping)){var u=n.isSleeping&&!n.isStatic?n:a,m=u===n?a:n;!u.isStatic&&m.motion>c&&e.set(u,!1)}}}},e.set=function(f,c){var d=f.isSleeping;c?(f.isSleeping=!0,f.sleepCounter=f.sleepThreshold,f.positionImpulse.x=0,f.positionImpulse.y=0,f.positionPrev.x=f.position.x,f.positionPrev.y=f.position.y,f.anglePrev=f.angle,f.speed=0,f.angularSpeed=0,f.motion=0,d||s.trigger(f,"sleepStart")):(f.isSleeping=!1,f.sleepCounter=0,d&&s.trigger(f,"sleepEnd"))}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(3),s=l(9);(function(){var i=[],f={overlap:0,axis:null},c={overlap:0,axis:null};e.create=function(d,o){return{pair:null,collided:!1,bodyA:d,bodyB:o,parentA:d.parent,parentB:o.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[]}},e.collides=function(d,o,t){if(e._overlapAxes(f,d.vertices,o.vertices,d.axes),f.overlap<=0||(e._overlapAxes(c,o.vertices,d.vertices,o.axes),c.overlap<=0))return null;var n=t&&t.table[s.id(d,o)],a;n?a=n.collision:(a=e.create(d,o),a.collided=!0,a.bodyA=d.id<o.id?d:o,a.bodyB=d.id<o.id?o:d,a.parentA=a.bodyA.parent,a.parentB=a.bodyB.parent),d=a.bodyA,o=a.bodyB;var u;f.overlap<c.overlap?u=f:u=c;var m=a.normal,P=a.supports,E=u.axis,B=E.x,h=E.y;B*(o.position.x-d.position.x)+h*(o.position.y-d.position.y)<0?(m.x=B,m.y=h):(m.x=-B,m.y=-h),a.tangent.x=-m.y,a.tangent.y=m.x,a.depth=u.overlap,a.penetration.x=m.x*a.depth,a.penetration.y=m.y*a.depth;var x=e._findSupports(d,o,m,1),C=0;if(r.contains(d.vertices,x[0])&&(P[C++]=x[0]),r.contains(d.vertices,x[1])&&(P[C++]=x[1]),C<2){var v=e._findSupports(o,d,m,-1);r.contains(o.vertices,v[0])&&(P[C++]=v[0]),C<2&&r.contains(o.vertices,v[1])&&(P[C++]=v[1])}return C===0&&(P[C++]=x[0]),P.length=C,a},e._overlapAxes=function(d,o,t,n){var a=o.length,u=t.length,m=o[0].x,P=o[0].y,E=t[0].x,B=t[0].y,h=n.length,x=Number.MAX_VALUE,C=0,v,I,w,b,L,A;for(L=0;L<h;L++){var k=n[L],D=k.x,N=k.y,O=m*D+P*N,z=E*D+B*N,H=O,G=z;for(A=1;A<a;A+=1)b=o[A].x*D+o[A].y*N,b>H?H=b:b<O&&(O=b);for(A=1;A<u;A+=1)b=t[A].x*D+t[A].y*N,b>G?G=b:b<z&&(z=b);if(I=H-z,w=G-O,v=I<w?I:w,v<x&&(x=v,C=L,v<=0))break}d.axis=n[C],d.overlap=x},e._projectToAxis=function(d,o,t){for(var n=o[0].x*t.x+o[0].y*t.y,a=n,u=1;u<o.length;u+=1){var m=o[u].x*t.x+o[u].y*t.y;m>a?a=m:m<n&&(n=m)}d.min=n,d.max=a},e._findSupports=function(d,o,t,n){var a=o.vertices,u=a.length,m=d.position.x,P=d.position.y,E=t.x*n,B=t.y*n,h=Number.MAX_VALUE,x,C,v,I,w;for(w=0;w<u;w+=1)C=a[w],I=E*(m-C.x)+B*(P-C.y),I<h&&(h=I,x=C);return v=a[(u+x.index-1)%u],h=E*(m-v.x)+B*(P-v.y),C=a[(x.index+1)%u],E*(m-C.x)+B*(P-C.y)<h?(i[0]=x,i[1]=C,i):(i[0]=x,i[1]=v,i)}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(16);(function(){e.create=function(s,i){var f=s.bodyA,c=s.bodyB,d={id:e.id(f,c),bodyA:f,bodyB:c,collision:s,contacts:[],activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:f.isSensor||c.isSensor,timeCreated:i,timeUpdated:i,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return e.update(d,s,i),d},e.update=function(s,i,f){var c=s.contacts,d=i.supports,o=s.activeContacts,t=i.parentA,n=i.parentB,a=t.vertices.length;s.isActive=!0,s.timeUpdated=f,s.collision=i,s.separation=i.depth,s.inverseMass=t.inverseMass+n.inverseMass,s.friction=t.friction<n.friction?t.friction:n.friction,s.frictionStatic=t.frictionStatic>n.frictionStatic?t.frictionStatic:n.frictionStatic,s.restitution=t.restitution>n.restitution?t.restitution:n.restitution,s.slop=t.slop>n.slop?t.slop:n.slop,i.pair=s,o.length=0;for(var u=0;u<d.length;u++){var m=d[u],P=m.body===t?m.index:a+m.index,E=c[P];E?o.push(E):o.push(c[P]=r.create(m))}},e.setActive=function(s,i,f){i?(s.isActive=!0,s.timeUpdated=f):(s.isActive=!1,s.activeContacts.length=0)},e.id=function(s,i){return s.id<i.id?"A"+s.id+"B"+i.id:"A"+i.id+"B"+s.id}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(3),s=l(2),i=l(7),f=l(1),c=l(11),d=l(0);(function(){e._warming=.4,e._torqueDampen=1,e._minLength=1e-6,e.create=function(o){var t=o;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var n=t.bodyA?s.add(t.bodyA.position,t.pointA):t.pointA,a=t.bodyB?s.add(t.bodyB.position,t.pointB):t.pointB,u=s.magnitude(s.sub(n,a));t.length=typeof t.length<"u"?t.length:u,t.id=t.id||d.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var m={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return t.length===0&&t.stiffness>.1?(m.type="pin",m.anchors=!1):t.stiffness<.9&&(m.type="spring"),t.render=d.extend(m,t.render),t},e.preSolveAll=function(o){for(var t=0;t<o.length;t+=1){var n=o[t],a=n.constraintImpulse;n.isStatic||a.x===0&&a.y===0&&a.angle===0||(n.position.x+=a.x,n.position.y+=a.y,n.angle+=a.angle)}},e.solveAll=function(o,t){for(var n=d.clamp(t/d._baseDelta,0,1),a=0;a<o.length;a+=1){var u=o[a],m=!u.bodyA||u.bodyA&&u.bodyA.isStatic,P=!u.bodyB||u.bodyB&&u.bodyB.isStatic;(m||P)&&e.solve(o[a],n)}for(a=0;a<o.length;a+=1)u=o[a],m=!u.bodyA||u.bodyA&&u.bodyA.isStatic,P=!u.bodyB||u.bodyB&&u.bodyB.isStatic,!m&&!P&&e.solve(o[a],n)},e.solve=function(o,t){var n=o.bodyA,a=o.bodyB,u=o.pointA,m=o.pointB;if(!(!n&&!a)){n&&!n.isStatic&&(s.rotate(u,n.angle-o.angleA,u),o.angleA=n.angle),a&&!a.isStatic&&(s.rotate(m,a.angle-o.angleB,m),o.angleB=a.angle);var P=u,E=m;if(n&&(P=s.add(n.position,u)),a&&(E=s.add(a.position,m)),!(!P||!E)){var B=s.sub(P,E),h=s.magnitude(B);h<e._minLength&&(h=e._minLength);var x=(h-o.length)/h,C=o.stiffness>=1||o.length===0,v=C?o.stiffness*t:o.stiffness*t*t,I=o.damping*t,w=s.mult(B,x*v),b=(n?n.inverseMass:0)+(a?a.inverseMass:0),L=(n?n.inverseInertia:0)+(a?a.inverseInertia:0),A=b+L,k,D,N,O,z;if(I>0){var H=s.create();N=s.div(B,h),z=s.sub(a&&s.sub(a.position,a.positionPrev)||H,n&&s.sub(n.position,n.positionPrev)||H),O=s.dot(N,z)}n&&!n.isStatic&&(D=n.inverseMass/b,n.constraintImpulse.x-=w.x*D,n.constraintImpulse.y-=w.y*D,n.position.x-=w.x*D,n.position.y-=w.y*D,I>0&&(n.positionPrev.x-=I*N.x*O*D,n.positionPrev.y-=I*N.y*O*D),k=s.cross(u,w)/A*e._torqueDampen*n.inverseInertia*(1-o.angularStiffness),n.constraintImpulse.angle-=k,n.angle-=k),a&&!a.isStatic&&(D=a.inverseMass/b,a.constraintImpulse.x+=w.x*D,a.constraintImpulse.y+=w.y*D,a.position.x+=w.x*D,a.position.y+=w.y*D,I>0&&(a.positionPrev.x+=I*N.x*O*D,a.positionPrev.y+=I*N.y*O*D),k=s.cross(m,w)/A*e._torqueDampen*a.inverseInertia*(1-o.angularStiffness),a.constraintImpulse.angle+=k,a.angle+=k)}}},e.postSolveAll=function(o){for(var t=0;t<o.length;t++){var n=o[t],a=n.constraintImpulse;if(!(n.isStatic||a.x===0&&a.y===0&&a.angle===0)){i.set(n,!1);for(var u=0;u<n.parts.length;u++){var m=n.parts[u];r.translate(m.vertices,a),u>0&&(m.position.x+=a.x,m.position.y+=a.y),a.angle!==0&&(r.rotate(m.vertices,a.angle,n.position),c.rotate(m.axes,a.angle),u>0&&s.rotateAbout(m.position,a.angle,n.position,m.position)),f.update(m.bounds,m.vertices,n.velocity)}a.angle*=e._warming,a.x*=e._warming,a.y*=e._warming}}},e.pointAWorld=function(o){return{x:(o.bodyA?o.bodyA.position.x:0)+(o.pointA?o.pointA.x:0),y:(o.bodyA?o.bodyA.position.y:0)+(o.pointA?o.pointA.y:0)}},e.pointBWorld=function(o){return{x:(o.bodyB?o.bodyB.position.x:0)+(o.pointB?o.pointB.x:0),y:(o.bodyB?o.bodyB.position.y:0)+(o.pointB?o.pointB.y:0)}}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(2),s=l(0);(function(){e.fromVertices=function(i){for(var f={},c=0;c<i.length;c++){var d=(c+1)%i.length,o=r.normalise({x:i[d].y-i[c].y,y:i[c].x-i[d].x}),t=o.y===0?1/0:o.x/o.y;t=t.toFixed(3).toString(),f[t]=o}return s.values(f)},e.rotate=function(i,f){if(f!==0)for(var c=Math.cos(f),d=Math.sin(f),o=0;o<i.length;o++){var t=i[o],n;n=t.x*c-t.y*d,t.y=t.x*d+t.y*c,t.x=n}}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(3),s=l(0),i=l(4),f=l(1),c=l(2);(function(){e.rectangle=function(d,o,t,n,a){a=a||{};var u={label:"Rectangle Body",position:{x:d,y:o},vertices:r.fromPath("L 0 0 L "+t+" 0 L "+t+" "+n+" L 0 "+n)};if(a.chamfer){var m=a.chamfer;u.vertices=r.chamfer(u.vertices,m.radius,m.quality,m.qualityMin,m.qualityMax),delete a.chamfer}return i.create(s.extend({},u,a))},e.trapezoid=function(d,o,t,n,a,u){u=u||{},a*=.5;var m=(1-a*2)*t,P=t*a,E=P+m,B=E+P,h;a<.5?h="L 0 0 L "+P+" "+-n+" L "+E+" "+-n+" L "+B+" 0":h="L 0 0 L "+E+" "+-n+" L "+B+" 0";var x={label:"Trapezoid Body",position:{x:d,y:o},vertices:r.fromPath(h)};if(u.chamfer){var C=u.chamfer;x.vertices=r.chamfer(x.vertices,C.radius,C.quality,C.qualityMin,C.qualityMax),delete u.chamfer}return i.create(s.extend({},x,u))},e.circle=function(d,o,t,n,a){n=n||{};var u={label:"Circle Body",circleRadius:t};a=a||25;var m=Math.ceil(Math.max(10,Math.min(a,t)));return m%2===1&&(m+=1),e.polygon(d,o,m,t,s.extend({},u,n))},e.polygon=function(d,o,t,n,a){if(a=a||{},t<3)return e.circle(d,o,n,a);for(var u=2*Math.PI/t,m="",P=u*.5,E=0;E<t;E+=1){var B=P+E*u,h=Math.cos(B)*n,x=Math.sin(B)*n;m+="L "+h.toFixed(3)+" "+x.toFixed(3)+" "}var C={label:"Polygon Body",position:{x:d,y:o},vertices:r.fromPath(m)};if(a.chamfer){var v=a.chamfer;C.vertices=r.chamfer(C.vertices,v.radius,v.quality,v.qualityMin,v.qualityMax),delete a.chamfer}return i.create(s.extend({},C,a))},e.fromVertices=function(d,o,t,n,a,u,m,P){var E=s.getDecomp(),B,h,x,C,v,I,w,b,L,A,k;for(B=!!(E&&E.quickDecomp),n=n||{},x=[],a=typeof a<"u"?a:!1,u=typeof u<"u"?u:.01,m=typeof m<"u"?m:10,P=typeof P<"u"?P:.01,s.isArray(t[0])||(t=[t]),A=0;A<t.length;A+=1)if(I=t[A],C=r.isConvex(I),v=!C,v&&!B&&s.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),C||!B)C?I=r.clockwiseSort(I):I=r.hull(I),x.push({position:{x:d,y:o},vertices:I});else{var D=I.map(function(K){return[K.x,K.y]});E.makeCCW(D),u!==!1&&E.removeCollinearPoints(D,u),P!==!1&&E.removeDuplicatePoints&&E.removeDuplicatePoints(D,P);var N=E.quickDecomp(D);for(w=0;w<N.length;w++){var O=N[w],z=O.map(function(K){return{x:K[0],y:K[1]}});m>0&&r.area(z)<m||x.push({position:r.centre(z),vertices:z})}}for(w=0;w<x.length;w++)x[w]=i.create(s.extend(x[w],n));if(a){var H=5;for(w=0;w<x.length;w++){var G=x[w];for(b=w+1;b<x.length;b++){var Y=x[b];if(f.overlaps(G.bounds,Y.bounds)){var $=G.vertices,X=Y.vertices;for(L=0;L<G.vertices.length;L++)for(k=0;k<Y.vertices.length;k++){var Z=c.magnitudeSquared(c.sub($[(L+1)%$.length],X[k])),ee=c.magnitudeSquared(c.sub($[L],X[(k+1)%X.length]));Z<H&&ee<H&&($[L].isInternal=!0,X[k].isInternal=!0)}}}}}return x.length>1?(h=i.create(s.extend({parts:x.slice(0)},n)),i.setPosition(h,{x:d,y:o}),h):x[0]}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(0),s=l(8);(function(){e.create=function(i){var f={bodies:[],pairs:null};return r.extend(f,i)},e.setBodies=function(i,f){i.bodies=f.slice(0)},e.clear=function(i){i.bodies=[]},e.collisions=function(i){var f=[],c=i.pairs,d=i.bodies,o=d.length,t=e.canCollide,n=s.collides,a,u;for(d.sort(e._compareBoundsX),a=0;a<o;a++){var m=d[a],P=m.bounds,E=m.bounds.max.x,B=m.bounds.max.y,h=m.bounds.min.y,x=m.isStatic||m.isSleeping,C=m.parts.length,v=C===1;for(u=a+1;u<o;u++){var I=d[u],w=I.bounds;if(w.min.x>E)break;if(!(B<w.min.y||h>w.max.y)&&!(x&&(I.isStatic||I.isSleeping))&&t(m.collisionFilter,I.collisionFilter)){var b=I.parts.length;if(v&&b===1){var L=n(m,I,c);L&&f.push(L)}else for(var A=C>1?1:0,k=b>1?1:0,D=A;D<C;D++)for(var N=m.parts[D],P=N.bounds,O=k;O<b;O++){var z=I.parts[O],w=z.bounds;if(!(P.min.x>w.max.x||P.max.x<w.min.x||P.max.y<w.min.y||P.min.y>w.max.y)){var L=n(N,z,c);L&&f.push(L)}}}}}return f},e.canCollide=function(i,f){return i.group===f.group&&i.group!==0?i.group>0:(i.mask&f.category)!==0&&(f.mask&i.category)!==0},e._compareBoundsX=function(i,f){return i.bounds.min.x-f.bounds.min.x}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(0);(function(){e.create=function(s){var i={};return s||r.log("Mouse.create: element was undefined, defaulting to document.body","warn"),i.element=s||document.body,i.absolute={x:0,y:0},i.position={x:0,y:0},i.mousedownPosition={x:0,y:0},i.mouseupPosition={x:0,y:0},i.offset={x:0,y:0},i.scale={x:1,y:1},i.wheelDelta=0,i.button=-1,i.pixelRatio=parseInt(i.element.getAttribute("data-pixel-ratio"),10)||1,i.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},i.mousemove=function(f){var c=e._getRelativeMousePosition(f,i.element,i.pixelRatio),d=f.changedTouches;d&&(i.button=0,f.preventDefault()),i.absolute.x=c.x,i.absolute.y=c.y,i.position.x=i.absolute.x*i.scale.x+i.offset.x,i.position.y=i.absolute.y*i.scale.y+i.offset.y,i.sourceEvents.mousemove=f},i.mousedown=function(f){var c=e._getRelativeMousePosition(f,i.element,i.pixelRatio),d=f.changedTouches;d?(i.button=0,f.preventDefault()):i.button=f.button,i.absolute.x=c.x,i.absolute.y=c.y,i.position.x=i.absolute.x*i.scale.x+i.offset.x,i.position.y=i.absolute.y*i.scale.y+i.offset.y,i.mousedownPosition.x=i.position.x,i.mousedownPosition.y=i.position.y,i.sourceEvents.mousedown=f},i.mouseup=function(f){var c=e._getRelativeMousePosition(f,i.element,i.pixelRatio),d=f.changedTouches;d&&f.preventDefault(),i.button=-1,i.absolute.x=c.x,i.absolute.y=c.y,i.position.x=i.absolute.x*i.scale.x+i.offset.x,i.position.y=i.absolute.y*i.scale.y+i.offset.y,i.mouseupPosition.x=i.position.x,i.mouseupPosition.y=i.position.y,i.sourceEvents.mouseup=f},i.mousewheel=function(f){i.wheelDelta=Math.max(-1,Math.min(1,f.wheelDelta||-f.detail)),f.preventDefault()},e.setElement(i,i.element),i},e.setElement=function(s,i){s.element=i,i.addEventListener("mousemove",s.mousemove),i.addEventListener("mousedown",s.mousedown),i.addEventListener("mouseup",s.mouseup),i.addEventListener("mousewheel",s.mousewheel),i.addEventListener("DOMMouseScroll",s.mousewheel),i.addEventListener("touchmove",s.mousemove),i.addEventListener("touchstart",s.mousedown),i.addEventListener("touchend",s.mouseup)},e.clearSourceEvents=function(s){s.sourceEvents.mousemove=null,s.sourceEvents.mousedown=null,s.sourceEvents.mouseup=null,s.sourceEvents.mousewheel=null,s.wheelDelta=0},e.setOffset=function(s,i){s.offset.x=i.x,s.offset.y=i.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y},e.setScale=function(s,i){s.scale.x=i.x,s.scale.y=i.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y},e._getRelativeMousePosition=function(s,i,f){var c=i.getBoundingClientRect(),d=document.documentElement||document.body.parentNode||document.body,o=window.pageXOffset!==void 0?window.pageXOffset:d.scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:d.scrollTop,n=s.changedTouches,a,u;return n?(a=n[0].pageX-c.left-o,u=n[0].pageY-c.top-t):(a=s.pageX-c.left-o,u=s.pageY-c.top-t),{x:a/(i.clientWidth/(i.width||i.clientWidth)*f),y:u/(i.clientHeight/(i.height||i.clientHeight)*f)}}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(0);(function(){e._registry={},e.register=function(s){if(e.isPlugin(s)||r.warn("Plugin.register:",e.toString(s),"does not implement all required fields."),s.name in e._registry){var i=e._registry[s.name],f=e.versionParse(s.version).number,c=e.versionParse(i.version).number;f>c?(r.warn("Plugin.register:",e.toString(i),"was upgraded to",e.toString(s)),e._registry[s.name]=s):f<c?r.warn("Plugin.register:",e.toString(i),"can not be downgraded to",e.toString(s)):s!==i&&r.warn("Plugin.register:",e.toString(s),"is already registered to different plugin object")}else e._registry[s.name]=s;return s},e.resolve=function(s){return e._registry[e.dependencyParse(s).name]},e.toString=function(s){return typeof s=="string"?s:(s.name||"anonymous")+"@"+(s.version||s.range||"0.0.0")},e.isPlugin=function(s){return s&&s.name&&s.version&&s.install},e.isUsed=function(s,i){return s.used.indexOf(i)>-1},e.isFor=function(s,i){var f=s.for&&e.dependencyParse(s.for);return!s.for||i.name===f.name&&e.versionSatisfies(i.version,f.range)},e.use=function(s,i){if(s.uses=(s.uses||[]).concat(i||[]),s.uses.length===0){r.warn("Plugin.use:",e.toString(s),"does not specify any dependencies to install.");return}for(var f=e.dependencies(s),c=r.topologicalSort(f),d=[],o=0;o<c.length;o+=1)if(c[o]!==s.name){var t=e.resolve(c[o]);if(!t){d.push("âŒ "+c[o]);continue}e.isUsed(s,t.name)||(e.isFor(t,s)||(r.warn("Plugin.use:",e.toString(t),"is for",t.for,"but installed on",e.toString(s)+"."),t._warned=!0),t.install?t.install(s):(r.warn("Plugin.use:",e.toString(t),"does not specify an install function."),t._warned=!0),t._warned?(d.push("ðŸ”¶ "+e.toString(t)),delete t._warned):d.push("âœ… "+e.toString(t)),s.used.push(t.name))}d.length>0&&r.info(d.join("  "))},e.dependencies=function(s,i){var f=e.dependencyParse(s),c=f.name;if(i=i||{},!(c in i)){s=e.resolve(s)||s,i[c]=r.map(s.uses||[],function(o){e.isPlugin(o)&&e.register(o);var t=e.dependencyParse(o),n=e.resolve(o);return n&&!e.versionSatisfies(n.version,t.range)?(r.warn("Plugin.dependencies:",e.toString(n),"does not satisfy",e.toString(t),"used by",e.toString(f)+"."),n._warned=!0,s._warned=!0):n||(r.warn("Plugin.dependencies:",e.toString(o),"used by",e.toString(f),"could not be resolved."),s._warned=!0),t.name});for(var d=0;d<i[c].length;d+=1)e.dependencies(i[c][d],i);return i}},e.dependencyParse=function(s){if(r.isString(s)){var i=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return i.test(s)||r.warn("Plugin.dependencyParse:",s,"is not a valid dependency string."),{name:s.split("@")[0],range:s.split("@")[1]||"*"}}return{name:s.name,range:s.range||s.version}},e.versionParse=function(s){var i=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;i.test(s)||r.warn("Plugin.versionParse:",s,"is not a valid version or range.");var f=i.exec(s),c=Number(f[4]),d=Number(f[5]),o=Number(f[6]);return{isRange:!!(f[1]||f[2]),version:f[3],range:s,operator:f[1]||f[2]||"",major:c,minor:d,patch:o,parts:[c,d,o],prerelease:f[7],number:c*1e8+d*1e4+o}},e.versionSatisfies=function(s,i){i=i||"*";var f=e.versionParse(i),c=e.versionParse(s);if(f.isRange){if(f.operator==="*"||s==="*")return!0;if(f.operator===">")return c.number>f.number;if(f.operator===">=")return c.number>=f.number;if(f.operator==="~")return c.major===f.major&&c.minor===f.minor&&c.patch>=f.patch;if(f.operator==="^")return f.major>0?c.major===f.major&&c.number>=f.number:f.minor>0?c.minor===f.minor&&c.patch>=f.patch:c.patch===f.patch}return s===i||s==="*"}})()}),(function(p,M){var l={};p.exports=l,(function(){l.create=function(e){return{vertex:e,normalImpulse:0,tangentImpulse:0}}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(7),s=l(18),i=l(13),f=l(19),c=l(5),d=l(6),o=l(10),t=l(0),n=l(4);(function(){e.create=function(a){a=a||{};var u={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},m=t.extend(u,a);return m.world=a.world||d.create({label:"World"}),m.pairs=a.pairs||f.create(),m.detector=a.detector||i.create(),m.grid={buckets:[]},m.world.gravity=m.gravity,m.broadphase=m.grid,m.metrics={},m},e.update=function(a,u){var m=t.now(),P=a.world,E=a.detector,B=a.pairs,h=a.timing,x=h.timestamp,C;u=typeof u<"u"?u:t._baseDelta,u*=h.timeScale,h.timestamp+=u,h.lastDelta=u;var v={timestamp:h.timestamp,delta:u};c.trigger(a,"beforeUpdate",v);var I=d.allBodies(P),w=d.allConstraints(P);for(P.isModified&&(i.setBodies(E,I),d.setModified(P,!1,!1,!0)),a.enableSleeping&&r.update(I,u),e._bodiesApplyGravity(I,a.gravity),u>0&&e._bodiesUpdate(I,u),o.preSolveAll(I),C=0;C<a.constraintIterations;C++)o.solveAll(w,u);o.postSolveAll(I),E.pairs=a.pairs;var b=i.collisions(E);f.update(B,b,x),a.enableSleeping&&r.afterCollisions(B.list),B.collisionStart.length>0&&c.trigger(a,"collisionStart",{pairs:B.collisionStart});var L=t.clamp(20/a.positionIterations,0,1);for(s.preSolvePosition(B.list),C=0;C<a.positionIterations;C++)s.solvePosition(B.list,u,L);for(s.postSolvePosition(I),o.preSolveAll(I),C=0;C<a.constraintIterations;C++)o.solveAll(w,u);for(o.postSolveAll(I),s.preSolveVelocity(B.list),C=0;C<a.velocityIterations;C++)s.solveVelocity(B.list,u);return e._bodiesUpdateVelocities(I),B.collisionActive.length>0&&c.trigger(a,"collisionActive",{pairs:B.collisionActive}),B.collisionEnd.length>0&&c.trigger(a,"collisionEnd",{pairs:B.collisionEnd}),e._bodiesClearForces(I),c.trigger(a,"afterUpdate",v),a.timing.lastElapsed=t.now()-m,a},e.merge=function(a,u){if(t.extend(a,u),u.world){a.world=u.world,e.clear(a);for(var m=d.allBodies(a.world),P=0;P<m.length;P++){var E=m[P];r.set(E,!1),E.id=t.nextId()}}},e.clear=function(a){f.clear(a.pairs),i.clear(a.detector)},e._bodiesClearForces=function(a){for(var u=a.length,m=0;m<u;m++){var P=a[m];P.force.x=0,P.force.y=0,P.torque=0}},e._bodiesApplyGravity=function(a,u){var m=typeof u.scale<"u"?u.scale:.001,P=a.length;if(!(u.x===0&&u.y===0||m===0))for(var E=0;E<P;E++){var B=a[E];B.isStatic||B.isSleeping||(B.force.y+=B.mass*u.y*m,B.force.x+=B.mass*u.x*m)}},e._bodiesUpdate=function(a,u){for(var m=a.length,P=0;P<m;P++){var E=a[P];E.isStatic||E.isSleeping||n.update(E,u)}},e._bodiesUpdateVelocities=function(a){for(var u=a.length,m=0;m<u;m++)n.updateVelocities(a[m])}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(3),s=l(0),i=l(1);(function(){e._restingThresh=2,e._restingThreshTangent=Math.sqrt(6),e._positionDampen=.9,e._positionWarming=.8,e._frictionNormalMultiplier=5,e._frictionMaxStatic=Number.MAX_VALUE,e.preSolvePosition=function(f){var c,d,o,t=f.length;for(c=0;c<t;c++)d=f[c],d.isActive&&(o=d.activeContacts.length,d.collision.parentA.totalContacts+=o,d.collision.parentB.totalContacts+=o)},e.solvePosition=function(f,c,d){var o,t,n,a,u,m,P,E,B=e._positionDampen*(d||1),h=s.clamp(c/s._baseDelta,0,1),x=f.length;for(o=0;o<x;o++)t=f[o],!(!t.isActive||t.isSensor)&&(n=t.collision,a=n.parentA,u=n.parentB,m=n.normal,t.separation=m.x*(u.positionImpulse.x+n.penetration.x-a.positionImpulse.x)+m.y*(u.positionImpulse.y+n.penetration.y-a.positionImpulse.y));for(o=0;o<x;o++)t=f[o],!(!t.isActive||t.isSensor)&&(n=t.collision,a=n.parentA,u=n.parentB,m=n.normal,E=t.separation-t.slop*h,(a.isStatic||u.isStatic)&&(E*=2),a.isStatic||a.isSleeping||(P=B/a.totalContacts,a.positionImpulse.x+=m.x*E*P,a.positionImpulse.y+=m.y*E*P),u.isStatic||u.isSleeping||(P=B/u.totalContacts,u.positionImpulse.x-=m.x*E*P,u.positionImpulse.y-=m.y*E*P))},e.postSolvePosition=function(f){for(var c=e._positionWarming,d=f.length,o=r.translate,t=i.update,n=0;n<d;n++){var a=f[n],u=a.positionImpulse,m=u.x,P=u.y,E=a.velocity;if(a.totalContacts=0,m!==0||P!==0){for(var B=0;B<a.parts.length;B++){var h=a.parts[B];o(h.vertices,u),t(h.bounds,h.vertices,E),h.position.x+=m,h.position.y+=P}a.positionPrev.x+=m,a.positionPrev.y+=P,m*E.x+P*E.y<0?(u.x=0,u.y=0):(u.x*=c,u.y*=c)}}},e.preSolveVelocity=function(f){var c=f.length,d,o;for(d=0;d<c;d++){var t=f[d];if(!(!t.isActive||t.isSensor)){var n=t.activeContacts,a=n.length,u=t.collision,m=u.parentA,P=u.parentB,E=u.normal,B=u.tangent;for(o=0;o<a;o++){var h=n[o],x=h.vertex,C=h.normalImpulse,v=h.tangentImpulse;if(C!==0||v!==0){var I=E.x*C+B.x*v,w=E.y*C+B.y*v;m.isStatic||m.isSleeping||(m.positionPrev.x+=I*m.inverseMass,m.positionPrev.y+=w*m.inverseMass,m.anglePrev+=m.inverseInertia*((x.x-m.position.x)*w-(x.y-m.position.y)*I)),P.isStatic||P.isSleeping||(P.positionPrev.x-=I*P.inverseMass,P.positionPrev.y-=w*P.inverseMass,P.anglePrev-=P.inverseInertia*((x.x-P.position.x)*w-(x.y-P.position.y)*I))}}}}},e.solveVelocity=function(f,c){var d=c/s._baseDelta,o=d*d,t=o*d,n=-e._restingThresh*d,a=e._restingThreshTangent,u=e._frictionNormalMultiplier*d,m=e._frictionMaxStatic,P=f.length,E,B,h,x;for(h=0;h<P;h++){var C=f[h];if(!(!C.isActive||C.isSensor)){var v=C.collision,I=v.parentA,w=v.parentB,b=I.velocity,L=w.velocity,A=v.normal.x,k=v.normal.y,D=v.tangent.x,N=v.tangent.y,O=C.activeContacts,z=O.length,H=1/z,G=I.inverseMass+w.inverseMass,Y=C.friction*C.frictionStatic*u;for(b.x=I.position.x-I.positionPrev.x,b.y=I.position.y-I.positionPrev.y,L.x=w.position.x-w.positionPrev.x,L.y=w.position.y-w.positionPrev.y,I.angularVelocity=I.angle-I.anglePrev,w.angularVelocity=w.angle-w.anglePrev,x=0;x<z;x++){var $=O[x],X=$.vertex,Z=X.x-I.position.x,ee=X.y-I.position.y,K=X.x-w.position.x,ne=X.y-w.position.y,j=b.x-ee*I.angularVelocity,Pe=b.y+Z*I.angularVelocity,Ie=L.x-ne*w.angularVelocity,Me=L.y+K*w.angularVelocity,ge=j-Ie,me=Pe-Me,de=A*ge+k*me,re=D*ge+N*me,pe=C.separation+de,he=Math.min(pe,1);he=pe<0?0:he;var ve=he*Y;re<-ve||re>ve?(B=re>0?re:-re,E=C.friction*(re>0?1:-1)*t,E<-B?E=-B:E>B&&(E=B)):(E=re,B=m);var xe=Z*k-ee*A,ye=K*k-ne*A,Se=H/(G+I.inverseInertia*xe*xe+w.inverseInertia*ye*ye),le=(1+C.restitution)*de*Se;if(E*=Se,de<n)$.normalImpulse=0;else{var Ee=$.normalImpulse;$.normalImpulse+=le,$.normalImpulse>0&&($.normalImpulse=0),le=$.normalImpulse-Ee}if(re<-a||re>a)$.tangentImpulse=0;else{var Be=$.tangentImpulse;$.tangentImpulse+=E,$.tangentImpulse<-B&&($.tangentImpulse=-B),$.tangentImpulse>B&&($.tangentImpulse=B),E=$.tangentImpulse-Be}var ce=A*le+D*E,fe=k*le+N*E;I.isStatic||I.isSleeping||(I.positionPrev.x+=ce*I.inverseMass,I.positionPrev.y+=fe*I.inverseMass,I.anglePrev+=(Z*fe-ee*ce)*I.inverseInertia),w.isStatic||w.isSleeping||(w.positionPrev.x-=ce*w.inverseMass,w.positionPrev.y-=fe*w.inverseMass,w.anglePrev-=(K*fe-ne*ce)*w.inverseInertia)}}}}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(9),s=l(0);(function(){e.create=function(i){return s.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},i)},e.update=function(i,f,c){var d=i.list,o=d.length,t=i.table,n=f.length,a=i.collisionStart,u=i.collisionEnd,m=i.collisionActive,P,E,B,h;for(a.length=0,u.length=0,m.length=0,h=0;h<o;h++)d[h].confirmedActive=!1;for(h=0;h<n;h++)P=f[h],B=P.pair,B?(B.isActive?m.push(B):a.push(B),r.update(B,P,c),B.confirmedActive=!0):(B=r.create(P,c),t[B.id]=B,a.push(B),d.push(B));var x=[];for(o=d.length,h=0;h<o;h++)B=d[h],B.confirmedActive||(r.setActive(B,!1,c),u.push(B),!B.collision.bodyA.isSleeping&&!B.collision.bodyB.isSleeping&&x.push(h));for(h=0;h<x.length;h++)E=x[h]-h,B=d[E],d.splice(E,1),delete t[B.id]},e.clear=function(i){return i.table={},i.list.length=0,i.collisionStart.length=0,i.collisionActive.length=0,i.collisionEnd.length=0,i}})()}),(function(p,M,l){var e=p.exports=l(21);e.Axes=l(11),e.Bodies=l(12),e.Body=l(4),e.Bounds=l(1),e.Collision=l(8),e.Common=l(0),e.Composite=l(6),e.Composites=l(22),e.Constraint=l(10),e.Contact=l(16),e.Detector=l(13),e.Engine=l(17),e.Events=l(5),e.Grid=l(23),e.Mouse=l(14),e.MouseConstraint=l(24),e.Pair=l(9),e.Pairs=l(19),e.Plugin=l(15),e.Query=l(25),e.Render=l(26),e.Resolver=l(18),e.Runner=l(27),e.SAT=l(28),e.Sleeping=l(7),e.Svg=l(29),e.Vector=l(2),e.Vertices=l(3),e.World=l(30),e.Engine.run=e.Runner.run,e.Common.deprecated(e.Engine,"run","Engine.run âž¤ use Matter.Runner.run(engine) instead")}),(function(p,M,l){var e={};p.exports=e;var r=l(15),s=l(0);(function(){e.name="matter-js",e.version="0.19.0",e.uses=[],e.used=[],e.use=function(){r.use(e,Array.prototype.slice.call(arguments))},e.before=function(i,f){return i=i.replace(/^Matter./,""),s.chainPathBefore(e,i,f)},e.after=function(i,f){return i=i.replace(/^Matter./,""),s.chainPathAfter(e,i,f)}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(6),s=l(10),i=l(0),f=l(4),c=l(12),d=i.deprecated;(function(){e.stack=function(o,t,n,a,u,m,P){for(var E=r.create({label:"Stack"}),B=o,h=t,x,C=0,v=0;v<a;v++){for(var I=0,w=0;w<n;w++){var b=P(B,h,w,v,x,C);if(b){var L=b.bounds.max.y-b.bounds.min.y,A=b.bounds.max.x-b.bounds.min.x;L>I&&(I=L),f.translate(b,{x:A*.5,y:L*.5}),B=b.bounds.max.x+u,r.addBody(E,b),x=b,C+=1}else B+=u}h+=I+m,B=o}return E},e.chain=function(o,t,n,a,u,m){for(var P=o.bodies,E=1;E<P.length;E++){var B=P[E-1],h=P[E],x=B.bounds.max.y-B.bounds.min.y,C=B.bounds.max.x-B.bounds.min.x,v=h.bounds.max.y-h.bounds.min.y,I=h.bounds.max.x-h.bounds.min.x,w={bodyA:B,pointA:{x:C*t,y:x*n},bodyB:h,pointB:{x:I*a,y:v*u}},b=i.extend(w,m);r.addConstraint(o,s.create(b))}return o.label+=" Chain",o},e.mesh=function(o,t,n,a,u){var m=o.bodies,P,E,B,h,x;for(P=0;P<n;P++){for(E=1;E<t;E++)B=m[E-1+P*t],h=m[E+P*t],r.addConstraint(o,s.create(i.extend({bodyA:B,bodyB:h},u)));if(P>0)for(E=0;E<t;E++)B=m[E+(P-1)*t],h=m[E+P*t],r.addConstraint(o,s.create(i.extend({bodyA:B,bodyB:h},u))),a&&E>0&&(x=m[E-1+(P-1)*t],r.addConstraint(o,s.create(i.extend({bodyA:x,bodyB:h},u)))),a&&E<t-1&&(x=m[E+1+(P-1)*t],r.addConstraint(o,s.create(i.extend({bodyA:x,bodyB:h},u))))}return o.label+=" Mesh",o},e.pyramid=function(o,t,n,a,u,m,P){return e.stack(o,t,n,a,u,m,function(E,B,h,x,C,v){var I=Math.min(a,Math.ceil(n/2)),w=C?C.bounds.max.x-C.bounds.min.x:0;if(!(x>I)){x=I-x;var b=x,L=n-1-x;if(!(h<b||h>L)){v===1&&f.translate(C,{x:(h+(n%2===1?1:-1))*w,y:0});var A=C?h*w:0;return P(o+A+h*u,B,h,x,C,v)}}})},e.newtonsCradle=function(o,t,n,a,u){for(var m=r.create({label:"Newtons Cradle"}),P=0;P<n;P++){var E=1.9,B=c.circle(o+P*(a*E),t+u,a,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),h=s.create({pointA:{x:o+P*(a*E),y:t},bodyB:B});r.addBody(m,B),r.addConstraint(m,h)}return m},d(e,"newtonsCradle","Composites.newtonsCradle âž¤ moved to newtonsCradle example"),e.car=function(o,t,n,a,u){var m=f.nextGroup(!0),P=20,E=-n*.5+P,B=n*.5-P,h=0,x=r.create({label:"Car"}),C=c.rectangle(o,t,n,a,{collisionFilter:{group:m},chamfer:{radius:a*.5},density:2e-4}),v=c.circle(o+E,t+h,u,{collisionFilter:{group:m},friction:.8}),I=c.circle(o+B,t+h,u,{collisionFilter:{group:m},friction:.8}),w=s.create({bodyB:C,pointB:{x:E,y:h},bodyA:v,stiffness:1,length:0}),b=s.create({bodyB:C,pointB:{x:B,y:h},bodyA:I,stiffness:1,length:0});return r.addBody(x,C),r.addBody(x,v),r.addBody(x,I),r.addConstraint(x,w),r.addConstraint(x,b),x},d(e,"car","Composites.car âž¤ moved to car example"),e.softBody=function(o,t,n,a,u,m,P,E,B,h){B=i.extend({inertia:1/0},B),h=i.extend({stiffness:.2,render:{type:"line",anchors:!1}},h);var x=e.stack(o,t,n,a,u,m,function(C,v){return c.circle(C,v,E,B)});return e.mesh(x,n,a,P,h),x.label="Soft Body",x},d(e,"softBody","Composites.softBody âž¤ moved to softBody and cloth examples")})()}),(function(p,M,l){var e={};p.exports=e;var r=l(9),s=l(0),i=s.deprecated;(function(){e.create=function(f){var c={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return s.extend(c,f)},e.update=function(f,c,d,o){var t,n,a,u=d.world,m=f.buckets,P,E,B=!1;for(t=0;t<c.length;t++){var h=c[t];if(!(h.isSleeping&&!o)&&!(u.bounds&&(h.bounds.max.x<u.bounds.min.x||h.bounds.min.x>u.bounds.max.x||h.bounds.max.y<u.bounds.min.y||h.bounds.min.y>u.bounds.max.y))){var x=e._getRegion(f,h);if(!h.region||x.id!==h.region.id||o){(!h.region||o)&&(h.region=x);var C=e._regionUnion(x,h.region);for(n=C.startCol;n<=C.endCol;n++)for(a=C.startRow;a<=C.endRow;a++){E=e._getBucketId(n,a),P=m[E];var v=n>=x.startCol&&n<=x.endCol&&a>=x.startRow&&a<=x.endRow,I=n>=h.region.startCol&&n<=h.region.endCol&&a>=h.region.startRow&&a<=h.region.endRow;!v&&I&&I&&P&&e._bucketRemoveBody(f,P,h),(h.region===x||v&&!I||o)&&(P||(P=e._createBucket(m,E)),e._bucketAddBody(f,P,h))}h.region=x,B=!0}}}B&&(f.pairsList=e._createActivePairsList(f))},i(e,"update","Grid.update âž¤ replaced by Matter.Detector"),e.clear=function(f){f.buckets={},f.pairs={},f.pairsList=[]},i(e,"clear","Grid.clear âž¤ replaced by Matter.Detector"),e._regionUnion=function(f,c){var d=Math.min(f.startCol,c.startCol),o=Math.max(f.endCol,c.endCol),t=Math.min(f.startRow,c.startRow),n=Math.max(f.endRow,c.endRow);return e._createRegion(d,o,t,n)},e._getRegion=function(f,c){var d=c.bounds,o=Math.floor(d.min.x/f.bucketWidth),t=Math.floor(d.max.x/f.bucketWidth),n=Math.floor(d.min.y/f.bucketHeight),a=Math.floor(d.max.y/f.bucketHeight);return e._createRegion(o,t,n,a)},e._createRegion=function(f,c,d,o){return{id:f+","+c+","+d+","+o,startCol:f,endCol:c,startRow:d,endRow:o}},e._getBucketId=function(f,c){return"C"+f+"R"+c},e._createBucket=function(f,c){var d=f[c]=[];return d},e._bucketAddBody=function(f,c,d){var o=f.pairs,t=r.id,n=c.length,a;for(a=0;a<n;a++){var u=c[a];if(!(d.id===u.id||d.isStatic&&u.isStatic)){var m=t(d,u),P=o[m];P?P[2]+=1:o[m]=[d,u,1]}}c.push(d)},e._bucketRemoveBody=function(f,c,d){var o=f.pairs,t=r.id,n;c.splice(s.indexOf(c,d),1);var a=c.length;for(n=0;n<a;n++){var u=o[t(d,c[n])];u&&(u[2]-=1)}},e._createActivePairsList=function(f){var c,d=f.pairs,o=s.keys(d),t=o.length,n=[],a;for(a=0;a<t;a++)c=d[o[a]],c[2]>0?n.push(c):delete d[o[a]];return n}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(3),s=l(7),i=l(14),f=l(5),c=l(13),d=l(10),o=l(6),t=l(0),n=l(1);(function(){e.create=function(a,u){var m=(a?a.mouse:null)||(u?u.mouse:null);m||(a&&a.render&&a.render.canvas?m=i.create(a.render.canvas):u&&u.element?m=i.create(u.element):(m=i.create(),t.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var P=d.create({label:"Mouse Constraint",pointA:m.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),E={type:"mouseConstraint",mouse:m,element:null,body:null,constraint:P,collisionFilter:{category:1,mask:4294967295,group:0}},B=t.extend(E,u);return f.on(a,"beforeUpdate",function(){var h=o.allBodies(a.world);e.update(B,h),e._triggerEvents(B)}),B},e.update=function(a,u){var m=a.mouse,P=a.constraint,E=a.body;if(m.button===0){if(P.bodyB)s.set(P.bodyB,!1),P.pointA=m.position;else for(var B=0;B<u.length;B++)if(E=u[B],n.contains(E.bounds,m.position)&&c.canCollide(E.collisionFilter,a.collisionFilter))for(var h=E.parts.length>1?1:0;h<E.parts.length;h++){var x=E.parts[h];if(r.contains(x.vertices,m.position)){P.pointA=m.position,P.bodyB=a.body=E,P.pointB={x:m.position.x-E.position.x,y:m.position.y-E.position.y},P.angleB=E.angle,s.set(E,!1),f.trigger(a,"startdrag",{mouse:m,body:E});break}}}else P.bodyB=a.body=null,P.pointB=null,E&&f.trigger(a,"enddrag",{mouse:m,body:E})},e._triggerEvents=function(a){var u=a.mouse,m=u.sourceEvents;m.mousemove&&f.trigger(a,"mousemove",{mouse:u}),m.mousedown&&f.trigger(a,"mousedown",{mouse:u}),m.mouseup&&f.trigger(a,"mouseup",{mouse:u}),i.clearSourceEvents(u)}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(2),s=l(8),i=l(1),f=l(12),c=l(3);(function(){e.collides=function(d,o){for(var t=[],n=o.length,a=d.bounds,u=s.collides,m=i.overlaps,P=0;P<n;P++){var E=o[P],B=E.parts.length,h=B===1?0:1;if(m(E.bounds,a))for(var x=h;x<B;x++){var C=E.parts[x];if(m(C.bounds,a)){var v=u(C,d);if(v){t.push(v);break}}}}return t},e.ray=function(d,o,t,n){n=n||1e-100;for(var a=r.angle(o,t),u=r.magnitude(r.sub(o,t)),m=(t.x+o.x)*.5,P=(t.y+o.y)*.5,E=f.rectangle(m,P,u,n,{angle:a}),B=e.collides(E,d),h=0;h<B.length;h+=1){var x=B[h];x.body=x.bodyB=x.bodyA}return B},e.region=function(d,o,t){for(var n=[],a=0;a<d.length;a++){var u=d[a],m=i.overlaps(u.bounds,o);(m&&!t||!m&&t)&&n.push(u)}return n},e.point=function(d,o){for(var t=[],n=0;n<d.length;n++){var a=d[n];if(i.contains(a.bounds,o))for(var u=a.parts.length===1?0:1;u<a.parts.length;u++){var m=a.parts[u];if(i.contains(m.bounds,o)&&c.contains(m.vertices,o)){t.push(a);break}}}return t}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(4),s=l(0),i=l(6),f=l(1),c=l(5),d=l(2),o=l(14);(function(){var t,n;typeof window<"u"&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(h){window.setTimeout(function(){h(s.now())},1e3/60)},n=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),e._goodFps=30,e._goodDelta=1e3/60,e.create=function(h){var x={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!h.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},C=s.extend(x,h);return C.canvas&&(C.canvas.width=C.options.width||C.canvas.width,C.canvas.height=C.options.height||C.canvas.height),C.mouse=h.mouse,C.engine=h.engine,C.canvas=C.canvas||m(C.options.width,C.options.height),C.context=C.canvas.getContext("2d"),C.textures={},C.bounds=C.bounds||{min:{x:0,y:0},max:{x:C.canvas.width,y:C.canvas.height}},C.controller=e,C.options.showBroadphase=!1,C.options.pixelRatio!==1&&e.setPixelRatio(C,C.options.pixelRatio),s.isElement(C.element)&&C.element.appendChild(C.canvas),C},e.run=function(h){(function x(C){h.frameRequestId=t(x),a(h,C),e.world(h,C),(h.options.showStats||h.options.showDebug)&&e.stats(h,h.context,C),(h.options.showPerformance||h.options.showDebug)&&e.performance(h,h.context,C)})()},e.stop=function(h){n(h.frameRequestId)},e.setPixelRatio=function(h,x){var C=h.options,v=h.canvas;x==="auto"&&(x=P(v)),C.pixelRatio=x,v.setAttribute("data-pixel-ratio",x),v.width=C.width*x,v.height=C.height*x,v.style.width=C.width+"px",v.style.height=C.height+"px"},e.lookAt=function(h,x,C,v){v=typeof v<"u"?v:!0,x=s.isArray(x)?x:[x],C=C||{x:0,y:0};for(var I={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},w=0;w<x.length;w+=1){var b=x[w],L=b.bounds?b.bounds.min:b.min||b.position||b,A=b.bounds?b.bounds.max:b.max||b.position||b;L&&A&&(L.x<I.min.x&&(I.min.x=L.x),A.x>I.max.x&&(I.max.x=A.x),L.y<I.min.y&&(I.min.y=L.y),A.y>I.max.y&&(I.max.y=A.y))}var k=I.max.x-I.min.x+2*C.x,D=I.max.y-I.min.y+2*C.y,N=h.canvas.height,O=h.canvas.width,z=O/N,H=k/D,G=1,Y=1;H>z?Y=H/z:G=z/H,h.options.hasBounds=!0,h.bounds.min.x=I.min.x,h.bounds.max.x=I.min.x+k*G,h.bounds.min.y=I.min.y,h.bounds.max.y=I.min.y+D*Y,v&&(h.bounds.min.x+=k*.5-k*G*.5,h.bounds.max.x+=k*.5-k*G*.5,h.bounds.min.y+=D*.5-D*Y*.5,h.bounds.max.y+=D*.5-D*Y*.5),h.bounds.min.x-=C.x,h.bounds.max.x-=C.x,h.bounds.min.y-=C.y,h.bounds.max.y-=C.y,h.mouse&&(o.setScale(h.mouse,{x:(h.bounds.max.x-h.bounds.min.x)/h.canvas.width,y:(h.bounds.max.y-h.bounds.min.y)/h.canvas.height}),o.setOffset(h.mouse,h.bounds.min))},e.startViewTransform=function(h){var x=h.bounds.max.x-h.bounds.min.x,C=h.bounds.max.y-h.bounds.min.y,v=x/h.options.width,I=C/h.options.height;h.context.setTransform(h.options.pixelRatio/v,0,0,h.options.pixelRatio/I,0,0),h.context.translate(-h.bounds.min.x,-h.bounds.min.y)},e.endViewTransform=function(h){h.context.setTransform(h.options.pixelRatio,0,0,h.options.pixelRatio,0,0)},e.world=function(h,x){var C=s.now(),v=h.engine,I=v.world,w=h.canvas,b=h.context,L=h.options,A=h.timing,k=i.allBodies(I),D=i.allConstraints(I),N=L.wireframes?L.wireframeBackground:L.background,O=[],z=[],H,G={timestamp:v.timing.timestamp};if(c.trigger(h,"beforeRender",G),h.currentBackground!==N&&B(h,N),b.globalCompositeOperation="source-in",b.fillStyle="transparent",b.fillRect(0,0,w.width,w.height),b.globalCompositeOperation="source-over",L.hasBounds){for(H=0;H<k.length;H++){var Y=k[H];f.overlaps(Y.bounds,h.bounds)&&O.push(Y)}for(H=0;H<D.length;H++){var $=D[H],X=$.bodyA,Z=$.bodyB,ee=$.pointA,K=$.pointB;X&&(ee=d.add(X.position,$.pointA)),Z&&(K=d.add(Z.position,$.pointB)),!(!ee||!K)&&(f.contains(h.bounds,ee)||f.contains(h.bounds,K))&&z.push($)}e.startViewTransform(h),h.mouse&&(o.setScale(h.mouse,{x:(h.bounds.max.x-h.bounds.min.x)/h.options.width,y:(h.bounds.max.y-h.bounds.min.y)/h.options.height}),o.setOffset(h.mouse,h.bounds.min))}else z=D,O=k,h.options.pixelRatio!==1&&h.context.setTransform(h.options.pixelRatio,0,0,h.options.pixelRatio,0,0);!L.wireframes||v.enableSleeping&&L.showSleeping?e.bodies(h,O,b):(L.showConvexHulls&&e.bodyConvexHulls(h,O,b),e.bodyWireframes(h,O,b)),L.showBounds&&e.bodyBounds(h,O,b),(L.showAxes||L.showAngleIndicator)&&e.bodyAxes(h,O,b),L.showPositions&&e.bodyPositions(h,O,b),L.showVelocity&&e.bodyVelocity(h,O,b),L.showIds&&e.bodyIds(h,O,b),L.showSeparations&&e.separations(h,v.pairs.list,b),L.showCollisions&&e.collisions(h,v.pairs.list,b),L.showVertexNumbers&&e.vertexNumbers(h,O,b),L.showMousePosition&&e.mousePosition(h,h.mouse,b),e.constraints(z,b),L.hasBounds&&e.endViewTransform(h),c.trigger(h,"afterRender",G),A.lastElapsed=s.now()-C},e.stats=function(h,x,C){for(var v=h.engine,I=v.world,w=i.allBodies(I),b=0,L=55,A=44,k=0,D=0,N=0;N<w.length;N+=1)b+=w[N].parts.length;var O={Part:b,Body:w.length,Cons:i.allConstraints(I).length,Comp:i.allComposites(I).length,Pair:v.pairs.list.length};x.fillStyle="#0e0f19",x.fillRect(k,D,L*5.5,A),x.font="12px Arial",x.textBaseline="top",x.textAlign="right";for(var z in O){var H=O[z];x.fillStyle="#aaa",x.fillText(z,k+L,D+8),x.fillStyle="#eee",x.fillText(H,k+L,D+26),k+=L}},e.performance=function(h,x){var C=h.engine,v=h.timing,I=v.deltaHistory,w=v.elapsedHistory,b=v.timestampElapsedHistory,L=v.engineDeltaHistory,A=v.engineElapsedHistory,k=C.timing.lastDelta,D=u(I),N=u(w),O=u(L),z=u(A),H=u(b),G=H/D||0,Y=1e3/D||0,$=4,X=12,Z=60,ee=34,K=10,ne=69;x.fillStyle="#0e0f19",x.fillRect(0,50,X*4+Z*5+22,ee),e.status(x,K,ne,Z,$,I.length,Math.round(Y)+" fps",Y/e._goodFps,function(j){return I[j]/D-1}),e.status(x,K+X+Z,ne,Z,$,L.length,k.toFixed(2)+" dt",e._goodDelta/k,function(j){return L[j]/O-1}),e.status(x,K+(X+Z)*2,ne,Z,$,A.length,z.toFixed(2)+" ut",1-z/e._goodFps,function(j){return A[j]/z-1}),e.status(x,K+(X+Z)*3,ne,Z,$,w.length,N.toFixed(2)+" rt",1-N/e._goodFps,function(j){return w[j]/N-1}),e.status(x,K+(X+Z)*4,ne,Z,$,b.length,G.toFixed(2)+" x",G*G*G,function(j){return(b[j]/I[j]/G||0)-1})},e.status=function(h,x,C,v,I,w,b,L,A){h.strokeStyle="#888",h.fillStyle="#444",h.lineWidth=1,h.fillRect(x,C+7,v,1),h.beginPath(),h.moveTo(x,C+7-I*s.clamp(.4*A(0),-2,2));for(var k=0;k<v;k+=1)h.lineTo(x+k,C+7-(k<w?I*s.clamp(.4*A(k),-2,2):0));h.stroke(),h.fillStyle="hsl("+s.clamp(25+95*L,0,120)+",100%,60%)",h.fillRect(x,C-7,4,4),h.font="12px Arial",h.textBaseline="middle",h.textAlign="right",h.fillStyle="#eee",h.fillText(b,x+v,C-5)},e.constraints=function(h,x){for(var C=x,v=0;v<h.length;v++){var I=h[v];if(!(!I.render.visible||!I.pointA||!I.pointB)){var w=I.bodyA,b=I.bodyB,L,A;if(w?L=d.add(w.position,I.pointA):L=I.pointA,I.render.type==="pin")C.beginPath(),C.arc(L.x,L.y,3,0,2*Math.PI),C.closePath();else{if(b?A=d.add(b.position,I.pointB):A=I.pointB,C.beginPath(),C.moveTo(L.x,L.y),I.render.type==="spring")for(var k=d.sub(A,L),D=d.perp(d.normalise(k)),N=Math.ceil(s.clamp(I.length/5,12,20)),O,z=1;z<N;z+=1)O=z%2===0?1:-1,C.lineTo(L.x+k.x*(z/N)+D.x*O*4,L.y+k.y*(z/N)+D.y*O*4);C.lineTo(A.x,A.y)}I.render.lineWidth&&(C.lineWidth=I.render.lineWidth,C.strokeStyle=I.render.strokeStyle,C.stroke()),I.render.anchors&&(C.fillStyle=I.render.strokeStyle,C.beginPath(),C.arc(L.x,L.y,3,0,2*Math.PI),C.arc(A.x,A.y,3,0,2*Math.PI),C.closePath(),C.fill())}}},e.bodies=function(h,x,C){var v=C;h.engine;var I=h.options,w=I.showInternalEdges||!I.wireframes,b,L,A,k;for(A=0;A<x.length;A++)if(b=x[A],!!b.render.visible){for(k=b.parts.length>1?1:0;k<b.parts.length;k++)if(L=b.parts[k],!!L.render.visible){if(I.showSleeping&&b.isSleeping?v.globalAlpha=.5*L.render.opacity:L.render.opacity!==1&&(v.globalAlpha=L.render.opacity),L.render.sprite&&L.render.sprite.texture&&!I.wireframes){var D=L.render.sprite,N=E(h,D.texture);v.translate(L.position.x,L.position.y),v.rotate(L.angle),v.drawImage(N,N.width*-D.xOffset*D.xScale,N.height*-D.yOffset*D.yScale,N.width*D.xScale,N.height*D.yScale),v.rotate(-L.angle),v.translate(-L.position.x,-L.position.y)}else{if(L.circleRadius)v.beginPath(),v.arc(L.position.x,L.position.y,L.circleRadius,0,2*Math.PI);else{v.beginPath(),v.moveTo(L.vertices[0].x,L.vertices[0].y);for(var O=1;O<L.vertices.length;O++)!L.vertices[O-1].isInternal||w?v.lineTo(L.vertices[O].x,L.vertices[O].y):v.moveTo(L.vertices[O].x,L.vertices[O].y),L.vertices[O].isInternal&&!w&&v.moveTo(L.vertices[(O+1)%L.vertices.length].x,L.vertices[(O+1)%L.vertices.length].y);v.lineTo(L.vertices[0].x,L.vertices[0].y),v.closePath()}I.wireframes?(v.lineWidth=1,v.strokeStyle="#bbb",v.stroke()):(v.fillStyle=L.render.fillStyle,L.render.lineWidth&&(v.lineWidth=L.render.lineWidth,v.strokeStyle=L.render.strokeStyle,v.stroke()),v.fill())}v.globalAlpha=1}}},e.bodyWireframes=function(h,x,C){var v=C,I=h.options.showInternalEdges,w,b,L,A,k;for(v.beginPath(),L=0;L<x.length;L++)if(w=x[L],!!w.render.visible)for(k=w.parts.length>1?1:0;k<w.parts.length;k++){for(b=w.parts[k],v.moveTo(b.vertices[0].x,b.vertices[0].y),A=1;A<b.vertices.length;A++)!b.vertices[A-1].isInternal||I?v.lineTo(b.vertices[A].x,b.vertices[A].y):v.moveTo(b.vertices[A].x,b.vertices[A].y),b.vertices[A].isInternal&&!I&&v.moveTo(b.vertices[(A+1)%b.vertices.length].x,b.vertices[(A+1)%b.vertices.length].y);v.lineTo(b.vertices[0].x,b.vertices[0].y)}v.lineWidth=1,v.strokeStyle="#bbb",v.stroke()},e.bodyConvexHulls=function(h,x,C){var v=C,I,w,b;for(v.beginPath(),w=0;w<x.length;w++)if(I=x[w],!(!I.render.visible||I.parts.length===1)){for(v.moveTo(I.vertices[0].x,I.vertices[0].y),b=1;b<I.vertices.length;b++)v.lineTo(I.vertices[b].x,I.vertices[b].y);v.lineTo(I.vertices[0].x,I.vertices[0].y)}v.lineWidth=1,v.strokeStyle="rgba(255,255,255,0.2)",v.stroke()},e.vertexNumbers=function(h,x,C){var v=C,I,w,b;for(I=0;I<x.length;I++){var L=x[I].parts;for(b=L.length>1?1:0;b<L.length;b++){var A=L[b];for(w=0;w<A.vertices.length;w++)v.fillStyle="rgba(255,255,255,0.2)",v.fillText(I+"_"+w,A.position.x+(A.vertices[w].x-A.position.x)*.8,A.position.y+(A.vertices[w].y-A.position.y)*.8)}}},e.mousePosition=function(h,x,C){var v=C;v.fillStyle="rgba(255,255,255,0.8)",v.fillText(x.position.x+"  "+x.position.y,x.position.x+5,x.position.y-5)},e.bodyBounds=function(h,x,C){var v=C;h.engine;var I=h.options;v.beginPath();for(var w=0;w<x.length;w++){var b=x[w];if(b.render.visible)for(var L=x[w].parts,A=L.length>1?1:0;A<L.length;A++){var k=L[A];v.rect(k.bounds.min.x,k.bounds.min.y,k.bounds.max.x-k.bounds.min.x,k.bounds.max.y-k.bounds.min.y)}}I.wireframes?v.strokeStyle="rgba(255,255,255,0.08)":v.strokeStyle="rgba(0,0,0,0.1)",v.lineWidth=1,v.stroke()},e.bodyAxes=function(h,x,C){var v=C;h.engine;var I=h.options,w,b,L,A;for(v.beginPath(),b=0;b<x.length;b++){var k=x[b],D=k.parts;if(k.render.visible)if(I.showAxes)for(L=D.length>1?1:0;L<D.length;L++)for(w=D[L],A=0;A<w.axes.length;A++){var N=w.axes[A];v.moveTo(w.position.x,w.position.y),v.lineTo(w.position.x+N.x*20,w.position.y+N.y*20)}else for(L=D.length>1?1:0;L<D.length;L++)for(w=D[L],A=0;A<w.axes.length;A++)v.moveTo(w.position.x,w.position.y),v.lineTo((w.vertices[0].x+w.vertices[w.vertices.length-1].x)/2,(w.vertices[0].y+w.vertices[w.vertices.length-1].y)/2)}I.wireframes?(v.strokeStyle="indianred",v.lineWidth=1):(v.strokeStyle="rgba(255, 255, 255, 0.4)",v.globalCompositeOperation="overlay",v.lineWidth=2),v.stroke(),v.globalCompositeOperation="source-over"},e.bodyPositions=function(h,x,C){var v=C;h.engine;var I=h.options,w,b,L,A;for(v.beginPath(),L=0;L<x.length;L++)if(w=x[L],!!w.render.visible)for(A=0;A<w.parts.length;A++)b=w.parts[A],v.arc(b.position.x,b.position.y,3,0,2*Math.PI,!1),v.closePath();for(I.wireframes?v.fillStyle="indianred":v.fillStyle="rgba(0,0,0,0.5)",v.fill(),v.beginPath(),L=0;L<x.length;L++)w=x[L],w.render.visible&&(v.arc(w.positionPrev.x,w.positionPrev.y,2,0,2*Math.PI,!1),v.closePath());v.fillStyle="rgba(255,165,0,0.8)",v.fill()},e.bodyVelocity=function(h,x,C){var v=C;v.beginPath();for(var I=0;I<x.length;I++){var w=x[I];if(w.render.visible){var b=r.getVelocity(w);v.moveTo(w.position.x,w.position.y),v.lineTo(w.position.x+b.x,w.position.y+b.y)}}v.lineWidth=3,v.strokeStyle="cornflowerblue",v.stroke()},e.bodyIds=function(h,x,C){var v=C,I,w;for(I=0;I<x.length;I++)if(x[I].render.visible){var b=x[I].parts;for(w=b.length>1?1:0;w<b.length;w++){var L=b[w];v.font="12px Arial",v.fillStyle="rgba(255,255,255,0.5)",v.fillText(L.id,L.position.x+10,L.position.y-10)}}},e.collisions=function(h,x,C){var v=C,I=h.options,w,b,L,A;for(v.beginPath(),L=0;L<x.length;L++)if(w=x[L],!!w.isActive)for(b=w.collision,A=0;A<w.activeContacts.length;A++){var k=w.activeContacts[A],D=k.vertex;v.rect(D.x-1.5,D.y-1.5,3.5,3.5)}for(I.wireframes?v.fillStyle="rgba(255,255,255,0.7)":v.fillStyle="orange",v.fill(),v.beginPath(),L=0;L<x.length;L++)if(w=x[L],!!w.isActive&&(b=w.collision,w.activeContacts.length>0)){var N=w.activeContacts[0].vertex.x,O=w.activeContacts[0].vertex.y;w.activeContacts.length===2&&(N=(w.activeContacts[0].vertex.x+w.activeContacts[1].vertex.x)/2,O=(w.activeContacts[0].vertex.y+w.activeContacts[1].vertex.y)/2),b.bodyB===b.supports[0].body||b.bodyA.isStatic===!0?v.moveTo(N-b.normal.x*8,O-b.normal.y*8):v.moveTo(N+b.normal.x*8,O+b.normal.y*8),v.lineTo(N,O)}I.wireframes?v.strokeStyle="rgba(255,165,0,0.7)":v.strokeStyle="orange",v.lineWidth=1,v.stroke()},e.separations=function(h,x,C){var v=C,I=h.options,w,b,L,A,k;for(v.beginPath(),k=0;k<x.length;k++)if(w=x[k],!!w.isActive){b=w.collision,L=b.bodyA,A=b.bodyB;var D=1;!A.isStatic&&!L.isStatic&&(D=.5),A.isStatic&&(D=0),v.moveTo(A.position.x,A.position.y),v.lineTo(A.position.x-b.penetration.x*D,A.position.y-b.penetration.y*D),D=1,!A.isStatic&&!L.isStatic&&(D=.5),L.isStatic&&(D=0),v.moveTo(L.position.x,L.position.y),v.lineTo(L.position.x+b.penetration.x*D,L.position.y+b.penetration.y*D)}I.wireframes?v.strokeStyle="rgba(255,165,0,0.5)":v.strokeStyle="orange",v.stroke()},e.inspector=function(h,x){h.engine;var C=h.selected,v=h.render,I=v.options,w;if(I.hasBounds){var b=v.bounds.max.x-v.bounds.min.x,L=v.bounds.max.y-v.bounds.min.y,A=b/v.options.width,k=L/v.options.height;x.scale(1/A,1/k),x.translate(-v.bounds.min.x,-v.bounds.min.y)}for(var D=0;D<C.length;D++){var N=C[D].data;switch(x.translate(.5,.5),x.lineWidth=1,x.strokeStyle="rgba(255,165,0,0.9)",x.setLineDash([1,2]),N.type){case"body":w=N.bounds,x.beginPath(),x.rect(Math.floor(w.min.x-3),Math.floor(w.min.y-3),Math.floor(w.max.x-w.min.x+6),Math.floor(w.max.y-w.min.y+6)),x.closePath(),x.stroke();break;case"constraint":var O=N.pointA;N.bodyA&&(O=N.pointB),x.beginPath(),x.arc(O.x,O.y,10,0,2*Math.PI),x.closePath(),x.stroke();break}x.setLineDash([]),x.translate(-.5,-.5)}h.selectStart!==null&&(x.translate(.5,.5),x.lineWidth=1,x.strokeStyle="rgba(255,165,0,0.6)",x.fillStyle="rgba(255,165,0,0.1)",w=h.selectBounds,x.beginPath(),x.rect(Math.floor(w.min.x),Math.floor(w.min.y),Math.floor(w.max.x-w.min.x),Math.floor(w.max.y-w.min.y)),x.closePath(),x.stroke(),x.fill(),x.translate(-.5,-.5)),I.hasBounds&&x.setTransform(1,0,0,1,0,0)};var a=function(h,x){var C=h.engine,v=h.timing,I=v.historySize,w=C.timing.timestamp;v.delta=x-v.lastTime||e._goodDelta,v.lastTime=x,v.timestampElapsed=w-v.lastTimestamp||0,v.lastTimestamp=w,v.deltaHistory.unshift(v.delta),v.deltaHistory.length=Math.min(v.deltaHistory.length,I),v.engineDeltaHistory.unshift(C.timing.lastDelta),v.engineDeltaHistory.length=Math.min(v.engineDeltaHistory.length,I),v.timestampElapsedHistory.unshift(v.timestampElapsed),v.timestampElapsedHistory.length=Math.min(v.timestampElapsedHistory.length,I),v.engineElapsedHistory.unshift(C.timing.lastElapsed),v.engineElapsedHistory.length=Math.min(v.engineElapsedHistory.length,I),v.elapsedHistory.unshift(v.lastElapsed),v.elapsedHistory.length=Math.min(v.elapsedHistory.length,I)},u=function(h){for(var x=0,C=0;C<h.length;C+=1)x+=h[C];return x/h.length||0},m=function(h,x){var C=document.createElement("canvas");return C.width=h,C.height=x,C.oncontextmenu=function(){return!1},C.onselectstart=function(){return!1},C},P=function(h){var x=h.getContext("2d"),C=window.devicePixelRatio||1,v=x.webkitBackingStorePixelRatio||x.mozBackingStorePixelRatio||x.msBackingStorePixelRatio||x.oBackingStorePixelRatio||x.backingStorePixelRatio||1;return C/v},E=function(h,x){var C=h.textures[x];return C||(C=h.textures[x]=new Image,C.src=x,C)},B=function(h,x){var C=x;/(jpg|gif|png)$/.test(x)&&(C="url("+x+")"),h.canvas.style.background=C,h.canvas.style.backgroundSize="contain",h.currentBackground=x}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(5),s=l(17),i=l(0);(function(){var f,c;if(typeof window<"u"&&(f=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,c=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),!f){var d;f=function(o){d=setTimeout(function(){o(i.now())},1e3/60)},c=function(){clearTimeout(d)}}e.create=function(o){var t={fps:60,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,frameRequestId:null,isFixed:!1,enabled:!0},n=i.extend(t,o);return n.delta=n.delta||1e3/n.fps,n.deltaMin=n.deltaMin||1e3/n.fps,n.deltaMax=n.deltaMax||1e3/(n.fps*.5),n.fps=1e3/n.delta,n},e.run=function(o,t){return typeof o.positionIterations<"u"&&(t=o,o=e.create()),(function n(a){o.frameRequestId=f(n),a&&o.enabled&&e.tick(o,t,a)})(),o},e.tick=function(o,t,n){var a=t.timing,u;o.isFixed?u=o.delta:(u=n-o.timePrev||o.delta,o.timePrev=n,o.deltaHistory.push(u),o.deltaHistory=o.deltaHistory.slice(-o.deltaSampleSize),u=Math.min.apply(null,o.deltaHistory),u=u<o.deltaMin?o.deltaMin:u,u=u>o.deltaMax?o.deltaMax:u,o.delta=u);var m={timestamp:a.timestamp};r.trigger(o,"beforeTick",m),o.frameCounter+=1,n-o.counterTimestamp>=1e3&&(o.fps=o.frameCounter*((n-o.counterTimestamp)/1e3),o.counterTimestamp=n,o.frameCounter=0),r.trigger(o,"tick",m),r.trigger(o,"beforeUpdate",m),s.update(t,u),r.trigger(o,"afterUpdate",m),r.trigger(o,"afterTick",m)},e.stop=function(o){c(o.frameRequestId)},e.start=function(o,t){e.run(o,t)}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(8),s=l(0),i=s.deprecated;(function(){e.collides=function(f,c){return r.collides(f,c)},i(e,"collides","SAT.collides âž¤ replaced by Collision.collides")})()}),(function(p,M,l){var e={};p.exports=e,l(1);var r=l(0);(function(){e.pathToVertices=function(s,i){typeof window<"u"&&!("SVGPathSeg"in window)&&r.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var f,c,d,o,t,n,a,u,m,P,E=[],B,h,x=0,C=0,v=0;i=i||15;var I=function(b,L,A){var k=A%2===1&&A>1;if(!m||b!=m.x||L!=m.y){m&&k?(B=m.x,h=m.y):(B=0,h=0);var D={x:B+b,y:h+L};(k||!m)&&(m=D),E.push(D),C=B+b,v=h+L}},w=function(b){var L=b.pathSegTypeAsLetter.toUpperCase();if(L!=="Z"){switch(L){case"M":case"L":case"T":case"C":case"S":case"Q":C=b.x,v=b.y;break;case"H":C=b.x;break;case"V":v=b.y;break}I(C,v,b.pathSegType)}};for(e._svgPathToAbsolute(s),d=s.getTotalLength(),n=[],f=0;f<s.pathSegList.numberOfItems;f+=1)n.push(s.pathSegList.getItem(f));for(a=n.concat();x<d;){if(P=s.getPathSegAtLength(x),t=n[P],t!=u){for(;a.length&&a[0]!=t;)w(a.shift());u=t}switch(t.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":o=s.getPointAtLength(x),I(o.x,o.y,0);break}x+=i}for(f=0,c=a.length;f<c;++f)w(a[f]);return E},e._svgPathToAbsolute=function(s){for(var i,f,c,d,o,t,n=s.pathSegList,a=0,u=0,m=n.numberOfItems,P=0;P<m;++P){var E=n.getItem(P),B=E.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(B))"x"in E&&(a=E.x),"y"in E&&(u=E.y);else switch("x1"in E&&(c=a+E.x1),"x2"in E&&(o=a+E.x2),"y1"in E&&(d=u+E.y1),"y2"in E&&(t=u+E.y2),"x"in E&&(a+=E.x),"y"in E&&(u+=E.y),B){case"m":n.replaceItem(s.createSVGPathSegMovetoAbs(a,u),P);break;case"l":n.replaceItem(s.createSVGPathSegLinetoAbs(a,u),P);break;case"h":n.replaceItem(s.createSVGPathSegLinetoHorizontalAbs(a),P);break;case"v":n.replaceItem(s.createSVGPathSegLinetoVerticalAbs(u),P);break;case"c":n.replaceItem(s.createSVGPathSegCurvetoCubicAbs(a,u,c,d,o,t),P);break;case"s":n.replaceItem(s.createSVGPathSegCurvetoCubicSmoothAbs(a,u,o,t),P);break;case"q":n.replaceItem(s.createSVGPathSegCurvetoQuadraticAbs(a,u,c,d),P);break;case"t":n.replaceItem(s.createSVGPathSegCurvetoQuadraticSmoothAbs(a,u),P);break;case"a":n.replaceItem(s.createSVGPathSegArcAbs(a,u,E.r1,E.r2,E.angle,E.largeArcFlag,E.sweepFlag),P);break;case"z":case"Z":a=i,u=f;break}(B=="M"||B=="m")&&(i=a,f=u)}}})()}),(function(p,M,l){var e={};p.exports=e;var r=l(6);l(0),(function(){e.create=r.create,e.add=r.add,e.remove=r.remove,e.clear=r.clear,e.addComposite=r.addComposite,e.addBody=r.addBody,e.addConstraint=r.addConstraint})()})])})})(ue)),ue.exports}var ke=De();const U=be(ke),F={engine:null,render:null,world:null,runner:null,isInitialized:!1,isRunning:!1,init:function(g,y,p){if(F.isInitialized){F.render&&(F.render.options.width!==y||F.render.options.height!==p)&&(console.log(`Resizing physics renderer to ${y}x${p}`),F.render.bounds.max.x=y,F.render.bounds.max.y=p,F.render.options.width=y,F.render.options.height=p,F.render.canvas.width=y,F.render.canvas.height=p,F.updateWallPositions(y,p)),F.start();return}if(console.log(`Initializing Physics Engine: ${y}x${p}`),!g||isNaN(y)||isNaN(p)||y<=0||p<=0){console.error("Cannot initialize Physics: Invalid canvas or dimensions.");return}const M={enableSleeping:!0,positionIterations:8,velocityIterations:6};F.engine=U.Engine.create(M),F.world=F.engine.world,F.engine.world.gravity.y=.7,F.render=U.Render.create({element:g.parentNode,canvas:g,engine:F.engine,options:{width:y,height:p,wireframes:!1,background:"transparent",showSleeping:!1,pixelRatio:window.devicePixelRatio||1}}),F.createWalls(y,p),F.runner=U.Runner.create(),U.Runner.run(F.runner,F.engine),U.Render.run(F.render),F.isInitialized=!0,F.isRunning=!0,console.log("Physics engine initialized and running.")},createWalls:function(g,y){if(!F.world)return;const p=U.Composite.allBodies(F.world).filter(i=>i.isStatic);p.length>0&&U.World.remove(F.world,p);const M=R.SAND_COLORS.length,l=g/M,e=15,r=[],s={isStatic:!0,friction:.6,restitution:.1,render:{visible:!1}};r.push(U.Bodies.rectangle(g/2,y+e/2,g+e*2,e,s)),r.push(U.Bodies.rectangle(-e/2,y/2,e,y+e*2,s)),r.push(U.Bodies.rectangle(g+e/2,y/2,e,y+e*2,s));for(let i=1;i<M;i++){const f=i*l;r.push(U.Bodies.rectangle(f,y/2,e,y+e*2,s))}U.World.add(F.world,r)},updateWallPositions:function(g,y){F.createWalls(g,y)},addParticle:function(g,y){if(!F.isInitialized||!F.engine||!F.render?.options?.width||g<0||g>=R.SAND_COLORS.length)return;const p=R.SAND_COLORS.length,M=F.render.options.width/p,l=S.preferences?.sandParticleSize||5,e=15,r=l*.5,s=g*M,i=s+e/2+l+r,f=s+M-e/2-l-r;if(i>=f)return;const c=i+Math.random()*(f-i),d=-l*2,o=U.Bodies.polygon(c,d,6,l,{restitution:.15,friction:.7,frictionAir:.01,density:.01,render:{fillStyle:y},sleepThreshold:60});U.Body.setVelocity(o,{x:(Math.random()-.5)*.1,y:Math.random()*.1}),U.Body.setAngularVelocity(o,(Math.random()-.5)*.01),U.World.add(F.world,o)},clearDynamicBodies:function(){if(!F.world)return;const y=U.Composite.allBodies(F.world).filter(p=>!p.isStatic);y.length>0&&U.World.remove(F.world,y)},stop:function(){F.isRunning&&(F.runner&&U.Runner.stop(F.runner),F.render&&U.Render.stop(F.render),F.isRunning=!1)},start:function(){F.isRunning||!F.isInitialized||(F.render&&U.Render.run(F.render),F.runner&&F.engine?(U.Runner.run(F.runner,F.engine),F.isRunning=!0):console.error("Cannot start physics, not initialized."))},destroy:function(){console.log("Destroying physics engine..."),F.stop(),F.world&&U.World.clear(F.world,!1),F.engine&&U.Engine.clear(F.engine),F.engine=null,F.world=null,F.render=null,F.runner=null,F.isInitialized=!1,F.isRunning=!1,console.log("Physics engine destroyed.")}},Q={update:function(g){S.preferences.showScheduleCircles?Q.renderScheduleCircles():T.scheduleCirclesDisplayEl&&(T.scheduleCirclesDisplayEl.innerHTML="")},renderScheduleCircles:function(){if(!S.preferences.showScheduleCircles||!T.scheduleCirclesDisplayEl){T.scheduleCirclesDisplayEl&&(T.scheduleCirclesDisplayEl.innerHTML="");return}const g=se(),y=V.getCurrentPeriodInfo(g),p=S.getActiveColourScheme(),M=(S.schedule||[]).map((r,s)=>({...r,originalIndex:s})).filter(r=>r.showCircles);if(M.length===0){T.scheduleCirclesDisplayEl.innerHTML="";return}let l=-1;y&&(l=M.findIndex(r=>r.originalIndex===y.index));let e="";for(let r=0;r<M.length;r++){const s=l>=r,i=s?"â—":"â—‹",f=`schedule-circle-symbol ${s?"active":"inactive"}`,c=s?p.text:"#555";e+=`<span class="${f}" style="color: ${c};">${i}</span>`}T.scheduleCirclesDisplayEl.innerHTML=e},setupPhysicsSandBars:function(g){if(Q.stopPhysicsCheckInterval(),F.clearDynamicBodies(),R.physicsParticlesAdded=0,R.totalParticlesForPeriod=0,!S.preferences.showSandBars||!T.sandBarsCanvas||!T.sandBarsContainerEl){F.stop();return}const y=S.preferences?.sandHeight||150,p=S.preferences?.sandWidth||80;T.sandBarsContainerEl.style.height=`${y}px`,T.sandBarsContainerEl.style.width=`${p}%`,requestAnimationFrame(()=>{const M=T.sandBarsContainerEl.offsetWidth,l=T.sandBarsContainerEl.offsetHeight;if(M<=0||l<=0){console.warn("Sand bars container has zero dimensions after rAF. Aborting physics setup."),F.stop();return}const e=S.preferences?.sandParticleSize||5,r=3*Math.sqrt(3)/2*e*e,s=M/R.SAND_COLORS.length,f=Math.max(0,s-15),c=Math.max(0,l-e),d=f*c,o=.85;R.visualMaxParticlesPerSegment=Math.max(10,Math.floor(d*o/r)),R.totalParticlesForPeriod=R.visualMaxParticlesPerSegment*R.SAND_COLORS.length,console.log(`Est. Max Particles Per Segment (Hex): ${R.visualMaxParticlesPerSegment}, Total Target: ${R.totalParticlesForPeriod}, Particle Area: ${r.toFixed(2)}`),F.init(T.sandBarsCanvas,M,l),F.start(),Q.handleColorSchemeChange();const t=V.getCurrentPeriodInfo(se());if(t){const n=t.start.getTime();t.end.getTime()-n>0?(Q.checkAndAddParticles(),R.physicsCheckIntervalId=setInterval(Q.checkAndAddParticles,R.physicsCheckIntervalMs)):(console.log("Period duration is zero or negative, stopping physics."),F.stop())}else console.log("No current period found, stopping physics."),F.stop()})},checkAndAddParticles:function(){if(!S.preferences.showSandBars||!F.isRunning||R.totalParticlesForPeriod<=0){Q.stopPhysicsCheckInterval();return}const g=se(),y=V.getCurrentPeriodInfo(g);if(!y){Q.stopPhysicsCheckInterval();return}const p=y.start.getTime(),l=y.end.getTime()-p;if(l<=0){Q.stopPhysicsCheckInterval();return}const e=Math.max(0,g.getTime()-p),r=Math.min(1,e/l),i=Math.floor(r*R.totalParticlesForPeriod)-R.physicsParticlesAdded,f=5;for(let c=0;c<Math.min(i,f)&&!(R.physicsParticlesAdded>=R.totalParticlesForPeriod);++c){const d=l/R.SAND_COLORS.length,t=(R.physicsParticlesAdded+.5)/R.totalParticlesForPeriod*l,n=Math.min(R.SAND_COLORS.length-1,Math.floor(t/d));n>=0&&(F.addParticle(n,R.SAND_COLORS[n]),R.physicsParticlesAdded++)}R.physicsParticlesAdded>=R.totalParticlesForPeriod&&Q.stopPhysicsCheckInterval()},stopPhysicsCheckInterval:function(){R.physicsCheckIntervalId&&(clearInterval(R.physicsCheckIntervalId),R.physicsCheckIntervalId=null)},handlePeriodChange:function(g){console.log("Handling period change for physics sand bars."),Q.setupPhysicsSandBars(g)},handleDisplayToggle:function(){console.log("Handling display toggle for physics sand bars.");const g=V.getCurrentPeriodInfo(se());Q.setupPhysicsSandBars(g)},handleColorSchemeChange:function(){T.sandBarsContainerEl&&S.getActiveColourScheme().text,S.preferences.showScheduleCircles&&Q.renderScheduleCircles()}},ie={update:function(){const g=S.preferences;if(!T.clockDisplayArea){console.warn("DOM cache not ready in Layout.update");return}[{el:T.dateEl,pref:"showDate"},{el:T.scheduleCirclesDisplayEl,pref:"showScheduleCircles"},{el:T.timeEl,pref:"showTime"}].forEach(e=>{e.el?.classList.toggle("element-hidden",!g[e.pref])});const p=g.showScheduleLabel||g.showProgressBar||g.showSandBars;T.periodContainerEl?.classList.toggle("element-hidden",!p),p?T.periodLabelEl?.classList.toggle("element-hidden",!g.showScheduleLabel):T.periodLabelEl?.classList.add("element-hidden");const M=g.showProgressBar&&!g.showSandBars,l=g.showSandBars;T.progressBarEl?.classList.toggle("element-hidden",!M),T.sandBarsContainerEl?.classList.toggle("element-hidden",!l),T.sandBarsCanvas&&(T.sandBarsCanvas.style.display=l?"block":"none"),ie.applyFontAndSizePreferences()},applyFontAndSizePreferences:function(){const g=S.preferences;S.getActiveColourScheme(),T.clockDisplayArea&&(g.showDate&&T.dateEl&&(T.dateEl.style.fontSize=g.dateFontSize+"px"),g.showTime&&T.timeEl&&(T.timeEl.style.fontSize=g.timeFontSize+"px"),g.showScheduleLabel&&T.periodLabelEl&&(T.periodLabelEl.style.fontSize=g.scheduleLabelFontSize+"px"),g.showProgressBar&&!g.showSandBars&&(T.timeLeftEl&&(T.timeLeftEl.style.fontSize=g.timeLeftFontSize+"px"),T.progressBarEl&&(T.progressBarEl.style.height=g.progressBarHeight+"px")),document.body.style.fontFamily=g.fontFamily,g.showScheduleCircles&&T.scheduleCirclesDisplayEl&&Q.renderScheduleCircles())}},W={attachListeners:function(){T.addScheduleRowBtn?.addEventListener("click",W.addRow),T.deleteScheduleRowBtn?.addEventListener("click",W.deleteRow)},renderTable:function(){const g=T.scheduleTableBody;if(!g){console.error("Schedule table body not found");return}g.innerHTML="",(S.schedule||[]).forEach((p,M)=>{const l=document.createElement("tr");l.dataset.index=M,l.setAttribute("draggable","true"),M===R.selectedScheduleRowIndex&&l.classList.add("selected"),l.appendChild(W.createDragCell()),l.appendChild(W.createLabelCell(p,M)),l.appendChild(W.createTimeCell(p,M,"start")),l.appendChild(W.createTimeCell(p,M,"end")),l.appendChild(W.createSchemeCell(p,M)),l.appendChild(W.createAlertCell(p,M)),l.appendChild(W.createCirclesCell(p,M)),l.addEventListener("click",W.handleRowClick),l.addEventListener("dragstart",W.handleDragStart),l.addEventListener("dragover",W.handleDragOver),l.addEventListener("dragleave",W.handleDragLeave),l.addEventListener("drop",W.handleDrop),l.addEventListener("dragend",W.handleDragEnd),g.appendChild(l)}),g.removeEventListener("dragleave",W.handleTableDragLeave),g.addEventListener("dragleave",W.handleTableDragLeave)},createDragCell:function(){const g=document.createElement("td");return g.innerHTML="â˜°",g.className="drag-handle",g.title="Drag to reorder",g},createLabelCell:function(g,y){const p=document.createElement("td"),M=document.createElement("input");return M.type="text",M.value=g.label||"",M.placeholder="Period Label",M.addEventListener("change",function(){S.schedule&&S.schedule[y]&&(S.schedule[y].label=this.value,S.save(),V.update())}),p.appendChild(M),p},createTimeCell:function(g,y,p){const M=document.createElement("td"),l=document.createElement("input");return l.type="time",l.value=g[p]||"00:00",l.addEventListener("change",function(){S.schedule&&S.schedule[y]&&(S.schedule[y][p]=this.value,S.save(),V.update())}),M.appendChild(l),M},createSchemeCell:function(g,y){const p=document.createElement("td"),M=document.createElement("div");M.className="scheme-swatch";const l=S.preferences?.colourSchemes||[],e=l.find(r=>r.id===g.colourSchemeId)||l.find(r=>r.id===1)||l[0];return M.style.backgroundColor=e?e.background:"#ff00ff",M.style.borderColor=e?e.text:"#ffffff",M.title=`Scheme: ${e?e.name:"Unknown"} (ID: ${g.colourSchemeId}). Click to cycle.`,M.addEventListener("click",r=>{r.stopPropagation(),W.cycleSchemeForRow(y)}),p.appendChild(M),p},createAlertCell:function(g,y){const p=document.createElement("td"),M=document.createElement("button"),l=S.alerts[y]?.colour?.enabled||!1;return M.innerHTML=l?"ðŸ”´":"ðŸŸ¢",M.title=`Visual Alert: ${l?"Enabled":"Disabled"}. Click to edit.`,M.className="alert-edit-btn",M.addEventListener("click",e=>{e.stopPropagation(),q.openModal(y)}),p.appendChild(M),p.style.textAlign="center",p},createCirclesCell:function(g,y){const p=document.createElement("td"),M=document.createElement("input");return M.type="checkbox",M.checked=g.showCircles||!1,M.title="Show this period in the Schedule Circles display",M.addEventListener("change",function(l){l.stopPropagation(),S.schedule&&S.schedule[y]&&(S.schedule[y].showCircles=this.checked,S.save(),Q.renderScheduleCircles())}),p.appendChild(M),p.style.textAlign="center",p},handleRowClick:function(g){const y=parseInt(this.dataset.index,10);if(g.target.tagName==="INPUT"||g.target.tagName==="BUTTON"||g.target.classList.contains("scheme-swatch")||g.target.classList.contains("drag-handle")){if(this.classList.contains("selected")){R.selectedScheduleRowIndex=y;return}}else{const p=T.scheduleTableBody?.querySelector("tr.selected");p&&p.classList.remove("selected"),this.classList.add("selected"),R.selectedScheduleRowIndex=y}},cycleSchemeForRow:function(g){if(!S.schedule||g<0||g>=S.schedule.length)return;const y=S.schedule[g].colourSchemeId||1,p=S.preferences?.colourSchemes||[];if(p.length===0)return;let l=(p.findIndex(e=>e.id===y)+1)%p.length;S.schedule[g].colourSchemeId=p[l]?.id||p[0]?.id||1,S.save(),W.renderTable(),V.update()},addRow:function(){const g={label:"New Period",start:"00:00",end:"00:00",colourSchemeId:1,showCircles:!1},y=R.selectedScheduleRowIndex===null||R.selectedScheduleRowIndex<0||R.selectedScheduleRowIndex>=S.schedule.length?S.schedule.length:R.selectedScheduleRowIndex+1;S.schedule.splice(y,0,g);const p={};Object.keys(S.alerts).forEach(M=>{const l=parseInt(M,10);p[l>=y?l+1:l]=S.alerts[M]}),S.alerts=p,R.selectedScheduleRowIndex=y,W.renderTable(),S.save()},deleteRow:function(){const g=R.selectedScheduleRowIndex;if(g!==null&&g>=0&&g<S.schedule.length){if(confirm(`Delete row "${S.schedule[g].label}"?`)){S.schedule.splice(g,1),delete S.alerts[g];const y={};Object.keys(S.alerts).forEach(p=>{const M=parseInt(p,10);y[M>g?M-1:M]=S.alerts[p]}),S.alerts=y,R.selectedScheduleRowIndex=null,W.renderTable(),S.save(),V.update()}}else J.showButtonFeedback(T.deleteScheduleRowBtn,"Select Row First!",2e3)},handleDragStart:function(g){if(R.dragStartIndex=parseInt(this.dataset.index,10),!isNaN(R.dragStartIndex)&&(g.dataTransfer.effectAllowed="move",g.dataTransfer.setData("text/plain",R.dragStartIndex),this.classList.add("dragging"),!this.classList.contains("selected"))){const y=T.scheduleTableBody?.querySelector("tr.selected");y&&y.classList.remove("selected"),this.classList.add("selected"),R.selectedScheduleRowIndex=R.dragStartIndex}},handleDragOver:function(g){g.preventDefault(),g.dataTransfer.dropEffect="move",this.classList.add("drag-over")},handleDragLeave:function(g){this.classList.remove("drag-over")},handleDrop:function(g){g.preventDefault(),this.classList.remove("drag-over");const y=parseInt(this.dataset.index,10),p=R.dragStartIndex;if(p!==null&&!isNaN(y)&&p!==y){const M=S.schedule.splice(p,1)[0];S.schedule.splice(y,0,M);const l=S.alerts[p],e={};Object.keys(S.alerts).forEach(r=>{const s=parseInt(r,10);if(s===p)return;let i=s;p<s&&y>=s?i--:p>s&&y<=s&&i++,e[i]=S.alerts[r]}),l&&(e[y]=l),S.alerts=e,R.selectedScheduleRowIndex=y,W.renderTable(),S.save(),V.update()}R.dragStartIndex=null},handleDragEnd:function(g){this.classList.remove("dragging"),document.querySelectorAll("#schedule-table tbody tr.drag-over").forEach(y=>{y.classList.remove("drag-over")}),R.dragStartIndex=null},handleTableDragLeave:function(g){T.scheduleTableBody&&!T.scheduleTableBody.contains(g.relatedTarget)&&document.querySelectorAll("#schedule-table tbody tr.drag-over").forEach(y=>{y.classList.remove("drag-over")})}},q={attachListeners:function(){T.alertModal?.addEventListener("click",g=>{(g.target===T.alertModal||T.closeModalBtn&&g.target===T.closeModalBtn)&&q.closeModal()})},openModal:function(g){if(g===null||g<0||!S.schedule||g>=S.schedule.length)return;const y=S.schedule[g]?.label||`Row ${g+1}`;T.alertModalTitle&&(T.alertModalTitle.textContent=`Visual Alert Settings for "${y}"`),q.renderModalForm(g),T.alertModal&&(T.alertModal.style.display="block")},closeModal:function(){T.alertModal&&(T.alertModal.style.display="none"),T.alertModalBody&&(T.alertModalBody.innerHTML="")},renderModalForm:function(g){if(!T.alertModalBody||!S.schedule||g>=S.schedule.length)return;const y=S.defaultPreferences?.defaultAlertSettings?.colour||{},p=S.alerts[g]?.colour||{},M={...y,...p},l=M.durationMs||y.durationMs||1500,e=M.intervalMs||y.intervalMs||500,r=l/1e3,s=!!S.alerts[g]?.colour;T.alertModalBody.innerHTML=`
            <div class="alert-settings-form" data-index="${g}">
            <label><input type="checkbox" id="alert-colour-enabled" ${M.enabled?"checked":""}> Enable Visual Alert</label><hr>
            <label>Flash Background Colour: <input type="color" id="alert-bg-color" value="${M.background}"></label>
            <label>Flash Text Colour: <input type="color" id="alert-label-color" value="${M.text}"></label>
            <label>Flash Duration (s): <input type="number" id="alert-flash-duration-sec" min="0.5" max="10" step="0.1" value="${r.toFixed(1)}"></label>
            <label>Flash Interval (ms): <input type="number" id="alert-flash-interval" min="100" max="2000" step="50" value="${e}"></label>
            <div class="button-group">
                <button id="save-alert" data-option="colour">Save Visual Alert</button>
                <button id="preview-alert" data-option="colour">Preview Flash</button>
                <button id="remove-alert" data-option="colour" ${s?"":"disabled"}>${M.enabled?"Disable Alert":s?"Remove Custom Settings":"Using Defaults"}</button>
            </div>
            <div class="feedback-message" style="display: none;"></div></div>`;const i=T.alertModalBody.querySelector(".alert-settings-form");i?.querySelector("#alert-colour-enabled")?.addEventListener("change",q.handleModalEnableToggle),i?.querySelector("#save-alert")?.addEventListener("click",q.handleModalSave),i?.querySelector("#preview-alert")?.addEventListener("click",q.handleModalPreview),i?.querySelector("#remove-alert")?.addEventListener("click",q.handleModalRemove),q.updateModalControlsState(i,M.enabled,s)},handleModalEnableToggle:function(g){const y=g.target.closest(".alert-settings-form"),p=g.target.checked,M=parseInt(y.dataset.index,10);q.updateModalControlsState(y,p,!!S.alerts[M]?.colour)},updateModalControlsState:function(g,y,p){if(!g)return;const M=g.querySelectorAll('input[type="color"], input[type="number"]'),l=g.querySelector("#preview-alert"),e=g.querySelector("#remove-alert");M.forEach(r=>r.disabled=!y),l&&(l.disabled=!y),e&&(e.disabled=!p,e.textContent=y?"Disable Alert":p?"Remove Custom Settings":"Using Defaults")},handleModalSave:function(){const g=this.closest(".alert-settings-form");if(!g)return;const y=parseInt(g.dataset.index,10);if(isNaN(y))return;const p=g.querySelector("#alert-colour-enabled"),M=g.querySelector("#alert-flash-duration-sec"),l=g.querySelector("#alert-flash-interval"),e=g.querySelector("#alert-bg-color"),r=g.querySelector("#alert-label-color");if(g.querySelector(".feedback-message"),!p||!M||!l||!e||!r){console.error("Modal form elements not found for saving.");return}S.alerts[y]||(S.alerts[y]={});const s=S.defaultPreferences?.defaultAlertSettings?.colour||{},i=s.durationMs||1500,f=s.intervalMs||500;let c=parseFloat(M.value);c=isNaN(c)?i/1e3:Math.max(.5,Math.min(10,c));let d=parseInt(l.value,10);d=isNaN(d)?f:Math.max(100,Math.min(2e3,d));let o={enabled:p.checked,background:e.value||s.background||"#ff0000",text:r.value||s.text||"#ffffff",durationMs:Math.round(c*1e3),intervalMs:d};S.alerts[y].colour=o,S.save(),W.renderTable(),J.showButtonFeedback(this,"Saved!"),setTimeout(q.closeModal,1600)},handleModalPreview:function(){const g=this.closest(".alert-settings-form");if(!g)return;const y=g.querySelector("#alert-colour-enabled"),p=g.querySelector(".feedback-message");if(!y||!y.checked){J.showFeedback(p,"Enable the alert first to preview.",!1);return}const M=parseFloat(g.querySelector("#alert-flash-duration-sec")?.value),l=parseInt(g.querySelector("#alert-flash-interval")?.value,10);if(isNaN(M)||isNaN(l)){J.showFeedback(p,"Invalid duration or interval value.",!1);return}let e={enabled:!0,background:g.querySelector("#alert-bg-color")?.value||"#ff0000",text:g.querySelector("#alert-label-color")?.value||"#ffffff",durationMs:Math.round(M*1e3),intervalMs:l};q.triggerVisualAlert(e),J.showFeedback(p,"Previewing flash...",!0)},handleModalRemove:function(){const g=this.closest(".alert-settings-form");if(!g)return;const y=parseInt(g.dataset.index,10),p=g.querySelector("#alert-colour-enabled"),M=g.querySelector(".feedback-message");isNaN(y)||y>=S.schedule.length||(S.alerts[y]?.colour?p.checked?(p.checked=!1,q.updateModalControlsState(g,!1,!0),J.showFeedback(M,"Alert disabled. Click Save to confirm.",!0)):confirm(`Remove custom visual alert settings for "${S.schedule[y].label}"? It will revert to defaults.`)&&(delete S.alerts[y].colour,Object.keys(S.alerts[y]).length===0&&delete S.alerts[y],S.save(),W.renderTable(),q.closeModal()):(J.showFeedback(M,"No custom settings to remove. Using defaults.",!0),this&&(this.disabled=!0,this.textContent="Using Defaults")))},triggerVisualAlert:function(g){q.clearVisualAlert();const{background:y,text:p,durationMs:M,intervalMs:l}=g,e=S.getActiveColourScheme();R.originalBodyStyles={background:document.body.style.backgroundColor,color:document.body.style.color,timeColor:T.timeEl?.style.color||"",dateColor:T.dateEl?.style.color||"",labelColor:T.periodLabelEl?.style.color||"",progressColor:T.progressEl?.style.backgroundColor||"",timeLeftColor:T.timeLeftEl?.style.color||""};let r=!1;const s=()=>{r=!r;const i=r?y:e.background,f=r?p:e.text;document.body.style.backgroundColor=i,document.body.style.color=f,T.timeEl&&S.preferences.showTime&&(T.timeEl.style.color=f),T.dateEl&&S.preferences.showDate&&(T.dateEl.style.color=f),T.periodLabelEl&&S.preferences.showScheduleLabel&&(T.periodLabelEl.style.color=f),T.progressEl&&S.preferences.showProgressBar&&!S.preferences.showSandBars&&(T.progressEl.style.backgroundColor=f),T.timeLeftEl&&S.preferences.showProgressBar&&!S.preferences.showSandBars&&(T.timeLeftEl.style.color=f),T.scheduleCirclesDisplayEl&&S.preferences.showScheduleCircles&&T.scheduleCirclesDisplayEl.querySelectorAll(".schedule-circle-symbol.active").forEach(c=>c.style.color=f)};s(),R.activeVisualAlertInterval=setInterval(s,l),R.activeVisualAlertTimeout=setTimeout(()=>{q.clearVisualAlert(),q.restoreOriginalStyles(e)},M)},clearVisualAlert:function(){clearTimeout(R.activeVisualAlertTimeout),clearInterval(R.activeVisualAlertInterval),R.activeVisualAlertInterval=null,R.activeVisualAlertTimeout=null},restoreOriginalStyles:function(g=null){const y=g||S.getActiveColourScheme();document.body.style.backgroundColor=y.background,document.body.style.color=y.text,T.timeEl&&S.preferences.showTime&&(T.timeEl.style.color=y.text),T.dateEl&&S.preferences.showDate&&(T.dateEl.style.color=y.text),T.periodLabelEl&&S.preferences.showScheduleLabel&&(T.periodLabelEl.style.color=y.text),T.progressEl&&S.preferences.showProgressBar&&!S.preferences.showSandBars&&(T.progressEl.style.backgroundColor=y.text),T.timeLeftEl&&S.preferences.showProgressBar&&!S.preferences.showSandBars&&(T.timeLeftEl.style.color=y.text),S.preferences.showScheduleCircles&&Q.renderScheduleCircles()}},V={updateIntervalId:null,start:function(){V.updateIntervalId&&clearInterval(V.updateIntervalId),V.updateIntervalId=setInterval(V.update,1e3),V.update(),console.log("Clock started.")},stop:function(){V.updateIntervalId&&(clearInterval(V.updateIntervalId),V.updateIntervalId=null,console.log("Clock stopped."))},getCurrentPeriodInfo:function(g){if(!S.schedule||S.schedule.length===0)return null;for(let y=0;y<S.schedule.length;y++){const p=S.schedule[y];if(!(!p||typeof p.start!="string"||typeof p.end!="string"))try{const M=J.getTodayTime(p.start),l=J.getTodayTime(p.end);let e=new Date(l.getTime()),r=!1;l.getTime()<=M.getTime()&&(r=!0,l.getHours()===0&&l.getMinutes()===0&&l.getSeconds()===0?(e=J.getTodayTime(p.start),e.setDate(e.getDate()+1),e.setHours(0,0,0,0)):e.setDate(e.getDate()+1));let s=!1;if(r){const i=new Date(M);i.setHours(24,0,0,0);const f=new Date(M);f.setDate(f.getDate()+1),f.setHours(0,0,0,0),(g>=M&&g<i||g>=f&&g<e)&&(s=!0)}else g>=M&&g<e&&(s=!0);if(!s&&(p.end==="23:59"||p.end==="23:59:59")){const i=new Date(M);i.setHours(23,59,59,999),g>=M&&g<=i&&(s=!0,e=i)}if(s)return{label:p.label,start:M,end:e,index:y}}catch(M){console.error("Error processing period:",p?.label,p?.start,p?.end,M)}}return null},update:function(){if(!S||!ie||!q||!Q||!R||!T){console.error("Core modules not available in Clock.update");return}const g=se(),y=S.getActiveColourScheme();ie.update(),R.activeVisualAlertInterval||q.restoreOriginalStyles(y),S.preferences.showTime&&T.timeEl&&(T.timeEl.textContent=J.formatTime(g)),S.preferences.showDate&&T.dateEl&&(T.dateEl.textContent=J.formatDate(g)),Q.update(g);const p=V.getCurrentPeriodInfo(g),M=p?p.index:null;M!==R.currentPeriodIndex&&(R.currentPeriodLabel=p?p.label:null,R.currentPeriodIndex=M,p&&S.alerts[p.index]?.colour?.enabled?q.triggerVisualAlert(S.alerts[p.index].colour):R.activeVisualAlertInterval&&(q.clearVisualAlert(),q.restoreOriginalStyles()),Q.handlePeriodChange(p)),V.updatePeriodDisplay(g,p)},updatePeriodDisplay:function(g,y){if(T.periodLabelEl)if(y)if(S.preferences.showScheduleLabel?T.periodLabelEl.textContent=y.label:T.periodLabelEl.textContent="",S.preferences.showProgressBar&&!S.preferences.showSandBars){if(T.progressEl&&T.progressBarEl&&T.timeLeftEl){const p=y.start.getTime(),M=y.end.getTime(),l=g.getTime(),e=M-p,r=Math.max(0,l-p);if(e>0){const s=Math.min(100,Math.max(0,r/e*100));T.progressEl.style.width=s+"%";const i=T.progressBarEl.offsetWidth,f=T.timeLeftEl.offsetWidth>0?T.timeLeftEl.offsetWidth:60;let c=s/100*i-f/2;c=Math.max(0,Math.min(i-f,c)),T.timeLeftEl.style.left=c+"px";const d=Math.max(0,M-l),o=Math.floor(d/1e3),t=Math.floor(o/60),n=o%60;T.timeLeftEl.textContent=`${t}:${n<10?"0"+n:n}`}else{T.progressEl.style.width=l>=p?"100%":"0%",T.timeLeftEl.textContent="0:00";const s=T.progressBarEl.offsetWidth,i=T.timeLeftEl.offsetWidth>0?T.timeLeftEl.offsetWidth:60;T.timeLeftEl.style.left=`${s-i}px`}}}else T.progressEl&&(T.progressEl.style.width="0%"),T.timeLeftEl&&(T.timeLeftEl.textContent="");else T.periodLabelEl&&(T.periodLabelEl.textContent=""),T.progressEl&&S.preferences.showProgressBar&&(T.progressEl.style.width="0%"),T.timeLeftEl&&S.preferences.showProgressBar&&(T.timeLeftEl.textContent="")}},Fe=new Set(["Atkinson Hyperlegible Next","Arial","Helvetica","Times New Roman","Courier New","Verdana","Tahoma","Trebuchet MS","Georgia","Palatino","Garamond","Comic Sans MS","Impact","Lucida Console","Digital-7","OCR A Std","Monaco"]),S={schedule:[{label:"Before",start:"00:00",end:"08:50",colourSchemeId:1,showCircles:!1},{label:"Period 1",start:"08:50",end:"10:05",colourSchemeId:1,showCircles:!0},{label:"Break",start:"10:05",end:"10:15",colourSchemeId:2,showCircles:!1},{label:"Period 2",start:"10:15",end:"11:30",colourSchemeId:1,showCircles:!0},{label:"Lunch",start:"11:30",end:"12:20",colourSchemeId:2,showCircles:!1},{label:"Period 3",start:"12:20",end:"13:35",colourSchemeId:1,showCircles:!0},{label:"Break",start:"13:35",end:"13:45",colourSchemeId:2,showCircles:!1},{label:"Period 4",start:"13:45",end:"15:00",colourSchemeId:1,showCircles:!0},{label:"After",start:"15:00",end:"23:59",colourSchemeId:1,showCircles:!1}],preferences:{},alerts:{},defaultPreferences:{fontFamily:"Atkinson Hyperlegible Next",dateFontSize:64,timeFontSize:200,scheduleLabelFontSize:48,timeLeftFontSize:40,progressBarHeight:120,timeOffsetMs:0,showDate:!0,showTime:!0,showScheduleLabel:!0,showProgressBar:!0,showScheduleCircles:!1,showSandBars:!1,sandWidth:80,sandHeight:150,sandParticleSize:5,colourSchemes:[{id:1,name:"Default Dark",background:"#000000",text:"#FFFFFF"},{id:2,name:"Default Light",background:"#F0F0F0",text:"#000000"}],defaultAlertSettings:{colour:{enabled:!1,background:"#ff0000",text:"#ffffff",durationMs:1500,intervalMs:500}}},load:function(){S.preferences=JSON.parse(JSON.stringify(S.defaultPreferences));const g=JSON.parse(JSON.stringify(S.schedule));S.alerts={};const y=localStorage.getItem("clockSchedule");let p=!1;if(y)try{const e=JSON.parse(y);Array.isArray(e)&&e.length>0&&(S.schedule=e.map(r=>({label:r.label||"Unnamed",start:r.start||"00:00",end:r.end||"00:00",colourSchemeId:r.colourSchemeId||1,showCircles:typeof r.showCircles=="boolean"?r.showCircles:!1})),p=!0)}catch(e){console.error("Error parsing saved schedule.",e)}p||(S.schedule=g);const M=localStorage.getItem("clockPreferences");if(M)try{const e=JSON.parse(M);if(typeof e=="object"&&e!==null){const r={...JSON.parse(JSON.stringify(S.defaultPreferences)),...e,defaultAlertSettings:{colour:{...S.defaultPreferences.defaultAlertSettings.colour,...e.defaultAlertSettings?.colour||{}}},colourSchemes:e.colourSchemes&&Array.isArray(e.colourSchemes)&&e.colourSchemes.length>0?e.colourSchemes.map(s=>({id:s.id||Date.now()+Math.random(),name:s.name||"Unnamed Scheme",background:s.background||"#000000",text:s.text||"#FFFFFF"})):S.defaultPreferences.colourSchemes};for(const s of["showDate","showTime","showScheduleLabel","showProgressBar","showScheduleCircles","showSandBars"])typeof r[s]!="boolean"&&(r[s]=S.defaultPreferences[s]);for(const s of["dateFontSize","timeFontSize","scheduleLabelFontSize","timeLeftFontSize","progressBarHeight","sandWidth","sandHeight","sandParticleSize"])r[s]=Number(r[s])||S.defaultPreferences[s];r.timeOffsetMs=Number(r.timeOffsetMs)||0,r.fontFamily==="Atkinson Hyperlegible"&&(r.fontFamily="Atkinson Hyperlegible Next"),Fe.has(r.fontFamily)||(r.fontFamily=S.defaultPreferences.fontFamily),r.sandWidth=Math.max(10,Math.min(100,r.sandWidth)),r.sandHeight=Math.max(50,Math.min(800,r.sandHeight)),r.sandParticleSize=Math.max(1,Math.min(20,r.sandParticleSize)),S.preferences=r}}catch(e){console.error("Error parsing saved preferences.",e)}const l=localStorage.getItem("clockAlerts");if(l)try{const e=JSON.parse(l);typeof e=="object"&&e!==null&&(S.alerts=e,Object.keys(S.alerts).forEach(r=>{S.alerts[r]?.noise&&delete S.alerts[r].noise,S.alerts[r]&&typeof S.alerts[r]=="object"&&Object.keys(S.alerts[r]).length===0&&delete S.alerts[r]}))}catch(e){console.error("Error parsing saved alerts settings.",e)}console.log("Settings loaded")},save:function(){try{S.preferences.hasOwnProperty("sandDropInterval")&&delete S.preferences.sandDropInterval;const g={};Object.keys(S.alerts).forEach(p=>{S.alerts[p]&&typeof S.alerts[p]=="object"&&Object.keys(S.alerts[p]).length>0&&(g[p]=S.alerts[p])});const y=S.schedule.map(p=>({label:p.label,start:p.start,end:p.end,colourSchemeId:p.colourSchemeId,showCircles:p.showCircles}));localStorage.setItem("clockSchedule",JSON.stringify(y)),localStorage.setItem("clockPreferences",JSON.stringify(S.preferences)),localStorage.setItem("clockAlerts",JSON.stringify(g))}catch(g){console.error("Error saving settings:",g)}},getActiveColourScheme:function(){const g=se(),y=typeof V<"u"?V.getCurrentPeriodInfo(g):null;let p=1;if(y&&y.index!==void 0&&S.schedule[y.index]){const e=S.schedule[y.index];e.colourSchemeId&&(p=e.colourSchemeId)}const M=S.preferences?.colourSchemes||S.defaultPreferences.colourSchemes;let l=M.find(e=>e.id===p);return l||(l=M.find(e=>e.id===1)),l||(l=M[0]),l||{id:0,name:"Error",background:"#ff00ff",text:"#000000"}}},te={attachListeners:function(){T.colorSchemeContentContainer?.addEventListener("click",te.handleContentClick),T.colorSchemeContentContainer?.addEventListener("input",te.handleContentInput)},renderTabs:function(){const g=T.colorSchemeTabsContainer,y=T.colorSchemeContentContainer;if(!g||!y)return;g.innerHTML="",(S.preferences?.colourSchemes||[]).forEach((e,r)=>{const s=document.createElement("button");s.className="colour-tab",s.textContent=e.name||`Scheme ${e.id}`,s.dataset.id=e.id,s.dataset.index=r,s.addEventListener("click",function(){g.querySelectorAll(".colour-tab.active").forEach(i=>i.classList.remove("active")),this.classList.add("active"),te.renderContent(r)}),g.appendChild(s)});const M=document.createElement("button");M.className="colour-tab add-colour",M.textContent="+",M.title="Add New Colour Scheme",M.addEventListener("click",te.addScheme),g.appendChild(M);const l=g.querySelector(".colour-tab:not(.add-colour)");l?l.click():y.innerHTML="<p>No colour schemes defined. Click '+' to add one.</p>"},renderContent:function(g){const y=T.colorSchemeContentContainer,p=S.preferences?.colourSchemes||[];if(!y||g<0||g>=p.length)return;const M=p[g];if(!M)return;const l=p.length>1&&M.id!==1&&M.id!==2,e=`
            <button
                id="delete-scheme-${g}"
                data-index="${g}"
                ${l?"":'disabled title="Cannot delete default schemes or the last remaining scheme"'}>
                Delete Scheme
            </button>`;y.innerHTML=`
          <div class="colour-scheme-form">
            <label>Scheme Name: <input type="text" id="scheme-name-${g}" value="${M.name||""}"></label>
            <label>Background Colour: <input type="color" id="scheme-bg-color-${g}" value="${M.background||"#000000"}"></label>
            <label>Main Text Colour (Date, Time, Label, Progress, Active Circles): <input type="color" id="scheme-text-color-${g}" value="${M.text||"#ffffff"}"></label>
            <button id="save-scheme-settings-${g}" data-index="${g}">Save Scheme</button>
            ${l?e:""}
             <div class="feedback-message" style="display: none;"></div>
           </div>`},handleContentInput:function(g){const y=g.target,p=y.closest(".colour-scheme-form");if(!p||!y.id||!(y.id.startsWith("scheme-name")||y.id.startsWith("scheme-bg-color")||y.id.startsWith("scheme-text-color")))return;const M=p.querySelector('button[id^="save-scheme-settings"]');if(!M)return;const l=parseInt(M.dataset.index,10);if(!isNaN(l)&&l>=0&&l<S.preferences.colourSchemes.length){const e=S.preferences.colourSchemes[l];y.id.startsWith("scheme-name")&&(e.name=y.value),y.id.startsWith("scheme-bg-color")&&(e.background=y.value),y.id.startsWith("scheme-text-color")&&(e.text=y.value);const r=T.colorSchemeTabsContainer?.querySelector(`.colour-tab[data-index="${l}"]`);r&&y.id.startsWith("scheme-name")&&(r.textContent=y.value||`Scheme ${e.id}`),V.update()}},handleContentClick:function(g){const y=g.target;if(y.tagName!=="BUTTON"||!y.id||!y.closest(".colour-scheme-form"))return;const p=parseInt(y.dataset.index,10);if(y.closest(".colour-scheme-form")?.querySelector(".feedback-message"),!isNaN(p))if(y.id.startsWith("save-scheme-settings")){S.save(),J.showButtonFeedback(y,"Saved!");const M=T.colorSchemeTabsContainer?.querySelector(`.colour-tab[data-index="${p}"]`);M&&!M.classList.contains("active")&&(T.colorSchemeTabsContainer?.querySelectorAll(".colour-tab.active").forEach(l=>l.classList.remove("active")),M.classList.add("active"))}else y.id.startsWith("delete-scheme")&&te.deleteScheme(p,y)},addScheme:function(){const g=(S.preferences.colourSchemes.reduce((M,l)=>Math.max(M,l.id||0),0)||0)+1,y={id:g,name:"New Scheme "+g,background:"#222222",text:"#EEEEEE"};S.preferences.colourSchemes.push(y),S.save(),te.renderTabs(),T.colorSchemeTabsContainer?.querySelector(`.colour-tab[data-id="${g}"]`)?.click()},deleteScheme:function(g,y){const p=S.preferences.colourSchemes;if(g<0||g>=p.length)return;const M=p[g];if(p.length>1&&M.id!==1&&M.id!==2){if(confirm(`Delete scheme "${M.name||`Scheme ${g+1}`}"? Periods using it will revert to Scheme 1.`)){const e=M.id;p.splice(g,1),S.schedule.forEach(r=>{r.colourSchemeId===e&&(r.colourSchemeId=1)}),S.save(),W.renderTable(),te.renderTabs(),V.update()}}else alert("Cannot delete default schemes or the last remaining scheme.")},resetDefaults:function(){confirm("Reset ALL Colour Schemes to the defaults? This cannot be undone.")&&(S.preferences.colourSchemes=JSON.parse(JSON.stringify(S.defaultPreferences.colourSchemes)),S.schedule.forEach(g=>g.colourSchemeId=1),S.save(),W.renderTable(),te.renderTabs(),V.update(),J.showButtonFeedback(T.resetSchemesBtn,"Reset!"))}},oe={attachListeners:function(){T.fontSelect?.addEventListener("input",function(){S.preferences&&(S.preferences.fontFamily=this.value,ie.applyFontAndSizePreferences(),S.save())}),document.querySelectorAll(".number-input-wrapper").forEach(g=>{const y=g.querySelector('input[type="number"]'),p=g.querySelector(".num-btn.minus"),M=g.querySelector(".num-btn.plus");if(!y||!y.dataset||!y.dataset.pref||!p||!M)return;const l=y.dataset.pref;let e=null,r=null;const s=500,i=100;if(!S.preferences||!S.defaultPreferences||!S.preferences.hasOwnProperty(l)){console.warn(`Preference key "${l}" not found in settings for input ${y.id}`);return}const f=t=>{if(!S.preferences.hasOwnProperty(l))return;parseInt(y.step);const n=y.min?parseInt(y.min,10):-1/0,a=y.max?parseInt(y.max,10):1/0;let u=parseInt(t,10);if(u=isNaN(u)?S.defaultPreferences[l]:Math.max(n,Math.min(a,u)),S.preferences[l]!==u){if(S.preferences[l]=u,y.value=u,ie.applyFontAndSizePreferences(),["sandWidth","sandHeight","sandParticleSize"].includes(l)){console.log(`Sandbar pref changed (${l}), triggering physics setup...`);const m=V.getCurrentPeriodInfo(se());requestAnimationFrame(()=>{Q.setupPhysicsSandBars(m)})}S.save()}},c=t=>{f(parseInt(y.value,10)+t),d(),r=setTimeout(()=>{e=setInterval(()=>{f(parseInt(y.value,10)+t)},i)},s)},d=()=>{clearTimeout(r),clearInterval(e),r=e=null};y.addEventListener("change",()=>f(y.value)),p.addEventListener("mousedown",()=>c(-(parseInt(y.step)||1))),M.addEventListener("mousedown",()=>c(parseInt(y.step)||1)),["mouseup","mouseleave","blur","touchend","touchcancel"].forEach(t=>{p.addEventListener(t,d),M.addEventListener(t,d)})}),T.displayElementsChecklist?.querySelectorAll('input[type="checkbox"]').forEach(g=>{g.addEventListener("change",oe.handleDisplayToggleChange)}),T.resetAppearanceBtn?.addEventListener("click",oe.resetFontAndSizeDefaults),T.resetSchemesBtn?.addEventListener("click",te.resetDefaults),document.getElementById("reset-sandbar-defaults")?.addEventListener("click",oe.resetSandBarDefaults)},handleDisplayToggleChange:function(){const g=this.dataset.pref;if(!g||!S.preferences||!S.preferences.hasOwnProperty(g))return;if(S.preferences[g]=this.checked,g==="showSandBars"&&this.checked&&S.preferences.showProgressBar){S.preferences.showProgressBar=!1;const p=T.displayElementsChecklist?.querySelector("#pref-show-progress-bar");p&&(p.checked=!1)}else if(g==="showProgressBar"&&this.checked&&S.preferences.showSandBars){S.preferences.showSandBars=!1;const p=T.displayElementsChecklist?.querySelector("#pref-show-sand-bars");p&&(p.checked=!1)}document.getElementById("sand-bar-options")?.classList.toggle("element-hidden",!S.preferences.showSandBars),ie.update(),Q.handleDisplayToggle(),S.save()},updateInputs:function(){if(!S.preferences)return;T.fontSelect&&(T.fontSelect.value=S.preferences.fontFamily),T.dateFontSizeInput&&(T.dateFontSizeInput.value=S.preferences.dateFontSize),T.timeFontSizeInput&&(T.timeFontSizeInput.value=S.preferences.timeFontSize),T.labelFontSizeInput&&(T.labelFontSizeInput.value=S.preferences.scheduleLabelFontSize),T.timeLeftFontSizeInput&&(T.timeLeftFontSizeInput.value=S.preferences.timeLeftFontSize),T.progressHeightInput&&(T.progressHeightInput.value=S.preferences.progressBarHeight),T.displayElementsChecklist?.querySelectorAll('input[type="checkbox"]').forEach(y=>{const p=y.dataset.pref;p&&S.preferences.hasOwnProperty(p)&&(y.checked=S.preferences[p])});const g=document.getElementById("sand-bar-options");if(g){g.classList.toggle("element-hidden",!S.preferences.showSandBars);const y=g.querySelector("#pref-sand-width"),p=g.querySelector("#pref-sand-height"),M=g.querySelector("#pref-sand-particle-size");y&&(y.value=S.preferences.sandWidth),p&&(p.value=S.preferences.sandHeight),M&&(M.value=S.preferences.sandParticleSize)}},resetFontAndSizeDefaults:function(){if(confirm("Reset Font & Size settings to defaults?")){if(!S.preferences||!S.defaultPreferences)return;S.preferences.fontFamily=S.defaultPreferences.fontFamily,S.preferences.dateFontSize=S.defaultPreferences.dateFontSize,S.preferences.timeFontSize=S.defaultPreferences.timeFontSize,S.preferences.scheduleLabelFontSize=S.defaultPreferences.scheduleLabelFontSize,S.preferences.timeLeftFontSize=S.defaultPreferences.timeLeftFontSize,S.preferences.progressBarHeight=S.defaultPreferences.progressBarHeight,oe.updateInputs(),ie.applyFontAndSizePreferences(),S.save(),J.showButtonFeedback(T.resetAppearanceBtn,"Reset!")}},resetSandBarDefaults:function(){if(confirm("Reset Sand Bar settings to defaults?")){if(!S.preferences||!S.defaultPreferences)return;if(S.preferences.sandWidth=S.defaultPreferences.sandWidth,S.preferences.sandHeight=S.defaultPreferences.sandHeight,S.preferences.sandParticleSize=S.defaultPreferences.sandParticleSize,oe.updateInputs(),S.preferences.showSandBars){const g=V.getCurrentPeriodInfo(se());requestAnimationFrame(()=>{Q.setupPhysicsSandBars(g)})}S.save(),J.showButtonFeedback(document.getElementById("reset-sandbar-defaults"),"Reset!")}}},_={attachListeners:function(){T.syncToBellBtn?.addEventListener("click",_.syncToNearestBell),T.resetOffsetBtn?.addEventListener("click",_.resetOffset),_.addManualOffsetListener(T.offsetMinDownBtn,-6e4),_.addManualOffsetListener(T.offsetMinUpBtn,6e4),_.addManualOffsetListener(T.offsetSecDownBtn,-1e3),_.addManualOffsetListener(T.offsetSecUpBtn,1e3)},addManualOffsetListener:function(g,y){g&&g.addEventListener("click",()=>_.adjustOffset(y))},adjustOffset:function(g){typeof S.preferences.timeOffsetMs!="number"&&(S.preferences.timeOffsetMs=0),S.preferences.timeOffsetMs+=g,_.updateOffsetDisplay(),V.update(),S.save()},resetOffset:function(){S.preferences.timeOffsetMs!==0?(S.preferences.timeOffsetMs=0,_.updateOffsetDisplay(),V.update(),S.save(),J.showButtonFeedback(T.resetOffsetBtn,"Offset Reset!",1500)):J.showButtonFeedback(T.resetOffsetBtn,"Already Zero!",1e3)},syncToNearestBell:function(){if(!S.schedule||S.schedule.length===0){J.showButtonFeedback(T.syncToBellBtn,"Add Schedule First!",2e3);return}const y=new Date().getTime();let p=1/0,M=null;if(S.schedule.forEach(l=>{if(!(!l||!l.start||!l.end||!/^\d{2}:\d{2}$/.test(l.start)||!/^\d{2}:\d{2}$/.test(l.end)))try{const e=J.getTodayTime(l.start),r=J.getTodayTime(l.end),s=e.getTime(),i=r.getTime();let f=Math.abs(s-y);if(f<p&&(p=f,M=e),!S.schedule.some(d=>d.start===l.end)){let d=Math.abs(i-y);d<p&&(p=d,M=r)}}catch(e){console.error("Sync error parsing time for period:",l.label,e)}}),M!==null){const l=M.getTime()-y;S.preferences.timeOffsetMs=l,_.updateOffsetDisplay(),V.update(),S.save(),J.showButtonFeedback(T.syncToBellBtn,"Synced!")}else J.showButtonFeedback(T.syncToBellBtn,"No Valid Times!",2e3)},updateOffsetDisplay:function(){const g=Number(S.preferences?.timeOffsetMs)||0,y=Math.round(g/1e3),p=y>=0?"+":"-",M=Math.abs(y),l=Math.floor(M/60),e=M%60,r=e<10?"0"+e:e,s=`${p}${l}m ${r}s`;T.currentOffsetDisplay&&(T.currentOffsetDisplay.textContent=s)}},ae={init:function(){console.log("Classroom Clock Initializing..."),Te(),S.load(),oe.updateInputs(),te.renderTabs(),W.renderTable(),_.updateOffsetDisplay(),oe.attachListeners(),te.attachListeners(),W.attachListeners(),q.attachListeners(),_.attachListeners(),ae.attachGlobalListeners(),ie.update(),Q.handleDisplayToggle(),V.start(),console.log("Classroom Clock Initialized.")},attachGlobalListeners:function(){T.menuToggle?.addEventListener("click",()=>{const g=T.settingsMenu?.classList.toggle("open");T.menuToggle&&(T.menuToggle.innerHTML=g?"â–²":"â–¼")}),T.menuResizer?.addEventListener("mousedown",ae.handleResizeMouseDown),document.addEventListener("mousemove",ae.handleResizeMouseMove),document.addEventListener("mouseup",ae.handleResizeMouseUp),document.addEventListener("mouseleave",ae.handleResizeMouseUp),T.tabsContainer?.querySelectorAll(".tab-button").forEach(g=>{g.addEventListener("click",ae.handleTabClick)})},handleTabClick:function(){if(!T.tabsContainer||!T.tabContentsContainer)return;T.tabsContainer.querySelectorAll(".tab-button.active").forEach(y=>y.classList.remove("active")),T.tabContentsContainer.querySelectorAll(".tab-content.active").forEach(y=>y.classList.remove("active")),this.classList.add("active");const g=this.getAttribute("data-tab");if(g){const y=T.tabContentsContainer.querySelector(`#${g}`);y&&y.classList.add("active")}},handleResizeMouseDown:function(g){R.isResizingMenu=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none",document.body.style.setProperty("-webkit-user-select","none")},handleResizeMouseMove:function(g){if(!R.isResizingMenu||!T.settingsMenu)return;const y=window.innerWidth-g.clientX,p=400,M=Math.min(950,window.innerWidth-50);y>=p&&y<=M&&(T.settingsMenu.style.width=y+"px")},handleResizeMouseUp:function(g){R.isResizingMenu&&(R.isResizingMenu=!1,document.body.style.cursor="default",document.body.style.userSelect="",document.body.style.removeProperty("-webkit-user-select"))}};document.addEventListener("DOMContentLoaded",ae.init);
