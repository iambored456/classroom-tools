(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))w(a);new MutationObserver(a=>{for(const e of a)if(e.type==="childList")for(const n of e.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&w(n)}).observe(document,{childList:!0,subtree:!0});function m(a){const e={};return a.integrity&&(e.integrity=a.integrity),a.referrerPolicy&&(e.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?e.credentials="include":a.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function w(a){if(a.ep)return;a.ep=!0;const e=m(a);fetch(a.href,e)}})();function Te(){return{clockDisplayArea:document.getElementById("clock-display-area"),timeEl:document.getElementById("time"),dateEl:document.getElementById("date"),scheduleCirclesDisplayEl:document.getElementById("schedule-circles-display"),periodContainerEl:document.getElementById("period-container"),periodLabelEl:document.getElementById("period-label"),progressBarEl:document.getElementById("progress-bar"),progressEl:document.getElementById("progress"),timeLeftEl:document.getElementById("time-left"),sandBarsContainerEl:document.getElementById("sand-bars-container"),sandBarsCanvas:document.getElementById("sand-bars-canvas"),waterFillContainerEl:document.getElementById("water-fill-container"),waterFillCanvas:document.getElementById("water-fill-canvas"),alertModal:document.getElementById("alert-modal"),alertModalTitle:document.getElementById("modal-title"),alertModalBody:document.getElementById("modal-body"),closeModalBtn:document.querySelector("#alert-modal .close-modal-btn"),menuToggle:document.getElementById("menu-toggle"),settingsMenu:document.getElementById("settings-menu"),menuResizer:document.getElementById("menu-resizer"),settingsNav:document.getElementById("settings-nav"),tabsContainer:document.getElementById("tabs"),tabContentsContainer:document.getElementById("tab-contents"),appearanceTab:document.getElementById("appearance-tab"),scheduleAlertsTab:document.getElementById("schedule-alerts-tab"),displayElementsChecklist:document.getElementById("display-elements-checklist"),fontSelect:document.getElementById("pref-font"),dateFontSizeInput:document.getElementById("pref-date-font"),timeFontSizeInput:document.getElementById("pref-time-font"),labelFontSizeInput:document.getElementById("pref-schedule-label-font"),timeLeftFontSizeInput:document.getElementById("pref-time-left-font"),progressHeightInput:document.getElementById("pref-progress-height"),resetAppearanceBtn:document.getElementById("reset-appearance-defaults"),resetSchemesBtn:document.getElementById("reset-schemes-defaults"),colorSchemeTabsContainer:document.getElementById("colour-scheme-tabs"),colorSchemeContentContainer:document.getElementById("colour-scheme-content"),scheduleTableBody:document.querySelector("#schedule-table tbody"),addScheduleRowBtn:document.getElementById("add-schedule-row"),deleteScheduleRowBtn:document.getElementById("delete-schedule-row"),timeSyncSection:document.getElementById("time-sync-section"),syncToBellBtn:document.getElementById("sync-to-bell"),offsetMinDownBtn:document.getElementById("offset-min-down"),offsetMinUpBtn:document.getElementById("offset-min-up"),offsetSecDownBtn:document.getElementById("offset-sec-down"),offsetSecUpBtn:document.getElementById("offset-sec-up"),resetOffsetBtn:document.getElementById("reset-offset"),currentOffsetDisplay:document.getElementById("current-offset")}}let B={};function Ae(){B=Te(),console.log("DOM Cache Updated",B)}const q={getTodayTime:function(p){if(!p||!/^\d{2}:\d{2}$/.test(p)){const a=new Date;return a.setSeconds(0,0),a}const[v,m]=p.split(":").map(Number),w=new Date;return w.setHours(v,m,0,0),w},formatTime:function(p){let v=p.getHours();const m=p.getMinutes(),w=v>=12?"PM":"AM";return v=v%12||12,`${v}:${m<10?"0"+m:m} ${w}`},formatDate:function(p){const v={weekday:"long",month:"long",day:"numeric"};return p.toLocaleDateString(void 0,v)},showFeedback:function(p,v,m=!0){p&&(p.textContent=v,p.classList.remove("success","error"),p.classList.add(m?"success":"error"),p.style.display="block",setTimeout(()=>{p&&(p.style.display="none")},3e3))},showButtonFeedback:function(p,v="Saved!",m=1500){if(!p)return;const w=p.textContent;p.textContent=v,p.classList.add("button-success"),p.disabled=!0,setTimeout(()=>{p&&(p.textContent=w,p.classList.remove("button-success"),p.disabled=!1)},m)},lightenColor:function(p,v){if(!p||(p=p.replace(/^#/,""),p.length!==6))return"#cccccc";try{let m=parseInt(p.substring(0,2),16),w=parseInt(p.substring(2,4),16),a=parseInt(p.substring(4,6),16);m=Math.min(255,Math.floor(m*(1+v/100))),w=Math.min(255,Math.floor(w*(1+v/100))),a=Math.min(255,Math.floor(a*(1+v/100)));const e=m.toString(16).padStart(2,"0"),n=w.toString(16).padStart(2,"0"),r=a.toString(16).padStart(2,"0");return`#${e}${n}${r}`}catch(m){return console.error("Error lightening color:",p,m),"#cccccc"}}};function se(){const p=y.preferences&&y.preferences.timeOffsetMs?Number(y.preferences.timeOffsetMs):0,v=new Date;return new Date(v.getTime()+p)}const k={currentPeriodLabel:null,currentPeriodIndex:null,activeVisualAlertInterval:null,activeVisualAlertTimeout:null,originalBodyStyles:{},selectedScheduleRowIndex:null,isResizingMenu:!1,dragStartIndex:null,SAND_COLORS:["#fba1bd","#dfb37a","#8aca91","#54cce2","#b6b6fd"],physicsCheckIntervalId:null,physicsCheckIntervalMs:100,physicsParticlesAdded:0,visualMaxParticlesPerSegment:0,totalParticlesForPeriod:0};var Ce=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Le(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var ue={exports:{}};var be=ue.exports,we;function Fe(){return we||(we=1,(function(p,v){(function(w,a){p.exports=a()})(be,function(){return(function(m){var w={};function a(e){if(w[e])return w[e].exports;var n=w[e]={i:e,l:!1,exports:{}};return m[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=m,a.c=w,a.d=function(e,n,r){a.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},a.r=function(e){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,n){if(n&1&&(e=a(e)),n&8||n&4&&typeof e=="object"&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),n&2&&typeof e!="string")for(var i in e)a.d(r,i,(function(f){return e[f]}).bind(null,i));return r},a.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(n,"a",n),n},a.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},a.p="",a(a.s=20)})([(function(m,w){var a={};m.exports=a,(function(){a._baseDelta=1e3/60,a._nextId=0,a._seed=0,a._nowStartTime=+new Date,a._warnedOnce={},a._decomp=null,a.extend=function(n,r){var i,f;typeof r=="boolean"?(i=2,f=r):(i=1,f=!0);for(var c=i;c<arguments.length;c++){var d=arguments[c];if(d)for(var l in d)f&&d[l]&&d[l].constructor===Object&&(!n[l]||n[l].constructor===Object)?(n[l]=n[l]||{},a.extend(n[l],f,d[l])):n[l]=d[l]}return n},a.clone=function(n,r){return a.extend({},r,n)},a.keys=function(n){if(Object.keys)return Object.keys(n);var r=[];for(var i in n)r.push(i);return r},a.values=function(n){var r=[];if(Object.keys){for(var i=Object.keys(n),f=0;f<i.length;f++)r.push(n[i[f]]);return r}for(var c in n)r.push(n[c]);return r},a.get=function(n,r,i,f){r=r.split(".").slice(i,f);for(var c=0;c<r.length;c+=1)n=n[r[c]];return n},a.set=function(n,r,i,f,c){var d=r.split(".").slice(f,c);return a.get(n,r,0,-1)[d[d.length-1]]=i,i},a.shuffle=function(n){for(var r=n.length-1;r>0;r--){var i=Math.floor(a.random()*(r+1)),f=n[r];n[r]=n[i],n[i]=f}return n},a.choose=function(n){return n[Math.floor(a.random()*n.length)]},a.isElement=function(n){return typeof HTMLElement<"u"?n instanceof HTMLElement:!!(n&&n.nodeType&&n.nodeName)},a.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"},a.isFunction=function(n){return typeof n=="function"},a.isPlainObject=function(n){return typeof n=="object"&&n.constructor===Object},a.isString=function(n){return toString.call(n)==="[object String]"},a.clamp=function(n,r,i){return n<r?r:n>i?i:n},a.sign=function(n){return n<0?-1:1},a.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-a._nowStartTime},a.random=function(n,r){return n=typeof n<"u"?n:0,r=typeof r<"u"?r:1,n+e()*(r-n)};var e=function(){return a._seed=(a._seed*9301+49297)%233280,a._seed/233280};a.colorToNumber=function(n){return n=n.replace("#",""),n.length==3&&(n=n.charAt(0)+n.charAt(0)+n.charAt(1)+n.charAt(1)+n.charAt(2)+n.charAt(2)),parseInt(n,16)},a.logLevel=1,a.log=function(){console&&a.logLevel>0&&a.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},a.info=function(){console&&a.logLevel>0&&a.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},a.warn=function(){console&&a.logLevel>0&&a.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},a.warnOnce=function(){var n=Array.prototype.slice.call(arguments).join(" ");a._warnedOnce[n]||(a.warn(n),a._warnedOnce[n]=!0)},a.deprecated=function(n,r,i){n[r]=a.chain(function(){a.warnOnce("ðŸ”… deprecated ðŸ”…",i)},n[r])},a.nextId=function(){return a._nextId++},a.indexOf=function(n,r){if(n.indexOf)return n.indexOf(r);for(var i=0;i<n.length;i++)if(n[i]===r)return i;return-1},a.map=function(n,r){if(n.map)return n.map(r);for(var i=[],f=0;f<n.length;f+=1)i.push(r(n[f]));return i},a.topologicalSort=function(n){var r=[],i=[],f=[];for(var c in n)!i[c]&&!f[c]&&a._topologicalSort(c,i,f,n,r);return r},a._topologicalSort=function(n,r,i,f,c){var d=f[n]||[];i[n]=!0;for(var l=0;l<d.length;l+=1){var t=d[l];i[t]||r[t]||a._topologicalSort(t,r,i,f,c)}i[n]=!1,r[n]=!0,c.push(n)},a.chain=function(){for(var n=[],r=0;r<arguments.length;r+=1){var i=arguments[r];i._chained?n.push.apply(n,i._chained):n.push(i)}var f=function(){for(var c,d=new Array(arguments.length),l=0,t=arguments.length;l<t;l++)d[l]=arguments[l];for(l=0;l<n.length;l+=1){var s=n[l].apply(c,d);typeof s<"u"&&(c=s)}return c};return f._chained=n,f},a.chainPathBefore=function(n,r,i){return a.set(n,r,a.chain(i,a.get(n,r)))},a.chainPathAfter=function(n,r,i){return a.set(n,r,a.chain(a.get(n,r),i))},a.setDecomp=function(n){a._decomp=n},a.getDecomp=function(){var n=a._decomp;try{!n&&typeof window<"u"&&(n=window.decomp),!n&&typeof Ce<"u"&&(n=Ce.decomp)}catch{n=null}return n}})()}),(function(m,w){var a={};m.exports=a,(function(){a.create=function(e){var n={min:{x:0,y:0},max:{x:0,y:0}};return e&&a.update(n,e),n},a.update=function(e,n,r){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var i=0;i<n.length;i++){var f=n[i];f.x>e.max.x&&(e.max.x=f.x),f.x<e.min.x&&(e.min.x=f.x),f.y>e.max.y&&(e.max.y=f.y),f.y<e.min.y&&(e.min.y=f.y)}r&&(r.x>0?e.max.x+=r.x:e.min.x+=r.x,r.y>0?e.max.y+=r.y:e.min.y+=r.y)},a.contains=function(e,n){return n.x>=e.min.x&&n.x<=e.max.x&&n.y>=e.min.y&&n.y<=e.max.y},a.overlaps=function(e,n){return e.min.x<=n.max.x&&e.max.x>=n.min.x&&e.max.y>=n.min.y&&e.min.y<=n.max.y},a.translate=function(e,n){e.min.x+=n.x,e.max.x+=n.x,e.min.y+=n.y,e.max.y+=n.y},a.shift=function(e,n){var r=e.max.x-e.min.x,i=e.max.y-e.min.y;e.min.x=n.x,e.max.x=n.x+r,e.min.y=n.y,e.max.y=n.y+i}})()}),(function(m,w){var a={};m.exports=a,(function(){a.create=function(e,n){return{x:e||0,y:n||0}},a.clone=function(e){return{x:e.x,y:e.y}},a.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},a.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},a.rotate=function(e,n,r){var i=Math.cos(n),f=Math.sin(n);r||(r={});var c=e.x*i-e.y*f;return r.y=e.x*f+e.y*i,r.x=c,r},a.rotateAbout=function(e,n,r,i){var f=Math.cos(n),c=Math.sin(n);i||(i={});var d=r.x+((e.x-r.x)*f-(e.y-r.y)*c);return i.y=r.y+((e.x-r.x)*c+(e.y-r.y)*f),i.x=d,i},a.normalise=function(e){var n=a.magnitude(e);return n===0?{x:0,y:0}:{x:e.x/n,y:e.y/n}},a.dot=function(e,n){return e.x*n.x+e.y*n.y},a.cross=function(e,n){return e.x*n.y-e.y*n.x},a.cross3=function(e,n,r){return(n.x-e.x)*(r.y-e.y)-(n.y-e.y)*(r.x-e.x)},a.add=function(e,n,r){return r||(r={}),r.x=e.x+n.x,r.y=e.y+n.y,r},a.sub=function(e,n,r){return r||(r={}),r.x=e.x-n.x,r.y=e.y-n.y,r},a.mult=function(e,n){return{x:e.x*n,y:e.y*n}},a.div=function(e,n){return{x:e.x/n,y:e.y/n}},a.perp=function(e,n){return n=n===!0?-1:1,{x:n*-e.y,y:n*e.x}},a.neg=function(e){return{x:-e.x,y:-e.y}},a.angle=function(e,n){return Math.atan2(n.y-e.y,n.x-e.x)},a._temp=[a.create(),a.create(),a.create(),a.create(),a.create(),a.create()]})()}),(function(m,w,a){var e={};m.exports=e;var n=a(2),r=a(0);(function(){e.create=function(i,f){for(var c=[],d=0;d<i.length;d++){var l=i[d],t={x:l.x,y:l.y,index:d,body:f,isInternal:!1};c.push(t)}return c},e.fromPath=function(i,f){var c=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,d=[];return i.replace(c,function(l,t,s){d.push({x:parseFloat(t),y:parseFloat(s)})}),e.create(d,f)},e.centre=function(i){for(var f=e.area(i,!0),c={x:0,y:0},d,l,t,s=0;s<i.length;s++)t=(s+1)%i.length,d=n.cross(i[s],i[t]),l=n.mult(n.add(i[s],i[t]),d),c=n.add(c,l);return n.div(c,6*f)},e.mean=function(i){for(var f={x:0,y:0},c=0;c<i.length;c++)f.x+=i[c].x,f.y+=i[c].y;return n.div(f,i.length)},e.area=function(i,f){for(var c=0,d=i.length-1,l=0;l<i.length;l++)c+=(i[d].x-i[l].x)*(i[d].y+i[l].y),d=l;return f?c/2:Math.abs(c)/2},e.inertia=function(i,f){for(var c=0,d=0,l=i,t,s,o=0;o<l.length;o++)s=(o+1)%l.length,t=Math.abs(n.cross(l[s],l[o])),c+=t*(n.dot(l[s],l[s])+n.dot(l[s],l[o])+n.dot(l[o],l[o])),d+=t;return f/6*(c/d)},e.translate=function(i,f,c){c=typeof c<"u"?c:1;var d=i.length,l=f.x*c,t=f.y*c,s;for(s=0;s<d;s++)i[s].x+=l,i[s].y+=t;return i},e.rotate=function(i,f,c){if(f!==0){var d=Math.cos(f),l=Math.sin(f),t=c.x,s=c.y,o=i.length,u,g,M,E;for(E=0;E<o;E++)u=i[E],g=u.x-t,M=u.y-s,u.x=t+(g*d-M*l),u.y=s+(g*l+M*d);return i}},e.contains=function(i,f){for(var c=f.x,d=f.y,l=i.length,t=i[l-1],s,o=0;o<l;o++){if(s=i[o],(c-t.x)*(s.y-t.y)+(d-t.y)*(t.x-s.x)>0)return!1;t=s}return!0},e.scale=function(i,f,c,d){if(f===1&&c===1)return i;d=d||e.centre(i);for(var l,t,s=0;s<i.length;s++)l=i[s],t=n.sub(l,d),i[s].x=d.x+t.x*f,i[s].y=d.y+t.y*c;return i},e.chamfer=function(i,f,c,d,l){typeof f=="number"?f=[f]:f=f||[8],c=typeof c<"u"?c:-1,d=d||2,l=l||14;for(var t=[],s=0;s<i.length;s++){var o=i[s-1>=0?s-1:i.length-1],u=i[s],g=i[(s+1)%i.length],M=f[s<f.length?s:f.length-1];if(M===0){t.push(u);continue}var E=n.normalise({x:u.y-o.y,y:o.x-u.x}),T=n.normalise({x:g.y-u.y,y:u.x-g.x}),h=Math.sqrt(2*Math.pow(M,2)),S=n.mult(r.clone(E),M),C=n.normalise(n.mult(n.add(E,T),.5)),x=n.sub(u,n.mult(C,h)),I=c;c===-1&&(I=Math.pow(M,.32)*1.75),I=r.clamp(I,d,l),I%2===1&&(I+=1);for(var P=Math.acos(n.dot(E,T)),L=P/I,A=0;A<I;A++)t.push(n.add(n.rotate(S,L*A),x))}return t},e.clockwiseSort=function(i){var f=e.mean(i);return i.sort(function(c,d){return n.angle(f,c)-n.angle(f,d)}),i},e.isConvex=function(i){var f=0,c=i.length,d,l,t,s;if(c<3)return null;for(d=0;d<c;d++)if(l=(d+1)%c,t=(d+2)%c,s=(i[l].x-i[d].x)*(i[t].y-i[l].y),s-=(i[l].y-i[d].y)*(i[t].x-i[l].x),s<0?f|=1:s>0&&(f|=2),f===3)return!1;return f!==0?!0:null},e.hull=function(i){var f=[],c=[],d,l;for(i=i.slice(0),i.sort(function(t,s){var o=t.x-s.x;return o!==0?o:t.y-s.y}),l=0;l<i.length;l+=1){for(d=i[l];c.length>=2&&n.cross3(c[c.length-2],c[c.length-1],d)<=0;)c.pop();c.push(d)}for(l=i.length-1;l>=0;l-=1){for(d=i[l];f.length>=2&&n.cross3(f[f.length-2],f[f.length-1],d)<=0;)f.pop();f.push(d)}return f.pop(),c.pop(),f.concat(c)}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(3),r=a(2),i=a(7),f=a(0),c=a(1),d=a(11);(function(){e._timeCorrection=!0,e._inertiaScale=4,e._nextCollidingGroupId=1,e._nextNonCollidingGroupId=-1,e._nextCategory=1,e._baseDelta=1e3/60,e.create=function(t){var s={id:f.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:n.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:16.666666666666668,_original:null},o=f.extend(s,t);return l(o,t),o},e.nextGroup=function(t){return t?e._nextNonCollidingGroupId--:e._nextCollidingGroupId++},e.nextCategory=function(){return e._nextCategory=e._nextCategory<<1,e._nextCategory};var l=function(t,s){s=s||{},e.set(t,{bounds:t.bounds||c.create(t.vertices),positionPrev:t.positionPrev||r.clone(t.position),anglePrev:t.anglePrev||t.angle,vertices:t.vertices,parts:t.parts||[t],isStatic:t.isStatic,isSleeping:t.isSleeping,parent:t.parent||t}),n.rotate(t.vertices,t.angle,t.position),d.rotate(t.axes,t.angle),c.update(t.bounds,t.vertices,t.velocity),e.set(t,{axes:s.axes||t.axes,area:s.area||t.area,mass:s.mass||t.mass,inertia:s.inertia||t.inertia});var o=t.isStatic?"#14151f":f.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),u=t.isStatic?"#555":"#ccc",g=t.isStatic&&t.render.fillStyle===null?1:0;t.render.fillStyle=t.render.fillStyle||o,t.render.strokeStyle=t.render.strokeStyle||u,t.render.lineWidth=t.render.lineWidth||g,t.render.sprite.xOffset+=-(t.bounds.min.x-t.position.x)/(t.bounds.max.x-t.bounds.min.x),t.render.sprite.yOffset+=-(t.bounds.min.y-t.position.y)/(t.bounds.max.y-t.bounds.min.y)};e.set=function(t,s,o){var u;typeof s=="string"&&(u=s,s={},s[u]=o);for(u in s)if(Object.prototype.hasOwnProperty.call(s,u))switch(o=s[u],u){case"isStatic":e.setStatic(t,o);break;case"isSleeping":i.set(t,o);break;case"mass":e.setMass(t,o);break;case"density":e.setDensity(t,o);break;case"inertia":e.setInertia(t,o);break;case"vertices":e.setVertices(t,o);break;case"position":e.setPosition(t,o);break;case"angle":e.setAngle(t,o);break;case"velocity":e.setVelocity(t,o);break;case"angularVelocity":e.setAngularVelocity(t,o);break;case"speed":e.setSpeed(t,o);break;case"angularSpeed":e.setAngularSpeed(t,o);break;case"parts":e.setParts(t,o);break;case"centre":e.setCentre(t,o);break;default:t[u]=o}},e.setStatic=function(t,s){for(var o=0;o<t.parts.length;o++){var u=t.parts[o];u.isStatic=s,s?(u._original={restitution:u.restitution,friction:u.friction,mass:u.mass,inertia:u.inertia,density:u.density,inverseMass:u.inverseMass,inverseInertia:u.inverseInertia},u.restitution=0,u.friction=1,u.mass=u.inertia=u.density=1/0,u.inverseMass=u.inverseInertia=0,u.positionPrev.x=u.position.x,u.positionPrev.y=u.position.y,u.anglePrev=u.angle,u.angularVelocity=0,u.speed=0,u.angularSpeed=0,u.motion=0):u._original&&(u.restitution=u._original.restitution,u.friction=u._original.friction,u.mass=u._original.mass,u.inertia=u._original.inertia,u.density=u._original.density,u.inverseMass=u._original.inverseMass,u.inverseInertia=u._original.inverseInertia,u._original=null)}},e.setMass=function(t,s){var o=t.inertia/(t.mass/6);t.inertia=o*(s/6),t.inverseInertia=1/t.inertia,t.mass=s,t.inverseMass=1/t.mass,t.density=t.mass/t.area},e.setDensity=function(t,s){e.setMass(t,s*t.area),t.density=s},e.setInertia=function(t,s){t.inertia=s,t.inverseInertia=1/t.inertia},e.setVertices=function(t,s){s[0].body===t?t.vertices=s:t.vertices=n.create(s,t),t.axes=d.fromVertices(t.vertices),t.area=n.area(t.vertices),e.setMass(t,t.density*t.area);var o=n.centre(t.vertices);n.translate(t.vertices,o,-1),e.setInertia(t,e._inertiaScale*n.inertia(t.vertices,t.mass)),n.translate(t.vertices,t.position),c.update(t.bounds,t.vertices,t.velocity)},e.setParts=function(t,s,o){var u;for(s=s.slice(0),t.parts.length=0,t.parts.push(t),t.parent=t,u=0;u<s.length;u++){var g=s[u];g!==t&&(g.parent=t,t.parts.push(g))}if(t.parts.length!==1){if(o=typeof o<"u"?o:!0,o){var M=[];for(u=0;u<s.length;u++)M=M.concat(s[u].vertices);n.clockwiseSort(M);var E=n.hull(M),T=n.centre(E);e.setVertices(t,E),n.translate(t.vertices,T)}var h=e._totalProperties(t);t.area=h.area,t.parent=t,t.position.x=h.centre.x,t.position.y=h.centre.y,t.positionPrev.x=h.centre.x,t.positionPrev.y=h.centre.y,e.setMass(t,h.mass),e.setInertia(t,h.inertia),e.setPosition(t,h.centre)}},e.setCentre=function(t,s,o){o?(t.positionPrev.x+=s.x,t.positionPrev.y+=s.y,t.position.x+=s.x,t.position.y+=s.y):(t.positionPrev.x=s.x-(t.position.x-t.positionPrev.x),t.positionPrev.y=s.y-(t.position.y-t.positionPrev.y),t.position.x=s.x,t.position.y=s.y)},e.setPosition=function(t,s,o){var u=r.sub(s,t.position);o?(t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.velocity.x=u.x,t.velocity.y=u.y,t.speed=r.magnitude(u)):(t.positionPrev.x+=u.x,t.positionPrev.y+=u.y);for(var g=0;g<t.parts.length;g++){var M=t.parts[g];M.position.x+=u.x,M.position.y+=u.y,n.translate(M.vertices,u),c.update(M.bounds,M.vertices,t.velocity)}},e.setAngle=function(t,s,o){var u=s-t.angle;o?(t.anglePrev=t.angle,t.angularVelocity=u,t.angularSpeed=Math.abs(u)):t.anglePrev+=u;for(var g=0;g<t.parts.length;g++){var M=t.parts[g];M.angle+=u,n.rotate(M.vertices,u,t.position),d.rotate(M.axes,u),c.update(M.bounds,M.vertices,t.velocity),g>0&&r.rotateAbout(M.position,u,t.position,M.position)}},e.setVelocity=function(t,s){var o=t.deltaTime/e._baseDelta;t.positionPrev.x=t.position.x-s.x*o,t.positionPrev.y=t.position.y-s.y*o,t.velocity.x=(t.position.x-t.positionPrev.x)/o,t.velocity.y=(t.position.y-t.positionPrev.y)/o,t.speed=r.magnitude(t.velocity)},e.getVelocity=function(t){var s=e._baseDelta/t.deltaTime;return{x:(t.position.x-t.positionPrev.x)*s,y:(t.position.y-t.positionPrev.y)*s}},e.getSpeed=function(t){return r.magnitude(e.getVelocity(t))},e.setSpeed=function(t,s){e.setVelocity(t,r.mult(r.normalise(e.getVelocity(t)),s))},e.setAngularVelocity=function(t,s){var o=t.deltaTime/e._baseDelta;t.anglePrev=t.angle-s*o,t.angularVelocity=(t.angle-t.anglePrev)/o,t.angularSpeed=Math.abs(t.angularVelocity)},e.getAngularVelocity=function(t){return(t.angle-t.anglePrev)*e._baseDelta/t.deltaTime},e.getAngularSpeed=function(t){return Math.abs(e.getAngularVelocity(t))},e.setAngularSpeed=function(t,s){e.setAngularVelocity(t,f.sign(e.getAngularVelocity(t))*s)},e.translate=function(t,s,o){e.setPosition(t,r.add(t.position,s),o)},e.rotate=function(t,s,o,u){if(!o)e.setAngle(t,t.angle+s,u);else{var g=Math.cos(s),M=Math.sin(s),E=t.position.x-o.x,T=t.position.y-o.y;e.setPosition(t,{x:o.x+(E*g-T*M),y:o.y+(E*M+T*g)},u),e.setAngle(t,t.angle+s,u)}},e.scale=function(t,s,o,u){var g=0,M=0;u=u||t.position;for(var E=0;E<t.parts.length;E++){var T=t.parts[E];n.scale(T.vertices,s,o,u),T.axes=d.fromVertices(T.vertices),T.area=n.area(T.vertices),e.setMass(T,t.density*T.area),n.translate(T.vertices,{x:-T.position.x,y:-T.position.y}),e.setInertia(T,e._inertiaScale*n.inertia(T.vertices,T.mass)),n.translate(T.vertices,{x:T.position.x,y:T.position.y}),E>0&&(g+=T.area,M+=T.inertia),T.position.x=u.x+(T.position.x-u.x)*s,T.position.y=u.y+(T.position.y-u.y)*o,c.update(T.bounds,T.vertices,t.velocity)}t.parts.length>1&&(t.area=g,t.isStatic||(e.setMass(t,t.density*g),e.setInertia(t,M))),t.circleRadius&&(s===o?t.circleRadius*=s:t.circleRadius=null)},e.update=function(t,s){s=(typeof s<"u"?s:1e3/60)*t.timeScale;var o=s*s,u=e._timeCorrection?s/(t.deltaTime||s):1,g=1-t.frictionAir*(s/f._baseDelta),M=(t.position.x-t.positionPrev.x)*u,E=(t.position.y-t.positionPrev.y)*u;t.velocity.x=M*g+t.force.x/t.mass*o,t.velocity.y=E*g+t.force.y/t.mass*o,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.deltaTime=s,t.angularVelocity=(t.angle-t.anglePrev)*g*u+t.torque/t.inertia*o,t.anglePrev=t.angle,t.angle+=t.angularVelocity;for(var T=0;T<t.parts.length;T++){var h=t.parts[T];n.translate(h.vertices,t.velocity),T>0&&(h.position.x+=t.velocity.x,h.position.y+=t.velocity.y),t.angularVelocity!==0&&(n.rotate(h.vertices,t.angularVelocity,t.position),d.rotate(h.axes,t.angularVelocity),T>0&&r.rotateAbout(h.position,t.angularVelocity,t.position,h.position)),c.update(h.bounds,h.vertices,t.velocity)}},e.updateVelocities=function(t){var s=e._baseDelta/t.deltaTime,o=t.velocity;o.x=(t.position.x-t.positionPrev.x)*s,o.y=(t.position.y-t.positionPrev.y)*s,t.speed=Math.sqrt(o.x*o.x+o.y*o.y),t.angularVelocity=(t.angle-t.anglePrev)*s,t.angularSpeed=Math.abs(t.angularVelocity)},e.applyForce=function(t,s,o){var u={x:s.x-t.position.x,y:s.y-t.position.y};t.force.x+=o.x,t.force.y+=o.y,t.torque+=u.x*o.y-u.y*o.x},e._totalProperties=function(t){for(var s={mass:0,area:0,inertia:0,centre:{x:0,y:0}},o=t.parts.length===1?0:1;o<t.parts.length;o++){var u=t.parts[o],g=u.mass!==1/0?u.mass:1;s.mass+=g,s.area+=u.area,s.inertia+=u.inertia,s.centre=r.add(s.centre,r.mult(u.position,g))}return s.centre=r.div(s.centre,s.mass),s}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(0);(function(){e.on=function(r,i,f){for(var c=i.split(" "),d,l=0;l<c.length;l++)d=c[l],r.events=r.events||{},r.events[d]=r.events[d]||[],r.events[d].push(f);return f},e.off=function(r,i,f){if(!i){r.events={};return}typeof i=="function"&&(f=i,i=n.keys(r.events).join(" "));for(var c=i.split(" "),d=0;d<c.length;d++){var l=r.events[c[d]],t=[];if(f&&l)for(var s=0;s<l.length;s++)l[s]!==f&&t.push(l[s]);r.events[c[d]]=t}},e.trigger=function(r,i,f){var c,d,l,t,s=r.events;if(s&&n.keys(s).length>0){f||(f={}),c=i.split(" ");for(var o=0;o<c.length;o++)if(d=c[o],l=s[d],l){t=n.clone(f,!1),t.name=d,t.source=r;for(var u=0;u<l.length;u++)l[u].apply(r,[t])}}}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(5),r=a(0),i=a(1),f=a(4);(function(){e.create=function(c){return r.extend({id:r.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},c)},e.setModified=function(c,d,l,t){if(c.isModified=d,d&&c.cache&&(c.cache.allBodies=null,c.cache.allConstraints=null,c.cache.allComposites=null),l&&c.parent&&e.setModified(c.parent,d,l,t),t)for(var s=0;s<c.composites.length;s++){var o=c.composites[s];e.setModified(o,d,l,t)}},e.add=function(c,d){var l=[].concat(d);n.trigger(c,"beforeAdd",{object:d});for(var t=0;t<l.length;t++){var s=l[t];switch(s.type){case"body":if(s.parent!==s){r.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}e.addBody(c,s);break;case"constraint":e.addConstraint(c,s);break;case"composite":e.addComposite(c,s);break;case"mouseConstraint":e.addConstraint(c,s.constraint);break}}return n.trigger(c,"afterAdd",{object:d}),c},e.remove=function(c,d,l){var t=[].concat(d);n.trigger(c,"beforeRemove",{object:d});for(var s=0;s<t.length;s++){var o=t[s];switch(o.type){case"body":e.removeBody(c,o,l);break;case"constraint":e.removeConstraint(c,o,l);break;case"composite":e.removeComposite(c,o,l);break;case"mouseConstraint":e.removeConstraint(c,o.constraint);break}}return n.trigger(c,"afterRemove",{object:d}),c},e.addComposite=function(c,d){return c.composites.push(d),d.parent=c,e.setModified(c,!0,!0,!1),c},e.removeComposite=function(c,d,l){var t=r.indexOf(c.composites,d);if(t!==-1&&e.removeCompositeAt(c,t),l)for(var s=0;s<c.composites.length;s++)e.removeComposite(c.composites[s],d,!0);return c},e.removeCompositeAt=function(c,d){return c.composites.splice(d,1),e.setModified(c,!0,!0,!1),c},e.addBody=function(c,d){return c.bodies.push(d),e.setModified(c,!0,!0,!1),c},e.removeBody=function(c,d,l){var t=r.indexOf(c.bodies,d);if(t!==-1&&e.removeBodyAt(c,t),l)for(var s=0;s<c.composites.length;s++)e.removeBody(c.composites[s],d,!0);return c},e.removeBodyAt=function(c,d){return c.bodies.splice(d,1),e.setModified(c,!0,!0,!1),c},e.addConstraint=function(c,d){return c.constraints.push(d),e.setModified(c,!0,!0,!1),c},e.removeConstraint=function(c,d,l){var t=r.indexOf(c.constraints,d);if(t!==-1&&e.removeConstraintAt(c,t),l)for(var s=0;s<c.composites.length;s++)e.removeConstraint(c.composites[s],d,!0);return c},e.removeConstraintAt=function(c,d){return c.constraints.splice(d,1),e.setModified(c,!0,!0,!1),c},e.clear=function(c,d,l){if(l)for(var t=0;t<c.composites.length;t++)e.clear(c.composites[t],d,!0);return d?c.bodies=c.bodies.filter(function(s){return s.isStatic}):c.bodies.length=0,c.constraints.length=0,c.composites.length=0,e.setModified(c,!0,!0,!1),c},e.allBodies=function(c){if(c.cache&&c.cache.allBodies)return c.cache.allBodies;for(var d=[].concat(c.bodies),l=0;l<c.composites.length;l++)d=d.concat(e.allBodies(c.composites[l]));return c.cache&&(c.cache.allBodies=d),d},e.allConstraints=function(c){if(c.cache&&c.cache.allConstraints)return c.cache.allConstraints;for(var d=[].concat(c.constraints),l=0;l<c.composites.length;l++)d=d.concat(e.allConstraints(c.composites[l]));return c.cache&&(c.cache.allConstraints=d),d},e.allComposites=function(c){if(c.cache&&c.cache.allComposites)return c.cache.allComposites;for(var d=[].concat(c.composites),l=0;l<c.composites.length;l++)d=d.concat(e.allComposites(c.composites[l]));return c.cache&&(c.cache.allComposites=d),d},e.get=function(c,d,l){var t,s;switch(l){case"body":t=e.allBodies(c);break;case"constraint":t=e.allConstraints(c);break;case"composite":t=e.allComposites(c).concat(c);break}return t?(s=t.filter(function(o){return o.id.toString()===d.toString()}),s.length===0?null:s[0]):null},e.move=function(c,d,l){return e.remove(c,d),e.add(l,d),c},e.rebase=function(c){for(var d=e.allBodies(c).concat(e.allConstraints(c)).concat(e.allComposites(c)),l=0;l<d.length;l++)d[l].id=r.nextId();return c},e.translate=function(c,d,l){for(var t=l?e.allBodies(c):c.bodies,s=0;s<t.length;s++)f.translate(t[s],d);return c},e.rotate=function(c,d,l,t){for(var s=Math.cos(d),o=Math.sin(d),u=t?e.allBodies(c):c.bodies,g=0;g<u.length;g++){var M=u[g],E=M.position.x-l.x,T=M.position.y-l.y;f.setPosition(M,{x:l.x+(E*s-T*o),y:l.y+(E*o+T*s)}),f.rotate(M,d)}return c},e.scale=function(c,d,l,t,s){for(var o=s?e.allBodies(c):c.bodies,u=0;u<o.length;u++){var g=o[u],M=g.position.x-t.x,E=g.position.y-t.y;f.setPosition(g,{x:t.x+M*d,y:t.y+E*l}),f.scale(g,d,l)}return c},e.bounds=function(c){for(var d=e.allBodies(c),l=[],t=0;t<d.length;t+=1){var s=d[t];l.push(s.bounds.min,s.bounds.max)}return i.create(l)}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(4),r=a(5),i=a(0);(function(){e._motionWakeThreshold=.18,e._motionSleepThreshold=.08,e._minBias=.9,e.update=function(f,c){for(var d=c/i._baseDelta,l=e._motionSleepThreshold,t=0;t<f.length;t++){var s=f[t],o=n.getSpeed(s),u=n.getAngularSpeed(s),g=o*o+u*u;if(s.force.x!==0||s.force.y!==0){e.set(s,!1);continue}var M=Math.min(s.motion,g),E=Math.max(s.motion,g);s.motion=e._minBias*M+(1-e._minBias)*E,s.sleepThreshold>0&&s.motion<l?(s.sleepCounter+=1,s.sleepCounter>=s.sleepThreshold/d&&e.set(s,!0)):s.sleepCounter>0&&(s.sleepCounter-=1)}},e.afterCollisions=function(f){for(var c=e._motionSleepThreshold,d=0;d<f.length;d++){var l=f[d];if(l.isActive){var t=l.collision,s=t.bodyA.parent,o=t.bodyB.parent;if(!(s.isSleeping&&o.isSleeping||s.isStatic||o.isStatic)&&(s.isSleeping||o.isSleeping)){var u=s.isSleeping&&!s.isStatic?s:o,g=u===s?o:s;!u.isStatic&&g.motion>c&&e.set(u,!1)}}}},e.set=function(f,c){var d=f.isSleeping;c?(f.isSleeping=!0,f.sleepCounter=f.sleepThreshold,f.positionImpulse.x=0,f.positionImpulse.y=0,f.positionPrev.x=f.position.x,f.positionPrev.y=f.position.y,f.anglePrev=f.angle,f.speed=0,f.angularSpeed=0,f.motion=0,d||r.trigger(f,"sleepStart")):(f.isSleeping=!1,f.sleepCounter=0,d&&r.trigger(f,"sleepEnd"))}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(3),r=a(9);(function(){var i=[],f={overlap:0,axis:null},c={overlap:0,axis:null};e.create=function(d,l){return{pair:null,collided:!1,bodyA:d,bodyB:l,parentA:d.parent,parentB:l.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[]}},e.collides=function(d,l,t){if(e._overlapAxes(f,d.vertices,l.vertices,d.axes),f.overlap<=0||(e._overlapAxes(c,l.vertices,d.vertices,l.axes),c.overlap<=0))return null;var s=t&&t.table[r.id(d,l)],o;s?o=s.collision:(o=e.create(d,l),o.collided=!0,o.bodyA=d.id<l.id?d:l,o.bodyB=d.id<l.id?l:d,o.parentA=o.bodyA.parent,o.parentB=o.bodyB.parent),d=o.bodyA,l=o.bodyB;var u;f.overlap<c.overlap?u=f:u=c;var g=o.normal,M=o.supports,E=u.axis,T=E.x,h=E.y;T*(l.position.x-d.position.x)+h*(l.position.y-d.position.y)<0?(g.x=T,g.y=h):(g.x=-T,g.y=-h),o.tangent.x=-g.y,o.tangent.y=g.x,o.depth=u.overlap,o.penetration.x=g.x*o.depth,o.penetration.y=g.y*o.depth;var S=e._findSupports(d,l,g,1),C=0;if(n.contains(d.vertices,S[0])&&(M[C++]=S[0]),n.contains(d.vertices,S[1])&&(M[C++]=S[1]),C<2){var x=e._findSupports(l,d,g,-1);n.contains(l.vertices,x[0])&&(M[C++]=x[0]),C<2&&n.contains(l.vertices,x[1])&&(M[C++]=x[1])}return C===0&&(M[C++]=S[0]),M.length=C,o},e._overlapAxes=function(d,l,t,s){var o=l.length,u=t.length,g=l[0].x,M=l[0].y,E=t[0].x,T=t[0].y,h=s.length,S=Number.MAX_VALUE,C=0,x,I,P,L,A,F;for(A=0;A<h;A++){var R=s[A],D=R.x,N=R.y,O=g*D+M*N,W=E*D+T*N,U=O,J=W;for(F=1;F<o;F+=1)L=l[F].x*D+l[F].y*N,L>U?U=L:L<O&&(O=L);for(F=1;F<u;F+=1)L=t[F].x*D+t[F].y*N,L>J?J=L:L<W&&(W=L);if(I=U-W,P=J-O,x=I<P?I:P,x<S&&(S=x,C=A,x<=0))break}d.axis=s[C],d.overlap=S},e._projectToAxis=function(d,l,t){for(var s=l[0].x*t.x+l[0].y*t.y,o=s,u=1;u<l.length;u+=1){var g=l[u].x*t.x+l[u].y*t.y;g>o?o=g:g<s&&(s=g)}d.min=s,d.max=o},e._findSupports=function(d,l,t,s){var o=l.vertices,u=o.length,g=d.position.x,M=d.position.y,E=t.x*s,T=t.y*s,h=Number.MAX_VALUE,S,C,x,I,P;for(P=0;P<u;P+=1)C=o[P],I=E*(g-C.x)+T*(M-C.y),I<h&&(h=I,S=C);return x=o[(u+S.index-1)%u],h=E*(g-x.x)+T*(M-x.y),C=o[(S.index+1)%u],E*(g-C.x)+T*(M-C.y)<h?(i[0]=S,i[1]=C,i):(i[0]=S,i[1]=x,i)}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(16);(function(){e.create=function(r,i){var f=r.bodyA,c=r.bodyB,d={id:e.id(f,c),bodyA:f,bodyB:c,collision:r,contacts:[],activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:f.isSensor||c.isSensor,timeCreated:i,timeUpdated:i,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return e.update(d,r,i),d},e.update=function(r,i,f){var c=r.contacts,d=i.supports,l=r.activeContacts,t=i.parentA,s=i.parentB,o=t.vertices.length;r.isActive=!0,r.timeUpdated=f,r.collision=i,r.separation=i.depth,r.inverseMass=t.inverseMass+s.inverseMass,r.friction=t.friction<s.friction?t.friction:s.friction,r.frictionStatic=t.frictionStatic>s.frictionStatic?t.frictionStatic:s.frictionStatic,r.restitution=t.restitution>s.restitution?t.restitution:s.restitution,r.slop=t.slop>s.slop?t.slop:s.slop,i.pair=r,l.length=0;for(var u=0;u<d.length;u++){var g=d[u],M=g.body===t?g.index:o+g.index,E=c[M];E?l.push(E):l.push(c[M]=n.create(g))}},e.setActive=function(r,i,f){i?(r.isActive=!0,r.timeUpdated=f):(r.isActive=!1,r.activeContacts.length=0)},e.id=function(r,i){return r.id<i.id?"A"+r.id+"B"+i.id:"A"+i.id+"B"+r.id}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(3),r=a(2),i=a(7),f=a(1),c=a(11),d=a(0);(function(){e._warming=.4,e._torqueDampen=1,e._minLength=1e-6,e.create=function(l){var t=l;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var s=t.bodyA?r.add(t.bodyA.position,t.pointA):t.pointA,o=t.bodyB?r.add(t.bodyB.position,t.pointB):t.pointB,u=r.magnitude(r.sub(s,o));t.length=typeof t.length<"u"?t.length:u,t.id=t.id||d.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var g={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return t.length===0&&t.stiffness>.1?(g.type="pin",g.anchors=!1):t.stiffness<.9&&(g.type="spring"),t.render=d.extend(g,t.render),t},e.preSolveAll=function(l){for(var t=0;t<l.length;t+=1){var s=l[t],o=s.constraintImpulse;s.isStatic||o.x===0&&o.y===0&&o.angle===0||(s.position.x+=o.x,s.position.y+=o.y,s.angle+=o.angle)}},e.solveAll=function(l,t){for(var s=d.clamp(t/d._baseDelta,0,1),o=0;o<l.length;o+=1){var u=l[o],g=!u.bodyA||u.bodyA&&u.bodyA.isStatic,M=!u.bodyB||u.bodyB&&u.bodyB.isStatic;(g||M)&&e.solve(l[o],s)}for(o=0;o<l.length;o+=1)u=l[o],g=!u.bodyA||u.bodyA&&u.bodyA.isStatic,M=!u.bodyB||u.bodyB&&u.bodyB.isStatic,!g&&!M&&e.solve(l[o],s)},e.solve=function(l,t){var s=l.bodyA,o=l.bodyB,u=l.pointA,g=l.pointB;if(!(!s&&!o)){s&&!s.isStatic&&(r.rotate(u,s.angle-l.angleA,u),l.angleA=s.angle),o&&!o.isStatic&&(r.rotate(g,o.angle-l.angleB,g),l.angleB=o.angle);var M=u,E=g;if(s&&(M=r.add(s.position,u)),o&&(E=r.add(o.position,g)),!(!M||!E)){var T=r.sub(M,E),h=r.magnitude(T);h<e._minLength&&(h=e._minLength);var S=(h-l.length)/h,C=l.stiffness>=1||l.length===0,x=C?l.stiffness*t:l.stiffness*t*t,I=l.damping*t,P=r.mult(T,S*x),L=(s?s.inverseMass:0)+(o?o.inverseMass:0),A=(s?s.inverseInertia:0)+(o?o.inverseInertia:0),F=L+A,R,D,N,O,W;if(I>0){var U=r.create();N=r.div(T,h),W=r.sub(o&&r.sub(o.position,o.positionPrev)||U,s&&r.sub(s.position,s.positionPrev)||U),O=r.dot(N,W)}s&&!s.isStatic&&(D=s.inverseMass/L,s.constraintImpulse.x-=P.x*D,s.constraintImpulse.y-=P.y*D,s.position.x-=P.x*D,s.position.y-=P.y*D,I>0&&(s.positionPrev.x-=I*N.x*O*D,s.positionPrev.y-=I*N.y*O*D),R=r.cross(u,P)/F*e._torqueDampen*s.inverseInertia*(1-l.angularStiffness),s.constraintImpulse.angle-=R,s.angle-=R),o&&!o.isStatic&&(D=o.inverseMass/L,o.constraintImpulse.x+=P.x*D,o.constraintImpulse.y+=P.y*D,o.position.x+=P.x*D,o.position.y+=P.y*D,I>0&&(o.positionPrev.x+=I*N.x*O*D,o.positionPrev.y+=I*N.y*O*D),R=r.cross(g,P)/F*e._torqueDampen*o.inverseInertia*(1-l.angularStiffness),o.constraintImpulse.angle+=R,o.angle+=R)}}},e.postSolveAll=function(l){for(var t=0;t<l.length;t++){var s=l[t],o=s.constraintImpulse;if(!(s.isStatic||o.x===0&&o.y===0&&o.angle===0)){i.set(s,!1);for(var u=0;u<s.parts.length;u++){var g=s.parts[u];n.translate(g.vertices,o),u>0&&(g.position.x+=o.x,g.position.y+=o.y),o.angle!==0&&(n.rotate(g.vertices,o.angle,s.position),c.rotate(g.axes,o.angle),u>0&&r.rotateAbout(g.position,o.angle,s.position,g.position)),f.update(g.bounds,g.vertices,s.velocity)}o.angle*=e._warming,o.x*=e._warming,o.y*=e._warming}}},e.pointAWorld=function(l){return{x:(l.bodyA?l.bodyA.position.x:0)+(l.pointA?l.pointA.x:0),y:(l.bodyA?l.bodyA.position.y:0)+(l.pointA?l.pointA.y:0)}},e.pointBWorld=function(l){return{x:(l.bodyB?l.bodyB.position.x:0)+(l.pointB?l.pointB.x:0),y:(l.bodyB?l.bodyB.position.y:0)+(l.pointB?l.pointB.y:0)}}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(2),r=a(0);(function(){e.fromVertices=function(i){for(var f={},c=0;c<i.length;c++){var d=(c+1)%i.length,l=n.normalise({x:i[d].y-i[c].y,y:i[c].x-i[d].x}),t=l.y===0?1/0:l.x/l.y;t=t.toFixed(3).toString(),f[t]=l}return r.values(f)},e.rotate=function(i,f){if(f!==0)for(var c=Math.cos(f),d=Math.sin(f),l=0;l<i.length;l++){var t=i[l],s;s=t.x*c-t.y*d,t.y=t.x*d+t.y*c,t.x=s}}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(3),r=a(0),i=a(4),f=a(1),c=a(2);(function(){e.rectangle=function(d,l,t,s,o){o=o||{};var u={label:"Rectangle Body",position:{x:d,y:l},vertices:n.fromPath("L 0 0 L "+t+" 0 L "+t+" "+s+" L 0 "+s)};if(o.chamfer){var g=o.chamfer;u.vertices=n.chamfer(u.vertices,g.radius,g.quality,g.qualityMin,g.qualityMax),delete o.chamfer}return i.create(r.extend({},u,o))},e.trapezoid=function(d,l,t,s,o,u){u=u||{},o*=.5;var g=(1-o*2)*t,M=t*o,E=M+g,T=E+M,h;o<.5?h="L 0 0 L "+M+" "+-s+" L "+E+" "+-s+" L "+T+" 0":h="L 0 0 L "+E+" "+-s+" L "+T+" 0";var S={label:"Trapezoid Body",position:{x:d,y:l},vertices:n.fromPath(h)};if(u.chamfer){var C=u.chamfer;S.vertices=n.chamfer(S.vertices,C.radius,C.quality,C.qualityMin,C.qualityMax),delete u.chamfer}return i.create(r.extend({},S,u))},e.circle=function(d,l,t,s,o){s=s||{};var u={label:"Circle Body",circleRadius:t};o=o||25;var g=Math.ceil(Math.max(10,Math.min(o,t)));return g%2===1&&(g+=1),e.polygon(d,l,g,t,r.extend({},u,s))},e.polygon=function(d,l,t,s,o){if(o=o||{},t<3)return e.circle(d,l,s,o);for(var u=2*Math.PI/t,g="",M=u*.5,E=0;E<t;E+=1){var T=M+E*u,h=Math.cos(T)*s,S=Math.sin(T)*s;g+="L "+h.toFixed(3)+" "+S.toFixed(3)+" "}var C={label:"Polygon Body",position:{x:d,y:l},vertices:n.fromPath(g)};if(o.chamfer){var x=o.chamfer;C.vertices=n.chamfer(C.vertices,x.radius,x.quality,x.qualityMin,x.qualityMax),delete o.chamfer}return i.create(r.extend({},C,o))},e.fromVertices=function(d,l,t,s,o,u,g,M){var E=r.getDecomp(),T,h,S,C,x,I,P,L,A,F,R;for(T=!!(E&&E.quickDecomp),s=s||{},S=[],o=typeof o<"u"?o:!1,u=typeof u<"u"?u:.01,g=typeof g<"u"?g:10,M=typeof M<"u"?M:.01,r.isArray(t[0])||(t=[t]),F=0;F<t.length;F+=1)if(I=t[F],C=n.isConvex(I),x=!C,x&&!T&&r.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),C||!T)C?I=n.clockwiseSort(I):I=n.hull(I),S.push({position:{x:d,y:l},vertices:I});else{var D=I.map(function(K){return[K.x,K.y]});E.makeCCW(D),u!==!1&&E.removeCollinearPoints(D,u),M!==!1&&E.removeDuplicatePoints&&E.removeDuplicatePoints(D,M);var N=E.quickDecomp(D);for(P=0;P<N.length;P++){var O=N[P],W=O.map(function(K){return{x:K[0],y:K[1]}});g>0&&n.area(W)<g||S.push({position:n.centre(W),vertices:W})}}for(P=0;P<S.length;P++)S[P]=i.create(r.extend(S[P],s));if(o){var U=5;for(P=0;P<S.length;P++){var J=S[P];for(L=P+1;L<S.length;L++){var X=S[L];if(f.overlaps(J.bounds,X.bounds)){var $=J.vertices,Y=X.vertices;for(A=0;A<J.vertices.length;A++)for(R=0;R<X.vertices.length;R++){var Z=c.magnitudeSquared(c.sub($[(A+1)%$.length],Y[R])),ee=c.magnitudeSquared(c.sub($[A],Y[(R+1)%Y.length]));Z<U&&ee<U&&($[A].isInternal=!0,Y[R].isInternal=!0)}}}}}return S.length>1?(h=i.create(r.extend({parts:S.slice(0)},s)),i.setPosition(h,{x:d,y:l}),h):S[0]}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(0),r=a(8);(function(){e.create=function(i){var f={bodies:[],pairs:null};return n.extend(f,i)},e.setBodies=function(i,f){i.bodies=f.slice(0)},e.clear=function(i){i.bodies=[]},e.collisions=function(i){var f=[],c=i.pairs,d=i.bodies,l=d.length,t=e.canCollide,s=r.collides,o,u;for(d.sort(e._compareBoundsX),o=0;o<l;o++){var g=d[o],M=g.bounds,E=g.bounds.max.x,T=g.bounds.max.y,h=g.bounds.min.y,S=g.isStatic||g.isSleeping,C=g.parts.length,x=C===1;for(u=o+1;u<l;u++){var I=d[u],P=I.bounds;if(P.min.x>E)break;if(!(T<P.min.y||h>P.max.y)&&!(S&&(I.isStatic||I.isSleeping))&&t(g.collisionFilter,I.collisionFilter)){var L=I.parts.length;if(x&&L===1){var A=s(g,I,c);A&&f.push(A)}else for(var F=C>1?1:0,R=L>1?1:0,D=F;D<C;D++)for(var N=g.parts[D],M=N.bounds,O=R;O<L;O++){var W=I.parts[O],P=W.bounds;if(!(M.min.x>P.max.x||M.max.x<P.min.x||M.max.y<P.min.y||M.min.y>P.max.y)){var A=s(N,W,c);A&&f.push(A)}}}}}return f},e.canCollide=function(i,f){return i.group===f.group&&i.group!==0?i.group>0:(i.mask&f.category)!==0&&(f.mask&i.category)!==0},e._compareBoundsX=function(i,f){return i.bounds.min.x-f.bounds.min.x}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(0);(function(){e.create=function(r){var i={};return r||n.log("Mouse.create: element was undefined, defaulting to document.body","warn"),i.element=r||document.body,i.absolute={x:0,y:0},i.position={x:0,y:0},i.mousedownPosition={x:0,y:0},i.mouseupPosition={x:0,y:0},i.offset={x:0,y:0},i.scale={x:1,y:1},i.wheelDelta=0,i.button=-1,i.pixelRatio=parseInt(i.element.getAttribute("data-pixel-ratio"),10)||1,i.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},i.mousemove=function(f){var c=e._getRelativeMousePosition(f,i.element,i.pixelRatio),d=f.changedTouches;d&&(i.button=0,f.preventDefault()),i.absolute.x=c.x,i.absolute.y=c.y,i.position.x=i.absolute.x*i.scale.x+i.offset.x,i.position.y=i.absolute.y*i.scale.y+i.offset.y,i.sourceEvents.mousemove=f},i.mousedown=function(f){var c=e._getRelativeMousePosition(f,i.element,i.pixelRatio),d=f.changedTouches;d?(i.button=0,f.preventDefault()):i.button=f.button,i.absolute.x=c.x,i.absolute.y=c.y,i.position.x=i.absolute.x*i.scale.x+i.offset.x,i.position.y=i.absolute.y*i.scale.y+i.offset.y,i.mousedownPosition.x=i.position.x,i.mousedownPosition.y=i.position.y,i.sourceEvents.mousedown=f},i.mouseup=function(f){var c=e._getRelativeMousePosition(f,i.element,i.pixelRatio),d=f.changedTouches;d&&f.preventDefault(),i.button=-1,i.absolute.x=c.x,i.absolute.y=c.y,i.position.x=i.absolute.x*i.scale.x+i.offset.x,i.position.y=i.absolute.y*i.scale.y+i.offset.y,i.mouseupPosition.x=i.position.x,i.mouseupPosition.y=i.position.y,i.sourceEvents.mouseup=f},i.mousewheel=function(f){i.wheelDelta=Math.max(-1,Math.min(1,f.wheelDelta||-f.detail)),f.preventDefault()},e.setElement(i,i.element),i},e.setElement=function(r,i){r.element=i,i.addEventListener("mousemove",r.mousemove),i.addEventListener("mousedown",r.mousedown),i.addEventListener("mouseup",r.mouseup),i.addEventListener("mousewheel",r.mousewheel),i.addEventListener("DOMMouseScroll",r.mousewheel),i.addEventListener("touchmove",r.mousemove),i.addEventListener("touchstart",r.mousedown),i.addEventListener("touchend",r.mouseup)},e.clearSourceEvents=function(r){r.sourceEvents.mousemove=null,r.sourceEvents.mousedown=null,r.sourceEvents.mouseup=null,r.sourceEvents.mousewheel=null,r.wheelDelta=0},e.setOffset=function(r,i){r.offset.x=i.x,r.offset.y=i.y,r.position.x=r.absolute.x*r.scale.x+r.offset.x,r.position.y=r.absolute.y*r.scale.y+r.offset.y},e.setScale=function(r,i){r.scale.x=i.x,r.scale.y=i.y,r.position.x=r.absolute.x*r.scale.x+r.offset.x,r.position.y=r.absolute.y*r.scale.y+r.offset.y},e._getRelativeMousePosition=function(r,i,f){var c=i.getBoundingClientRect(),d=document.documentElement||document.body.parentNode||document.body,l=window.pageXOffset!==void 0?window.pageXOffset:d.scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:d.scrollTop,s=r.changedTouches,o,u;return s?(o=s[0].pageX-c.left-l,u=s[0].pageY-c.top-t):(o=r.pageX-c.left-l,u=r.pageY-c.top-t),{x:o/(i.clientWidth/(i.width||i.clientWidth)*f),y:u/(i.clientHeight/(i.height||i.clientHeight)*f)}}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(0);(function(){e._registry={},e.register=function(r){if(e.isPlugin(r)||n.warn("Plugin.register:",e.toString(r),"does not implement all required fields."),r.name in e._registry){var i=e._registry[r.name],f=e.versionParse(r.version).number,c=e.versionParse(i.version).number;f>c?(n.warn("Plugin.register:",e.toString(i),"was upgraded to",e.toString(r)),e._registry[r.name]=r):f<c?n.warn("Plugin.register:",e.toString(i),"can not be downgraded to",e.toString(r)):r!==i&&n.warn("Plugin.register:",e.toString(r),"is already registered to different plugin object")}else e._registry[r.name]=r;return r},e.resolve=function(r){return e._registry[e.dependencyParse(r).name]},e.toString=function(r){return typeof r=="string"?r:(r.name||"anonymous")+"@"+(r.version||r.range||"0.0.0")},e.isPlugin=function(r){return r&&r.name&&r.version&&r.install},e.isUsed=function(r,i){return r.used.indexOf(i)>-1},e.isFor=function(r,i){var f=r.for&&e.dependencyParse(r.for);return!r.for||i.name===f.name&&e.versionSatisfies(i.version,f.range)},e.use=function(r,i){if(r.uses=(r.uses||[]).concat(i||[]),r.uses.length===0){n.warn("Plugin.use:",e.toString(r),"does not specify any dependencies to install.");return}for(var f=e.dependencies(r),c=n.topologicalSort(f),d=[],l=0;l<c.length;l+=1)if(c[l]!==r.name){var t=e.resolve(c[l]);if(!t){d.push("âŒ "+c[l]);continue}e.isUsed(r,t.name)||(e.isFor(t,r)||(n.warn("Plugin.use:",e.toString(t),"is for",t.for,"but installed on",e.toString(r)+"."),t._warned=!0),t.install?t.install(r):(n.warn("Plugin.use:",e.toString(t),"does not specify an install function."),t._warned=!0),t._warned?(d.push("ðŸ”¶ "+e.toString(t)),delete t._warned):d.push("âœ… "+e.toString(t)),r.used.push(t.name))}d.length>0&&n.info(d.join("  "))},e.dependencies=function(r,i){var f=e.dependencyParse(r),c=f.name;if(i=i||{},!(c in i)){r=e.resolve(r)||r,i[c]=n.map(r.uses||[],function(l){e.isPlugin(l)&&e.register(l);var t=e.dependencyParse(l),s=e.resolve(l);return s&&!e.versionSatisfies(s.version,t.range)?(n.warn("Plugin.dependencies:",e.toString(s),"does not satisfy",e.toString(t),"used by",e.toString(f)+"."),s._warned=!0,r._warned=!0):s||(n.warn("Plugin.dependencies:",e.toString(l),"used by",e.toString(f),"could not be resolved."),r._warned=!0),t.name});for(var d=0;d<i[c].length;d+=1)e.dependencies(i[c][d],i);return i}},e.dependencyParse=function(r){if(n.isString(r)){var i=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return i.test(r)||n.warn("Plugin.dependencyParse:",r,"is not a valid dependency string."),{name:r.split("@")[0],range:r.split("@")[1]||"*"}}return{name:r.name,range:r.range||r.version}},e.versionParse=function(r){var i=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;i.test(r)||n.warn("Plugin.versionParse:",r,"is not a valid version or range.");var f=i.exec(r),c=Number(f[4]),d=Number(f[5]),l=Number(f[6]);return{isRange:!!(f[1]||f[2]),version:f[3],range:r,operator:f[1]||f[2]||"",major:c,minor:d,patch:l,parts:[c,d,l],prerelease:f[7],number:c*1e8+d*1e4+l}},e.versionSatisfies=function(r,i){i=i||"*";var f=e.versionParse(i),c=e.versionParse(r);if(f.isRange){if(f.operator==="*"||r==="*")return!0;if(f.operator===">")return c.number>f.number;if(f.operator===">=")return c.number>=f.number;if(f.operator==="~")return c.major===f.major&&c.minor===f.minor&&c.patch>=f.patch;if(f.operator==="^")return f.major>0?c.major===f.major&&c.number>=f.number:f.minor>0?c.minor===f.minor&&c.patch>=f.patch:c.patch===f.patch}return r===i||r==="*"}})()}),(function(m,w){var a={};m.exports=a,(function(){a.create=function(e){return{vertex:e,normalImpulse:0,tangentImpulse:0}}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(7),r=a(18),i=a(13),f=a(19),c=a(5),d=a(6),l=a(10),t=a(0),s=a(4);(function(){e.create=function(o){o=o||{};var u={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},g=t.extend(u,o);return g.world=o.world||d.create({label:"World"}),g.pairs=o.pairs||f.create(),g.detector=o.detector||i.create(),g.grid={buckets:[]},g.world.gravity=g.gravity,g.broadphase=g.grid,g.metrics={},g},e.update=function(o,u){var g=t.now(),M=o.world,E=o.detector,T=o.pairs,h=o.timing,S=h.timestamp,C;u=typeof u<"u"?u:t._baseDelta,u*=h.timeScale,h.timestamp+=u,h.lastDelta=u;var x={timestamp:h.timestamp,delta:u};c.trigger(o,"beforeUpdate",x);var I=d.allBodies(M),P=d.allConstraints(M);for(M.isModified&&(i.setBodies(E,I),d.setModified(M,!1,!1,!0)),o.enableSleeping&&n.update(I,u),e._bodiesApplyGravity(I,o.gravity),u>0&&e._bodiesUpdate(I,u),l.preSolveAll(I),C=0;C<o.constraintIterations;C++)l.solveAll(P,u);l.postSolveAll(I),E.pairs=o.pairs;var L=i.collisions(E);f.update(T,L,S),o.enableSleeping&&n.afterCollisions(T.list),T.collisionStart.length>0&&c.trigger(o,"collisionStart",{pairs:T.collisionStart});var A=t.clamp(20/o.positionIterations,0,1);for(r.preSolvePosition(T.list),C=0;C<o.positionIterations;C++)r.solvePosition(T.list,u,A);for(r.postSolvePosition(I),l.preSolveAll(I),C=0;C<o.constraintIterations;C++)l.solveAll(P,u);for(l.postSolveAll(I),r.preSolveVelocity(T.list),C=0;C<o.velocityIterations;C++)r.solveVelocity(T.list,u);return e._bodiesUpdateVelocities(I),T.collisionActive.length>0&&c.trigger(o,"collisionActive",{pairs:T.collisionActive}),T.collisionEnd.length>0&&c.trigger(o,"collisionEnd",{pairs:T.collisionEnd}),e._bodiesClearForces(I),c.trigger(o,"afterUpdate",x),o.timing.lastElapsed=t.now()-g,o},e.merge=function(o,u){if(t.extend(o,u),u.world){o.world=u.world,e.clear(o);for(var g=d.allBodies(o.world),M=0;M<g.length;M++){var E=g[M];n.set(E,!1),E.id=t.nextId()}}},e.clear=function(o){f.clear(o.pairs),i.clear(o.detector)},e._bodiesClearForces=function(o){for(var u=o.length,g=0;g<u;g++){var M=o[g];M.force.x=0,M.force.y=0,M.torque=0}},e._bodiesApplyGravity=function(o,u){var g=typeof u.scale<"u"?u.scale:.001,M=o.length;if(!(u.x===0&&u.y===0||g===0))for(var E=0;E<M;E++){var T=o[E];T.isStatic||T.isSleeping||(T.force.y+=T.mass*u.y*g,T.force.x+=T.mass*u.x*g)}},e._bodiesUpdate=function(o,u){for(var g=o.length,M=0;M<g;M++){var E=o[M];E.isStatic||E.isSleeping||s.update(E,u)}},e._bodiesUpdateVelocities=function(o){for(var u=o.length,g=0;g<u;g++)s.updateVelocities(o[g])}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(3),r=a(0),i=a(1);(function(){e._restingThresh=2,e._restingThreshTangent=Math.sqrt(6),e._positionDampen=.9,e._positionWarming=.8,e._frictionNormalMultiplier=5,e._frictionMaxStatic=Number.MAX_VALUE,e.preSolvePosition=function(f){var c,d,l,t=f.length;for(c=0;c<t;c++)d=f[c],d.isActive&&(l=d.activeContacts.length,d.collision.parentA.totalContacts+=l,d.collision.parentB.totalContacts+=l)},e.solvePosition=function(f,c,d){var l,t,s,o,u,g,M,E,T=e._positionDampen*(d||1),h=r.clamp(c/r._baseDelta,0,1),S=f.length;for(l=0;l<S;l++)t=f[l],!(!t.isActive||t.isSensor)&&(s=t.collision,o=s.parentA,u=s.parentB,g=s.normal,t.separation=g.x*(u.positionImpulse.x+s.penetration.x-o.positionImpulse.x)+g.y*(u.positionImpulse.y+s.penetration.y-o.positionImpulse.y));for(l=0;l<S;l++)t=f[l],!(!t.isActive||t.isSensor)&&(s=t.collision,o=s.parentA,u=s.parentB,g=s.normal,E=t.separation-t.slop*h,(o.isStatic||u.isStatic)&&(E*=2),o.isStatic||o.isSleeping||(M=T/o.totalContacts,o.positionImpulse.x+=g.x*E*M,o.positionImpulse.y+=g.y*E*M),u.isStatic||u.isSleeping||(M=T/u.totalContacts,u.positionImpulse.x-=g.x*E*M,u.positionImpulse.y-=g.y*E*M))},e.postSolvePosition=function(f){for(var c=e._positionWarming,d=f.length,l=n.translate,t=i.update,s=0;s<d;s++){var o=f[s],u=o.positionImpulse,g=u.x,M=u.y,E=o.velocity;if(o.totalContacts=0,g!==0||M!==0){for(var T=0;T<o.parts.length;T++){var h=o.parts[T];l(h.vertices,u),t(h.bounds,h.vertices,E),h.position.x+=g,h.position.y+=M}o.positionPrev.x+=g,o.positionPrev.y+=M,g*E.x+M*E.y<0?(u.x=0,u.y=0):(u.x*=c,u.y*=c)}}},e.preSolveVelocity=function(f){var c=f.length,d,l;for(d=0;d<c;d++){var t=f[d];if(!(!t.isActive||t.isSensor)){var s=t.activeContacts,o=s.length,u=t.collision,g=u.parentA,M=u.parentB,E=u.normal,T=u.tangent;for(l=0;l<o;l++){var h=s[l],S=h.vertex,C=h.normalImpulse,x=h.tangentImpulse;if(C!==0||x!==0){var I=E.x*C+T.x*x,P=E.y*C+T.y*x;g.isStatic||g.isSleeping||(g.positionPrev.x+=I*g.inverseMass,g.positionPrev.y+=P*g.inverseMass,g.anglePrev+=g.inverseInertia*((S.x-g.position.x)*P-(S.y-g.position.y)*I)),M.isStatic||M.isSleeping||(M.positionPrev.x-=I*M.inverseMass,M.positionPrev.y-=P*M.inverseMass,M.anglePrev-=M.inverseInertia*((S.x-M.position.x)*P-(S.y-M.position.y)*I))}}}}},e.solveVelocity=function(f,c){var d=c/r._baseDelta,l=d*d,t=l*d,s=-e._restingThresh*d,o=e._restingThreshTangent,u=e._frictionNormalMultiplier*d,g=e._frictionMaxStatic,M=f.length,E,T,h,S;for(h=0;h<M;h++){var C=f[h];if(!(!C.isActive||C.isSensor)){var x=C.collision,I=x.parentA,P=x.parentB,L=I.velocity,A=P.velocity,F=x.normal.x,R=x.normal.y,D=x.tangent.x,N=x.tangent.y,O=C.activeContacts,W=O.length,U=1/W,J=I.inverseMass+P.inverseMass,X=C.friction*C.frictionStatic*u;for(L.x=I.position.x-I.positionPrev.x,L.y=I.position.y-I.positionPrev.y,A.x=P.position.x-P.positionPrev.x,A.y=P.position.y-P.positionPrev.y,I.angularVelocity=I.angle-I.anglePrev,P.angularVelocity=P.angle-P.anglePrev,S=0;S<W;S++){var $=O[S],Y=$.vertex,Z=Y.x-I.position.x,ee=Y.y-I.position.y,K=Y.x-P.position.x,ne=Y.y-P.position.y,j=L.x-ee*I.angularVelocity,Pe=L.y+Z*I.angularVelocity,Me=A.x-ne*P.angularVelocity,Ie=A.y+K*P.angularVelocity,pe=j-Me,me=Pe-Ie,de=F*pe+R*me,re=D*pe+N*me,ge=C.separation+de,he=Math.min(ge,1);he=ge<0?0:he;var ve=he*X;re<-ve||re>ve?(T=re>0?re:-re,E=C.friction*(re>0?1:-1)*t,E<-T?E=-T:E>T&&(E=T)):(E=re,T=g);var ye=Z*R-ee*F,xe=K*R-ne*F,Se=U/(J+I.inverseInertia*ye*ye+P.inverseInertia*xe*xe),le=(1+C.restitution)*de*Se;if(E*=Se,de<s)$.normalImpulse=0;else{var Ee=$.normalImpulse;$.normalImpulse+=le,$.normalImpulse>0&&($.normalImpulse=0),le=$.normalImpulse-Ee}if(re<-o||re>o)$.tangentImpulse=0;else{var Be=$.tangentImpulse;$.tangentImpulse+=E,$.tangentImpulse<-T&&($.tangentImpulse=-T),$.tangentImpulse>T&&($.tangentImpulse=T),E=$.tangentImpulse-Be}var ce=F*le+D*E,fe=R*le+N*E;I.isStatic||I.isSleeping||(I.positionPrev.x+=ce*I.inverseMass,I.positionPrev.y+=fe*I.inverseMass,I.anglePrev+=(Z*fe-ee*ce)*I.inverseInertia),P.isStatic||P.isSleeping||(P.positionPrev.x-=ce*P.inverseMass,P.positionPrev.y-=fe*P.inverseMass,P.anglePrev-=(K*fe-ne*ce)*P.inverseInertia)}}}}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(9),r=a(0);(function(){e.create=function(i){return r.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},i)},e.update=function(i,f,c){var d=i.list,l=d.length,t=i.table,s=f.length,o=i.collisionStart,u=i.collisionEnd,g=i.collisionActive,M,E,T,h;for(o.length=0,u.length=0,g.length=0,h=0;h<l;h++)d[h].confirmedActive=!1;for(h=0;h<s;h++)M=f[h],T=M.pair,T?(T.isActive?g.push(T):o.push(T),n.update(T,M,c),T.confirmedActive=!0):(T=n.create(M,c),t[T.id]=T,o.push(T),d.push(T));var S=[];for(l=d.length,h=0;h<l;h++)T=d[h],T.confirmedActive||(n.setActive(T,!1,c),u.push(T),!T.collision.bodyA.isSleeping&&!T.collision.bodyB.isSleeping&&S.push(h));for(h=0;h<S.length;h++)E=S[h]-h,T=d[E],d.splice(E,1),delete t[T.id]},e.clear=function(i){return i.table={},i.list.length=0,i.collisionStart.length=0,i.collisionActive.length=0,i.collisionEnd.length=0,i}})()}),(function(m,w,a){var e=m.exports=a(21);e.Axes=a(11),e.Bodies=a(12),e.Body=a(4),e.Bounds=a(1),e.Collision=a(8),e.Common=a(0),e.Composite=a(6),e.Composites=a(22),e.Constraint=a(10),e.Contact=a(16),e.Detector=a(13),e.Engine=a(17),e.Events=a(5),e.Grid=a(23),e.Mouse=a(14),e.MouseConstraint=a(24),e.Pair=a(9),e.Pairs=a(19),e.Plugin=a(15),e.Query=a(25),e.Render=a(26),e.Resolver=a(18),e.Runner=a(27),e.SAT=a(28),e.Sleeping=a(7),e.Svg=a(29),e.Vector=a(2),e.Vertices=a(3),e.World=a(30),e.Engine.run=e.Runner.run,e.Common.deprecated(e.Engine,"run","Engine.run âž¤ use Matter.Runner.run(engine) instead")}),(function(m,w,a){var e={};m.exports=e;var n=a(15),r=a(0);(function(){e.name="matter-js",e.version="0.19.0",e.uses=[],e.used=[],e.use=function(){n.use(e,Array.prototype.slice.call(arguments))},e.before=function(i,f){return i=i.replace(/^Matter./,""),r.chainPathBefore(e,i,f)},e.after=function(i,f){return i=i.replace(/^Matter./,""),r.chainPathAfter(e,i,f)}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(6),r=a(10),i=a(0),f=a(4),c=a(12),d=i.deprecated;(function(){e.stack=function(l,t,s,o,u,g,M){for(var E=n.create({label:"Stack"}),T=l,h=t,S,C=0,x=0;x<o;x++){for(var I=0,P=0;P<s;P++){var L=M(T,h,P,x,S,C);if(L){var A=L.bounds.max.y-L.bounds.min.y,F=L.bounds.max.x-L.bounds.min.x;A>I&&(I=A),f.translate(L,{x:F*.5,y:A*.5}),T=L.bounds.max.x+u,n.addBody(E,L),S=L,C+=1}else T+=u}h+=I+g,T=l}return E},e.chain=function(l,t,s,o,u,g){for(var M=l.bodies,E=1;E<M.length;E++){var T=M[E-1],h=M[E],S=T.bounds.max.y-T.bounds.min.y,C=T.bounds.max.x-T.bounds.min.x,x=h.bounds.max.y-h.bounds.min.y,I=h.bounds.max.x-h.bounds.min.x,P={bodyA:T,pointA:{x:C*t,y:S*s},bodyB:h,pointB:{x:I*o,y:x*u}},L=i.extend(P,g);n.addConstraint(l,r.create(L))}return l.label+=" Chain",l},e.mesh=function(l,t,s,o,u){var g=l.bodies,M,E,T,h,S;for(M=0;M<s;M++){for(E=1;E<t;E++)T=g[E-1+M*t],h=g[E+M*t],n.addConstraint(l,r.create(i.extend({bodyA:T,bodyB:h},u)));if(M>0)for(E=0;E<t;E++)T=g[E+(M-1)*t],h=g[E+M*t],n.addConstraint(l,r.create(i.extend({bodyA:T,bodyB:h},u))),o&&E>0&&(S=g[E-1+(M-1)*t],n.addConstraint(l,r.create(i.extend({bodyA:S,bodyB:h},u)))),o&&E<t-1&&(S=g[E+1+(M-1)*t],n.addConstraint(l,r.create(i.extend({bodyA:S,bodyB:h},u))))}return l.label+=" Mesh",l},e.pyramid=function(l,t,s,o,u,g,M){return e.stack(l,t,s,o,u,g,function(E,T,h,S,C,x){var I=Math.min(o,Math.ceil(s/2)),P=C?C.bounds.max.x-C.bounds.min.x:0;if(!(S>I)){S=I-S;var L=S,A=s-1-S;if(!(h<L||h>A)){x===1&&f.translate(C,{x:(h+(s%2===1?1:-1))*P,y:0});var F=C?h*P:0;return M(l+F+h*u,T,h,S,C,x)}}})},e.newtonsCradle=function(l,t,s,o,u){for(var g=n.create({label:"Newtons Cradle"}),M=0;M<s;M++){var E=1.9,T=c.circle(l+M*(o*E),t+u,o,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),h=r.create({pointA:{x:l+M*(o*E),y:t},bodyB:T});n.addBody(g,T),n.addConstraint(g,h)}return g},d(e,"newtonsCradle","Composites.newtonsCradle âž¤ moved to newtonsCradle example"),e.car=function(l,t,s,o,u){var g=f.nextGroup(!0),M=20,E=-s*.5+M,T=s*.5-M,h=0,S=n.create({label:"Car"}),C=c.rectangle(l,t,s,o,{collisionFilter:{group:g},chamfer:{radius:o*.5},density:2e-4}),x=c.circle(l+E,t+h,u,{collisionFilter:{group:g},friction:.8}),I=c.circle(l+T,t+h,u,{collisionFilter:{group:g},friction:.8}),P=r.create({bodyB:C,pointB:{x:E,y:h},bodyA:x,stiffness:1,length:0}),L=r.create({bodyB:C,pointB:{x:T,y:h},bodyA:I,stiffness:1,length:0});return n.addBody(S,C),n.addBody(S,x),n.addBody(S,I),n.addConstraint(S,P),n.addConstraint(S,L),S},d(e,"car","Composites.car âž¤ moved to car example"),e.softBody=function(l,t,s,o,u,g,M,E,T,h){T=i.extend({inertia:1/0},T),h=i.extend({stiffness:.2,render:{type:"line",anchors:!1}},h);var S=e.stack(l,t,s,o,u,g,function(C,x){return c.circle(C,x,E,T)});return e.mesh(S,s,o,M,h),S.label="Soft Body",S},d(e,"softBody","Composites.softBody âž¤ moved to softBody and cloth examples")})()}),(function(m,w,a){var e={};m.exports=e;var n=a(9),r=a(0),i=r.deprecated;(function(){e.create=function(f){var c={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return r.extend(c,f)},e.update=function(f,c,d,l){var t,s,o,u=d.world,g=f.buckets,M,E,T=!1;for(t=0;t<c.length;t++){var h=c[t];if(!(h.isSleeping&&!l)&&!(u.bounds&&(h.bounds.max.x<u.bounds.min.x||h.bounds.min.x>u.bounds.max.x||h.bounds.max.y<u.bounds.min.y||h.bounds.min.y>u.bounds.max.y))){var S=e._getRegion(f,h);if(!h.region||S.id!==h.region.id||l){(!h.region||l)&&(h.region=S);var C=e._regionUnion(S,h.region);for(s=C.startCol;s<=C.endCol;s++)for(o=C.startRow;o<=C.endRow;o++){E=e._getBucketId(s,o),M=g[E];var x=s>=S.startCol&&s<=S.endCol&&o>=S.startRow&&o<=S.endRow,I=s>=h.region.startCol&&s<=h.region.endCol&&o>=h.region.startRow&&o<=h.region.endRow;!x&&I&&I&&M&&e._bucketRemoveBody(f,M,h),(h.region===S||x&&!I||l)&&(M||(M=e._createBucket(g,E)),e._bucketAddBody(f,M,h))}h.region=S,T=!0}}}T&&(f.pairsList=e._createActivePairsList(f))},i(e,"update","Grid.update âž¤ replaced by Matter.Detector"),e.clear=function(f){f.buckets={},f.pairs={},f.pairsList=[]},i(e,"clear","Grid.clear âž¤ replaced by Matter.Detector"),e._regionUnion=function(f,c){var d=Math.min(f.startCol,c.startCol),l=Math.max(f.endCol,c.endCol),t=Math.min(f.startRow,c.startRow),s=Math.max(f.endRow,c.endRow);return e._createRegion(d,l,t,s)},e._getRegion=function(f,c){var d=c.bounds,l=Math.floor(d.min.x/f.bucketWidth),t=Math.floor(d.max.x/f.bucketWidth),s=Math.floor(d.min.y/f.bucketHeight),o=Math.floor(d.max.y/f.bucketHeight);return e._createRegion(l,t,s,o)},e._createRegion=function(f,c,d,l){return{id:f+","+c+","+d+","+l,startCol:f,endCol:c,startRow:d,endRow:l}},e._getBucketId=function(f,c){return"C"+f+"R"+c},e._createBucket=function(f,c){var d=f[c]=[];return d},e._bucketAddBody=function(f,c,d){var l=f.pairs,t=n.id,s=c.length,o;for(o=0;o<s;o++){var u=c[o];if(!(d.id===u.id||d.isStatic&&u.isStatic)){var g=t(d,u),M=l[g];M?M[2]+=1:l[g]=[d,u,1]}}c.push(d)},e._bucketRemoveBody=function(f,c,d){var l=f.pairs,t=n.id,s;c.splice(r.indexOf(c,d),1);var o=c.length;for(s=0;s<o;s++){var u=l[t(d,c[s])];u&&(u[2]-=1)}},e._createActivePairsList=function(f){var c,d=f.pairs,l=r.keys(d),t=l.length,s=[],o;for(o=0;o<t;o++)c=d[l[o]],c[2]>0?s.push(c):delete d[l[o]];return s}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(3),r=a(7),i=a(14),f=a(5),c=a(13),d=a(10),l=a(6),t=a(0),s=a(1);(function(){e.create=function(o,u){var g=(o?o.mouse:null)||(u?u.mouse:null);g||(o&&o.render&&o.render.canvas?g=i.create(o.render.canvas):u&&u.element?g=i.create(u.element):(g=i.create(),t.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var M=d.create({label:"Mouse Constraint",pointA:g.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),E={type:"mouseConstraint",mouse:g,element:null,body:null,constraint:M,collisionFilter:{category:1,mask:4294967295,group:0}},T=t.extend(E,u);return f.on(o,"beforeUpdate",function(){var h=l.allBodies(o.world);e.update(T,h),e._triggerEvents(T)}),T},e.update=function(o,u){var g=o.mouse,M=o.constraint,E=o.body;if(g.button===0){if(M.bodyB)r.set(M.bodyB,!1),M.pointA=g.position;else for(var T=0;T<u.length;T++)if(E=u[T],s.contains(E.bounds,g.position)&&c.canCollide(E.collisionFilter,o.collisionFilter))for(var h=E.parts.length>1?1:0;h<E.parts.length;h++){var S=E.parts[h];if(n.contains(S.vertices,g.position)){M.pointA=g.position,M.bodyB=o.body=E,M.pointB={x:g.position.x-E.position.x,y:g.position.y-E.position.y},M.angleB=E.angle,r.set(E,!1),f.trigger(o,"startdrag",{mouse:g,body:E});break}}}else M.bodyB=o.body=null,M.pointB=null,E&&f.trigger(o,"enddrag",{mouse:g,body:E})},e._triggerEvents=function(o){var u=o.mouse,g=u.sourceEvents;g.mousemove&&f.trigger(o,"mousemove",{mouse:u}),g.mousedown&&f.trigger(o,"mousedown",{mouse:u}),g.mouseup&&f.trigger(o,"mouseup",{mouse:u}),i.clearSourceEvents(u)}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(2),r=a(8),i=a(1),f=a(12),c=a(3);(function(){e.collides=function(d,l){for(var t=[],s=l.length,o=d.bounds,u=r.collides,g=i.overlaps,M=0;M<s;M++){var E=l[M],T=E.parts.length,h=T===1?0:1;if(g(E.bounds,o))for(var S=h;S<T;S++){var C=E.parts[S];if(g(C.bounds,o)){var x=u(C,d);if(x){t.push(x);break}}}}return t},e.ray=function(d,l,t,s){s=s||1e-100;for(var o=n.angle(l,t),u=n.magnitude(n.sub(l,t)),g=(t.x+l.x)*.5,M=(t.y+l.y)*.5,E=f.rectangle(g,M,u,s,{angle:o}),T=e.collides(E,d),h=0;h<T.length;h+=1){var S=T[h];S.body=S.bodyB=S.bodyA}return T},e.region=function(d,l,t){for(var s=[],o=0;o<d.length;o++){var u=d[o],g=i.overlaps(u.bounds,l);(g&&!t||!g&&t)&&s.push(u)}return s},e.point=function(d,l){for(var t=[],s=0;s<d.length;s++){var o=d[s];if(i.contains(o.bounds,l))for(var u=o.parts.length===1?0:1;u<o.parts.length;u++){var g=o.parts[u];if(i.contains(g.bounds,l)&&c.contains(g.vertices,l)){t.push(o);break}}}return t}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(4),r=a(0),i=a(6),f=a(1),c=a(5),d=a(2),l=a(14);(function(){var t,s;typeof window<"u"&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(h){window.setTimeout(function(){h(r.now())},1e3/60)},s=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),e._goodFps=30,e._goodDelta=1e3/60,e.create=function(h){var S={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!h.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},C=r.extend(S,h);return C.canvas&&(C.canvas.width=C.options.width||C.canvas.width,C.canvas.height=C.options.height||C.canvas.height),C.mouse=h.mouse,C.engine=h.engine,C.canvas=C.canvas||g(C.options.width,C.options.height),C.context=C.canvas.getContext("2d"),C.textures={},C.bounds=C.bounds||{min:{x:0,y:0},max:{x:C.canvas.width,y:C.canvas.height}},C.controller=e,C.options.showBroadphase=!1,C.options.pixelRatio!==1&&e.setPixelRatio(C,C.options.pixelRatio),r.isElement(C.element)&&C.element.appendChild(C.canvas),C},e.run=function(h){(function S(C){h.frameRequestId=t(S),o(h,C),e.world(h,C),(h.options.showStats||h.options.showDebug)&&e.stats(h,h.context,C),(h.options.showPerformance||h.options.showDebug)&&e.performance(h,h.context,C)})()},e.stop=function(h){s(h.frameRequestId)},e.setPixelRatio=function(h,S){var C=h.options,x=h.canvas;S==="auto"&&(S=M(x)),C.pixelRatio=S,x.setAttribute("data-pixel-ratio",S),x.width=C.width*S,x.height=C.height*S,x.style.width=C.width+"px",x.style.height=C.height+"px"},e.lookAt=function(h,S,C,x){x=typeof x<"u"?x:!0,S=r.isArray(S)?S:[S],C=C||{x:0,y:0};for(var I={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},P=0;P<S.length;P+=1){var L=S[P],A=L.bounds?L.bounds.min:L.min||L.position||L,F=L.bounds?L.bounds.max:L.max||L.position||L;A&&F&&(A.x<I.min.x&&(I.min.x=A.x),F.x>I.max.x&&(I.max.x=F.x),A.y<I.min.y&&(I.min.y=A.y),F.y>I.max.y&&(I.max.y=F.y))}var R=I.max.x-I.min.x+2*C.x,D=I.max.y-I.min.y+2*C.y,N=h.canvas.height,O=h.canvas.width,W=O/N,U=R/D,J=1,X=1;U>W?X=U/W:J=W/U,h.options.hasBounds=!0,h.bounds.min.x=I.min.x,h.bounds.max.x=I.min.x+R*J,h.bounds.min.y=I.min.y,h.bounds.max.y=I.min.y+D*X,x&&(h.bounds.min.x+=R*.5-R*J*.5,h.bounds.max.x+=R*.5-R*J*.5,h.bounds.min.y+=D*.5-D*X*.5,h.bounds.max.y+=D*.5-D*X*.5),h.bounds.min.x-=C.x,h.bounds.max.x-=C.x,h.bounds.min.y-=C.y,h.bounds.max.y-=C.y,h.mouse&&(l.setScale(h.mouse,{x:(h.bounds.max.x-h.bounds.min.x)/h.canvas.width,y:(h.bounds.max.y-h.bounds.min.y)/h.canvas.height}),l.setOffset(h.mouse,h.bounds.min))},e.startViewTransform=function(h){var S=h.bounds.max.x-h.bounds.min.x,C=h.bounds.max.y-h.bounds.min.y,x=S/h.options.width,I=C/h.options.height;h.context.setTransform(h.options.pixelRatio/x,0,0,h.options.pixelRatio/I,0,0),h.context.translate(-h.bounds.min.x,-h.bounds.min.y)},e.endViewTransform=function(h){h.context.setTransform(h.options.pixelRatio,0,0,h.options.pixelRatio,0,0)},e.world=function(h,S){var C=r.now(),x=h.engine,I=x.world,P=h.canvas,L=h.context,A=h.options,F=h.timing,R=i.allBodies(I),D=i.allConstraints(I),N=A.wireframes?A.wireframeBackground:A.background,O=[],W=[],U,J={timestamp:x.timing.timestamp};if(c.trigger(h,"beforeRender",J),h.currentBackground!==N&&T(h,N),L.globalCompositeOperation="source-in",L.fillStyle="transparent",L.fillRect(0,0,P.width,P.height),L.globalCompositeOperation="source-over",A.hasBounds){for(U=0;U<R.length;U++){var X=R[U];f.overlaps(X.bounds,h.bounds)&&O.push(X)}for(U=0;U<D.length;U++){var $=D[U],Y=$.bodyA,Z=$.bodyB,ee=$.pointA,K=$.pointB;Y&&(ee=d.add(Y.position,$.pointA)),Z&&(K=d.add(Z.position,$.pointB)),!(!ee||!K)&&(f.contains(h.bounds,ee)||f.contains(h.bounds,K))&&W.push($)}e.startViewTransform(h),h.mouse&&(l.setScale(h.mouse,{x:(h.bounds.max.x-h.bounds.min.x)/h.options.width,y:(h.bounds.max.y-h.bounds.min.y)/h.options.height}),l.setOffset(h.mouse,h.bounds.min))}else W=D,O=R,h.options.pixelRatio!==1&&h.context.setTransform(h.options.pixelRatio,0,0,h.options.pixelRatio,0,0);!A.wireframes||x.enableSleeping&&A.showSleeping?e.bodies(h,O,L):(A.showConvexHulls&&e.bodyConvexHulls(h,O,L),e.bodyWireframes(h,O,L)),A.showBounds&&e.bodyBounds(h,O,L),(A.showAxes||A.showAngleIndicator)&&e.bodyAxes(h,O,L),A.showPositions&&e.bodyPositions(h,O,L),A.showVelocity&&e.bodyVelocity(h,O,L),A.showIds&&e.bodyIds(h,O,L),A.showSeparations&&e.separations(h,x.pairs.list,L),A.showCollisions&&e.collisions(h,x.pairs.list,L),A.showVertexNumbers&&e.vertexNumbers(h,O,L),A.showMousePosition&&e.mousePosition(h,h.mouse,L),e.constraints(W,L),A.hasBounds&&e.endViewTransform(h),c.trigger(h,"afterRender",J),F.lastElapsed=r.now()-C},e.stats=function(h,S,C){for(var x=h.engine,I=x.world,P=i.allBodies(I),L=0,A=55,F=44,R=0,D=0,N=0;N<P.length;N+=1)L+=P[N].parts.length;var O={Part:L,Body:P.length,Cons:i.allConstraints(I).length,Comp:i.allComposites(I).length,Pair:x.pairs.list.length};S.fillStyle="#0e0f19",S.fillRect(R,D,A*5.5,F),S.font="12px Arial",S.textBaseline="top",S.textAlign="right";for(var W in O){var U=O[W];S.fillStyle="#aaa",S.fillText(W,R+A,D+8),S.fillStyle="#eee",S.fillText(U,R+A,D+26),R+=A}},e.performance=function(h,S){var C=h.engine,x=h.timing,I=x.deltaHistory,P=x.elapsedHistory,L=x.timestampElapsedHistory,A=x.engineDeltaHistory,F=x.engineElapsedHistory,R=C.timing.lastDelta,D=u(I),N=u(P),O=u(A),W=u(F),U=u(L),J=U/D||0,X=1e3/D||0,$=4,Y=12,Z=60,ee=34,K=10,ne=69;S.fillStyle="#0e0f19",S.fillRect(0,50,Y*4+Z*5+22,ee),e.status(S,K,ne,Z,$,I.length,Math.round(X)+" fps",X/e._goodFps,function(j){return I[j]/D-1}),e.status(S,K+Y+Z,ne,Z,$,A.length,R.toFixed(2)+" dt",e._goodDelta/R,function(j){return A[j]/O-1}),e.status(S,K+(Y+Z)*2,ne,Z,$,F.length,W.toFixed(2)+" ut",1-W/e._goodFps,function(j){return F[j]/W-1}),e.status(S,K+(Y+Z)*3,ne,Z,$,P.length,N.toFixed(2)+" rt",1-N/e._goodFps,function(j){return P[j]/N-1}),e.status(S,K+(Y+Z)*4,ne,Z,$,L.length,J.toFixed(2)+" x",J*J*J,function(j){return(L[j]/I[j]/J||0)-1})},e.status=function(h,S,C,x,I,P,L,A,F){h.strokeStyle="#888",h.fillStyle="#444",h.lineWidth=1,h.fillRect(S,C+7,x,1),h.beginPath(),h.moveTo(S,C+7-I*r.clamp(.4*F(0),-2,2));for(var R=0;R<x;R+=1)h.lineTo(S+R,C+7-(R<P?I*r.clamp(.4*F(R),-2,2):0));h.stroke(),h.fillStyle="hsl("+r.clamp(25+95*A,0,120)+",100%,60%)",h.fillRect(S,C-7,4,4),h.font="12px Arial",h.textBaseline="middle",h.textAlign="right",h.fillStyle="#eee",h.fillText(L,S+x,C-5)},e.constraints=function(h,S){for(var C=S,x=0;x<h.length;x++){var I=h[x];if(!(!I.render.visible||!I.pointA||!I.pointB)){var P=I.bodyA,L=I.bodyB,A,F;if(P?A=d.add(P.position,I.pointA):A=I.pointA,I.render.type==="pin")C.beginPath(),C.arc(A.x,A.y,3,0,2*Math.PI),C.closePath();else{if(L?F=d.add(L.position,I.pointB):F=I.pointB,C.beginPath(),C.moveTo(A.x,A.y),I.render.type==="spring")for(var R=d.sub(F,A),D=d.perp(d.normalise(R)),N=Math.ceil(r.clamp(I.length/5,12,20)),O,W=1;W<N;W+=1)O=W%2===0?1:-1,C.lineTo(A.x+R.x*(W/N)+D.x*O*4,A.y+R.y*(W/N)+D.y*O*4);C.lineTo(F.x,F.y)}I.render.lineWidth&&(C.lineWidth=I.render.lineWidth,C.strokeStyle=I.render.strokeStyle,C.stroke()),I.render.anchors&&(C.fillStyle=I.render.strokeStyle,C.beginPath(),C.arc(A.x,A.y,3,0,2*Math.PI),C.arc(F.x,F.y,3,0,2*Math.PI),C.closePath(),C.fill())}}},e.bodies=function(h,S,C){var x=C;h.engine;var I=h.options,P=I.showInternalEdges||!I.wireframes,L,A,F,R;for(F=0;F<S.length;F++)if(L=S[F],!!L.render.visible){for(R=L.parts.length>1?1:0;R<L.parts.length;R++)if(A=L.parts[R],!!A.render.visible){if(I.showSleeping&&L.isSleeping?x.globalAlpha=.5*A.render.opacity:A.render.opacity!==1&&(x.globalAlpha=A.render.opacity),A.render.sprite&&A.render.sprite.texture&&!I.wireframes){var D=A.render.sprite,N=E(h,D.texture);x.translate(A.position.x,A.position.y),x.rotate(A.angle),x.drawImage(N,N.width*-D.xOffset*D.xScale,N.height*-D.yOffset*D.yScale,N.width*D.xScale,N.height*D.yScale),x.rotate(-A.angle),x.translate(-A.position.x,-A.position.y)}else{if(A.circleRadius)x.beginPath(),x.arc(A.position.x,A.position.y,A.circleRadius,0,2*Math.PI);else{x.beginPath(),x.moveTo(A.vertices[0].x,A.vertices[0].y);for(var O=1;O<A.vertices.length;O++)!A.vertices[O-1].isInternal||P?x.lineTo(A.vertices[O].x,A.vertices[O].y):x.moveTo(A.vertices[O].x,A.vertices[O].y),A.vertices[O].isInternal&&!P&&x.moveTo(A.vertices[(O+1)%A.vertices.length].x,A.vertices[(O+1)%A.vertices.length].y);x.lineTo(A.vertices[0].x,A.vertices[0].y),x.closePath()}I.wireframes?(x.lineWidth=1,x.strokeStyle="#bbb",x.stroke()):(x.fillStyle=A.render.fillStyle,A.render.lineWidth&&(x.lineWidth=A.render.lineWidth,x.strokeStyle=A.render.strokeStyle,x.stroke()),x.fill())}x.globalAlpha=1}}},e.bodyWireframes=function(h,S,C){var x=C,I=h.options.showInternalEdges,P,L,A,F,R;for(x.beginPath(),A=0;A<S.length;A++)if(P=S[A],!!P.render.visible)for(R=P.parts.length>1?1:0;R<P.parts.length;R++){for(L=P.parts[R],x.moveTo(L.vertices[0].x,L.vertices[0].y),F=1;F<L.vertices.length;F++)!L.vertices[F-1].isInternal||I?x.lineTo(L.vertices[F].x,L.vertices[F].y):x.moveTo(L.vertices[F].x,L.vertices[F].y),L.vertices[F].isInternal&&!I&&x.moveTo(L.vertices[(F+1)%L.vertices.length].x,L.vertices[(F+1)%L.vertices.length].y);x.lineTo(L.vertices[0].x,L.vertices[0].y)}x.lineWidth=1,x.strokeStyle="#bbb",x.stroke()},e.bodyConvexHulls=function(h,S,C){var x=C,I,P,L;for(x.beginPath(),P=0;P<S.length;P++)if(I=S[P],!(!I.render.visible||I.parts.length===1)){for(x.moveTo(I.vertices[0].x,I.vertices[0].y),L=1;L<I.vertices.length;L++)x.lineTo(I.vertices[L].x,I.vertices[L].y);x.lineTo(I.vertices[0].x,I.vertices[0].y)}x.lineWidth=1,x.strokeStyle="rgba(255,255,255,0.2)",x.stroke()},e.vertexNumbers=function(h,S,C){var x=C,I,P,L;for(I=0;I<S.length;I++){var A=S[I].parts;for(L=A.length>1?1:0;L<A.length;L++){var F=A[L];for(P=0;P<F.vertices.length;P++)x.fillStyle="rgba(255,255,255,0.2)",x.fillText(I+"_"+P,F.position.x+(F.vertices[P].x-F.position.x)*.8,F.position.y+(F.vertices[P].y-F.position.y)*.8)}}},e.mousePosition=function(h,S,C){var x=C;x.fillStyle="rgba(255,255,255,0.8)",x.fillText(S.position.x+"  "+S.position.y,S.position.x+5,S.position.y-5)},e.bodyBounds=function(h,S,C){var x=C;h.engine;var I=h.options;x.beginPath();for(var P=0;P<S.length;P++){var L=S[P];if(L.render.visible)for(var A=S[P].parts,F=A.length>1?1:0;F<A.length;F++){var R=A[F];x.rect(R.bounds.min.x,R.bounds.min.y,R.bounds.max.x-R.bounds.min.x,R.bounds.max.y-R.bounds.min.y)}}I.wireframes?x.strokeStyle="rgba(255,255,255,0.08)":x.strokeStyle="rgba(0,0,0,0.1)",x.lineWidth=1,x.stroke()},e.bodyAxes=function(h,S,C){var x=C;h.engine;var I=h.options,P,L,A,F;for(x.beginPath(),L=0;L<S.length;L++){var R=S[L],D=R.parts;if(R.render.visible)if(I.showAxes)for(A=D.length>1?1:0;A<D.length;A++)for(P=D[A],F=0;F<P.axes.length;F++){var N=P.axes[F];x.moveTo(P.position.x,P.position.y),x.lineTo(P.position.x+N.x*20,P.position.y+N.y*20)}else for(A=D.length>1?1:0;A<D.length;A++)for(P=D[A],F=0;F<P.axes.length;F++)x.moveTo(P.position.x,P.position.y),x.lineTo((P.vertices[0].x+P.vertices[P.vertices.length-1].x)/2,(P.vertices[0].y+P.vertices[P.vertices.length-1].y)/2)}I.wireframes?(x.strokeStyle="indianred",x.lineWidth=1):(x.strokeStyle="rgba(255, 255, 255, 0.4)",x.globalCompositeOperation="overlay",x.lineWidth=2),x.stroke(),x.globalCompositeOperation="source-over"},e.bodyPositions=function(h,S,C){var x=C;h.engine;var I=h.options,P,L,A,F;for(x.beginPath(),A=0;A<S.length;A++)if(P=S[A],!!P.render.visible)for(F=0;F<P.parts.length;F++)L=P.parts[F],x.arc(L.position.x,L.position.y,3,0,2*Math.PI,!1),x.closePath();for(I.wireframes?x.fillStyle="indianred":x.fillStyle="rgba(0,0,0,0.5)",x.fill(),x.beginPath(),A=0;A<S.length;A++)P=S[A],P.render.visible&&(x.arc(P.positionPrev.x,P.positionPrev.y,2,0,2*Math.PI,!1),x.closePath());x.fillStyle="rgba(255,165,0,0.8)",x.fill()},e.bodyVelocity=function(h,S,C){var x=C;x.beginPath();for(var I=0;I<S.length;I++){var P=S[I];if(P.render.visible){var L=n.getVelocity(P);x.moveTo(P.position.x,P.position.y),x.lineTo(P.position.x+L.x,P.position.y+L.y)}}x.lineWidth=3,x.strokeStyle="cornflowerblue",x.stroke()},e.bodyIds=function(h,S,C){var x=C,I,P;for(I=0;I<S.length;I++)if(S[I].render.visible){var L=S[I].parts;for(P=L.length>1?1:0;P<L.length;P++){var A=L[P];x.font="12px Arial",x.fillStyle="rgba(255,255,255,0.5)",x.fillText(A.id,A.position.x+10,A.position.y-10)}}},e.collisions=function(h,S,C){var x=C,I=h.options,P,L,A,F;for(x.beginPath(),A=0;A<S.length;A++)if(P=S[A],!!P.isActive)for(L=P.collision,F=0;F<P.activeContacts.length;F++){var R=P.activeContacts[F],D=R.vertex;x.rect(D.x-1.5,D.y-1.5,3.5,3.5)}for(I.wireframes?x.fillStyle="rgba(255,255,255,0.7)":x.fillStyle="orange",x.fill(),x.beginPath(),A=0;A<S.length;A++)if(P=S[A],!!P.isActive&&(L=P.collision,P.activeContacts.length>0)){var N=P.activeContacts[0].vertex.x,O=P.activeContacts[0].vertex.y;P.activeContacts.length===2&&(N=(P.activeContacts[0].vertex.x+P.activeContacts[1].vertex.x)/2,O=(P.activeContacts[0].vertex.y+P.activeContacts[1].vertex.y)/2),L.bodyB===L.supports[0].body||L.bodyA.isStatic===!0?x.moveTo(N-L.normal.x*8,O-L.normal.y*8):x.moveTo(N+L.normal.x*8,O+L.normal.y*8),x.lineTo(N,O)}I.wireframes?x.strokeStyle="rgba(255,165,0,0.7)":x.strokeStyle="orange",x.lineWidth=1,x.stroke()},e.separations=function(h,S,C){var x=C,I=h.options,P,L,A,F,R;for(x.beginPath(),R=0;R<S.length;R++)if(P=S[R],!!P.isActive){L=P.collision,A=L.bodyA,F=L.bodyB;var D=1;!F.isStatic&&!A.isStatic&&(D=.5),F.isStatic&&(D=0),x.moveTo(F.position.x,F.position.y),x.lineTo(F.position.x-L.penetration.x*D,F.position.y-L.penetration.y*D),D=1,!F.isStatic&&!A.isStatic&&(D=.5),A.isStatic&&(D=0),x.moveTo(A.position.x,A.position.y),x.lineTo(A.position.x+L.penetration.x*D,A.position.y+L.penetration.y*D)}I.wireframes?x.strokeStyle="rgba(255,165,0,0.5)":x.strokeStyle="orange",x.stroke()},e.inspector=function(h,S){h.engine;var C=h.selected,x=h.render,I=x.options,P;if(I.hasBounds){var L=x.bounds.max.x-x.bounds.min.x,A=x.bounds.max.y-x.bounds.min.y,F=L/x.options.width,R=A/x.options.height;S.scale(1/F,1/R),S.translate(-x.bounds.min.x,-x.bounds.min.y)}for(var D=0;D<C.length;D++){var N=C[D].data;switch(S.translate(.5,.5),S.lineWidth=1,S.strokeStyle="rgba(255,165,0,0.9)",S.setLineDash([1,2]),N.type){case"body":P=N.bounds,S.beginPath(),S.rect(Math.floor(P.min.x-3),Math.floor(P.min.y-3),Math.floor(P.max.x-P.min.x+6),Math.floor(P.max.y-P.min.y+6)),S.closePath(),S.stroke();break;case"constraint":var O=N.pointA;N.bodyA&&(O=N.pointB),S.beginPath(),S.arc(O.x,O.y,10,0,2*Math.PI),S.closePath(),S.stroke();break}S.setLineDash([]),S.translate(-.5,-.5)}h.selectStart!==null&&(S.translate(.5,.5),S.lineWidth=1,S.strokeStyle="rgba(255,165,0,0.6)",S.fillStyle="rgba(255,165,0,0.1)",P=h.selectBounds,S.beginPath(),S.rect(Math.floor(P.min.x),Math.floor(P.min.y),Math.floor(P.max.x-P.min.x),Math.floor(P.max.y-P.min.y)),S.closePath(),S.stroke(),S.fill(),S.translate(-.5,-.5)),I.hasBounds&&S.setTransform(1,0,0,1,0,0)};var o=function(h,S){var C=h.engine,x=h.timing,I=x.historySize,P=C.timing.timestamp;x.delta=S-x.lastTime||e._goodDelta,x.lastTime=S,x.timestampElapsed=P-x.lastTimestamp||0,x.lastTimestamp=P,x.deltaHistory.unshift(x.delta),x.deltaHistory.length=Math.min(x.deltaHistory.length,I),x.engineDeltaHistory.unshift(C.timing.lastDelta),x.engineDeltaHistory.length=Math.min(x.engineDeltaHistory.length,I),x.timestampElapsedHistory.unshift(x.timestampElapsed),x.timestampElapsedHistory.length=Math.min(x.timestampElapsedHistory.length,I),x.engineElapsedHistory.unshift(C.timing.lastElapsed),x.engineElapsedHistory.length=Math.min(x.engineElapsedHistory.length,I),x.elapsedHistory.unshift(x.lastElapsed),x.elapsedHistory.length=Math.min(x.elapsedHistory.length,I)},u=function(h){for(var S=0,C=0;C<h.length;C+=1)S+=h[C];return S/h.length||0},g=function(h,S){var C=document.createElement("canvas");return C.width=h,C.height=S,C.oncontextmenu=function(){return!1},C.onselectstart=function(){return!1},C},M=function(h){var S=h.getContext("2d"),C=window.devicePixelRatio||1,x=S.webkitBackingStorePixelRatio||S.mozBackingStorePixelRatio||S.msBackingStorePixelRatio||S.oBackingStorePixelRatio||S.backingStorePixelRatio||1;return C/x},E=function(h,S){var C=h.textures[S];return C||(C=h.textures[S]=new Image,C.src=S,C)},T=function(h,S){var C=S;/(jpg|gif|png)$/.test(S)&&(C="url("+S+")"),h.canvas.style.background=C,h.canvas.style.backgroundSize="contain",h.currentBackground=S}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(5),r=a(17),i=a(0);(function(){var f,c;if(typeof window<"u"&&(f=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,c=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),!f){var d;f=function(l){d=setTimeout(function(){l(i.now())},1e3/60)},c=function(){clearTimeout(d)}}e.create=function(l){var t={fps:60,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,frameRequestId:null,isFixed:!1,enabled:!0},s=i.extend(t,l);return s.delta=s.delta||1e3/s.fps,s.deltaMin=s.deltaMin||1e3/s.fps,s.deltaMax=s.deltaMax||1e3/(s.fps*.5),s.fps=1e3/s.delta,s},e.run=function(l,t){return typeof l.positionIterations<"u"&&(t=l,l=e.create()),(function s(o){l.frameRequestId=f(s),o&&l.enabled&&e.tick(l,t,o)})(),l},e.tick=function(l,t,s){var o=t.timing,u;l.isFixed?u=l.delta:(u=s-l.timePrev||l.delta,l.timePrev=s,l.deltaHistory.push(u),l.deltaHistory=l.deltaHistory.slice(-l.deltaSampleSize),u=Math.min.apply(null,l.deltaHistory),u=u<l.deltaMin?l.deltaMin:u,u=u>l.deltaMax?l.deltaMax:u,l.delta=u);var g={timestamp:o.timestamp};n.trigger(l,"beforeTick",g),l.frameCounter+=1,s-l.counterTimestamp>=1e3&&(l.fps=l.frameCounter*((s-l.counterTimestamp)/1e3),l.counterTimestamp=s,l.frameCounter=0),n.trigger(l,"tick",g),n.trigger(l,"beforeUpdate",g),r.update(t,u),n.trigger(l,"afterUpdate",g),n.trigger(l,"afterTick",g)},e.stop=function(l){c(l.frameRequestId)},e.start=function(l,t){e.run(l,t)}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(8),r=a(0),i=r.deprecated;(function(){e.collides=function(f,c){return n.collides(f,c)},i(e,"collides","SAT.collides âž¤ replaced by Collision.collides")})()}),(function(m,w,a){var e={};m.exports=e,a(1);var n=a(0);(function(){e.pathToVertices=function(r,i){typeof window<"u"&&!("SVGPathSeg"in window)&&n.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var f,c,d,l,t,s,o,u,g,M,E=[],T,h,S=0,C=0,x=0;i=i||15;var I=function(L,A,F){var R=F%2===1&&F>1;if(!g||L!=g.x||A!=g.y){g&&R?(T=g.x,h=g.y):(T=0,h=0);var D={x:T+L,y:h+A};(R||!g)&&(g=D),E.push(D),C=T+L,x=h+A}},P=function(L){var A=L.pathSegTypeAsLetter.toUpperCase();if(A!=="Z"){switch(A){case"M":case"L":case"T":case"C":case"S":case"Q":C=L.x,x=L.y;break;case"H":C=L.x;break;case"V":x=L.y;break}I(C,x,L.pathSegType)}};for(e._svgPathToAbsolute(r),d=r.getTotalLength(),s=[],f=0;f<r.pathSegList.numberOfItems;f+=1)s.push(r.pathSegList.getItem(f));for(o=s.concat();S<d;){if(M=r.getPathSegAtLength(S),t=s[M],t!=u){for(;o.length&&o[0]!=t;)P(o.shift());u=t}switch(t.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":l=r.getPointAtLength(S),I(l.x,l.y,0);break}S+=i}for(f=0,c=o.length;f<c;++f)P(o[f]);return E},e._svgPathToAbsolute=function(r){for(var i,f,c,d,l,t,s=r.pathSegList,o=0,u=0,g=s.numberOfItems,M=0;M<g;++M){var E=s.getItem(M),T=E.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(T))"x"in E&&(o=E.x),"y"in E&&(u=E.y);else switch("x1"in E&&(c=o+E.x1),"x2"in E&&(l=o+E.x2),"y1"in E&&(d=u+E.y1),"y2"in E&&(t=u+E.y2),"x"in E&&(o+=E.x),"y"in E&&(u+=E.y),T){case"m":s.replaceItem(r.createSVGPathSegMovetoAbs(o,u),M);break;case"l":s.replaceItem(r.createSVGPathSegLinetoAbs(o,u),M);break;case"h":s.replaceItem(r.createSVGPathSegLinetoHorizontalAbs(o),M);break;case"v":s.replaceItem(r.createSVGPathSegLinetoVerticalAbs(u),M);break;case"c":s.replaceItem(r.createSVGPathSegCurvetoCubicAbs(o,u,c,d,l,t),M);break;case"s":s.replaceItem(r.createSVGPathSegCurvetoCubicSmoothAbs(o,u,l,t),M);break;case"q":s.replaceItem(r.createSVGPathSegCurvetoQuadraticAbs(o,u,c,d),M);break;case"t":s.replaceItem(r.createSVGPathSegCurvetoQuadraticSmoothAbs(o,u),M);break;case"a":s.replaceItem(r.createSVGPathSegArcAbs(o,u,E.r1,E.r2,E.angle,E.largeArcFlag,E.sweepFlag),M);break;case"z":case"Z":o=i,u=f;break}(T=="M"||T=="m")&&(i=o,f=u)}}})()}),(function(m,w,a){var e={};m.exports=e;var n=a(6);a(0),(function(){e.create=n.create,e.add=n.add,e.remove=n.remove,e.clear=n.clear,e.addComposite=n.addComposite,e.addBody=n.addBody,e.addConstraint=n.addConstraint})()})])})})(ue)),ue.exports}var ke=Fe();const H=Le(ke),b={engine:null,render:null,world:null,runner:null,isInitialized:!1,isRunning:!1,currentMode:"sand",currentSegments:k.SAND_COLORS.length,init:function(p,v,m,w={}){const a=w.mode||b.currentMode||"sand",e=Math.max(1,w.segments||(a==="sand"?k.SAND_COLORS.length:1));if(b.isInitialized){const r=b.render&&(b.render.options.width!==v||b.render.options.height!==m),i=b.currentMode!==a||b.currentSegments!==e;r&&b.render&&(console.log(`Resizing physics renderer to ${v}x${m}`),b.render.bounds.max.x=v,b.render.bounds.max.y=m,b.render.options.width=v,b.render.options.height=m,b.render.canvas.width=v,b.render.canvas.height=m),(r||i)&&(b.currentMode=a,b.currentSegments=e,b.updateWallPositions(v,m)),b.start();return}if(console.log(`Initializing Physics Engine (${a}): ${v}x${m}`),!p||isNaN(v)||isNaN(m)||v<=0||m<=0){console.error("Cannot initialize Physics: Invalid canvas or dimensions.");return}const n={enableSleeping:!0,positionIterations:8,velocityIterations:6};b.engine=H.Engine.create(n),b.world=b.engine.world,b.engine.world.gravity.y=.7,b.render=H.Render.create({element:p.parentNode,canvas:p,engine:b.engine,options:{width:v,height:m,wireframes:!1,background:"transparent",showSleeping:!1,pixelRatio:window.devicePixelRatio||1}}),b.currentMode=a,b.currentSegments=e,b.createWalls(v,m,a,e),b.runner=H.Runner.create(),H.Runner.run(b.runner,b.engine),H.Render.run(b.render),b.isInitialized=!0,b.isRunning=!0,console.log("Physics engine initialized and running.")},createWalls:function(p,v,m=b.currentMode,w=b.currentSegments){if(!b.world)return;const a=H.Composite.allBodies(b.world).filter(i=>i.isStatic);a.length>0&&H.World.remove(b.world,a);const e=15,n={isStatic:!0,friction:.6,restitution:.1,render:{visible:!1}},r=[];if(r.push(H.Bodies.rectangle(p/2,v+e/2,p+e*2,e,n)),r.push(H.Bodies.rectangle(-e/2,v/2,e,v+e*2,n)),r.push(H.Bodies.rectangle(p+e/2,v/2,e,v+e*2,n)),m==="sand"){const i=Math.max(1,w),f=p/i;for(let c=1;c<i;c++){const d=c*f;r.push(H.Bodies.rectangle(d,v/2,e,v+e*2,n))}}H.World.add(b.world,r)},updateWallPositions:function(p,v){b.createWalls(p,v,b.currentMode,b.currentSegments)},addParticle:function(p,v){if(!b.isInitialized||!b.engine||!b.world||!b.render?.options?.width||b.currentMode!=="sand")return!1;const m=Math.max(1,b.currentSegments||k.SAND_COLORS.length);if(p<0||p>=m)return!1;const w=b.render.options.width/m,a=y.preferences?.sandParticleSize||5,e=15,n=a*.5,r=p*w,i=r+e/2+a+n,f=r+w-e/2-a-n;if(i>=f)return!1;const c=i+Math.random()*(f-i),d=-a*2,l=H.Bodies.polygon(c,d,6,a,{restitution:.15,friction:.7,frictionAir:.01,density:.01,render:{fillStyle:v},sleepThreshold:60});return H.Body.setVelocity(l,{x:(Math.random()-.5)*.1,y:Math.random()*.1}),H.Body.setAngularVelocity(l,(Math.random()-.5)*.01),H.World.add(b.world,l),!0},addWaterParticle:function(p="#4aa8ff"){if(!b.isInitialized||!b.engine||!b.world||!b.render?.options?.width||b.currentMode!=="water")return!1;const v=b.render.options.width,m=Math.max(2,(y.preferences?.sandParticleSize||5)*.8),w=15,a=m*.25,e=w/2+m+a,n=v-w/2-m-a;if(e>=n)return!1;const r=e+Math.random()*(n-e),i=-m*2,f=H.Bodies.circle(r,i,m,{restitution:.03,friction:.01,frictionStatic:.02,frictionAir:.01,density:8e-4,render:{fillStyle:p},sleepThreshold:120});return H.Body.setVelocity(f,{x:(Math.random()-.5)*.08,y:Math.random()*.06}),H.World.add(b.world,f),!0},getSegmentTopYs:function(){if(!b.world||!b.render?.options?.width)return null;const p=Math.max(1,b.currentSegments||k.SAND_COLORS.length),v=b.render.options.width/p,m=Array(p).fill(1/0);return H.Composite.allBodies(b.world).filter(a=>!a.isStatic).forEach(a=>{const e=a.position?.x;if(typeof e!="number"||Number.isNaN(e))return;const n=Math.max(0,Math.min(p-1,Math.floor(e/v))),r=a.bounds?.min?.y;typeof r=="number"&&!Number.isNaN(r)&&r<m[n]&&(m[n]=r)}),m},getTopY:function(){if(!b.world)return null;const p=H.Composite.allBodies(b.world).filter(m=>!m.isStatic);if(p.length===0)return 1/0;let v=1/0;return p.forEach(m=>{const w=m.bounds?.min?.y;typeof w=="number"&&!Number.isNaN(w)&&w<v&&(v=w)}),v},clearDynamicBodies:function(){if(!b.world)return;const v=H.Composite.allBodies(b.world).filter(m=>!m.isStatic);v.length>0&&H.World.remove(b.world,v)},stop:function(){b.isRunning&&(b.runner&&H.Runner.stop(b.runner),b.render&&H.Render.stop(b.render),b.isRunning=!1)},start:function(){b.isRunning||!b.isInitialized||(b.render&&H.Render.run(b.render),b.runner&&b.engine?(H.Runner.run(b.runner,b.engine),b.isRunning=!0):console.error("Cannot start physics, not initialized."))},destroy:function(){console.log("Destroying physics engine..."),b.stop(),b.world&&H.World.clear(b.world,!1),b.engine&&H.Engine.clear(b.engine),b.engine=null,b.world=null,b.render=null,b.runner=null,b.isInitialized=!1,b.isRunning=!1,b.currentMode="sand",b.currentSegments=k.SAND_COLORS.length,console.log("Physics engine destroyed.")}},De="#4aa8ff",z={update:function(p){y.preferences.showScheduleCircles?z.renderScheduleCircles():B.scheduleCirclesDisplayEl&&(B.scheduleCirclesDisplayEl.innerHTML="")},renderScheduleCircles:function(){if(!y.preferences.showScheduleCircles||!B.scheduleCirclesDisplayEl){B.scheduleCirclesDisplayEl&&(B.scheduleCirclesDisplayEl.innerHTML="");return}const p=se(),v=V.getCurrentPeriodInfo(p),m=y.getActiveColourScheme(),w=(y.schedule||[]).map((n,r)=>({...n,originalIndex:r})).filter(n=>n.showCircles);if(w.length===0){B.scheduleCirclesDisplayEl.innerHTML="";return}let a=-1;v&&(a=w.findIndex(n=>n.originalIndex===v.index));let e="";for(let n=0;n<w.length;n++){const r=a>=n,i=r?"â—":"â—‹",f=`schedule-circle-symbol ${r?"active":"inactive"}`,c=r?m.text:"#555";e+=`<span class="${f}" style="color: ${c};">${i}</span>`}B.scheduleCirclesDisplayEl.innerHTML=e},setupPhysicsSandBars:function(p){if(z.stopPhysicsCheckInterval(),b.clearDynamicBodies(),k.physicsParticlesAdded=0,k.totalParticlesForPeriod=0,!y.preferences.showSandBars||!B.sandBarsCanvas||!B.sandBarsContainerEl){b.stop();return}const v=y.preferences?.sandHeight||150,m=y.preferences?.sandWidth||80;B.sandBarsContainerEl.style.height=`${v}px`,B.sandBarsContainerEl.style.width=`${m}%`,requestAnimationFrame(()=>{const w=B.sandBarsContainerEl.offsetWidth,a=B.sandBarsContainerEl.offsetHeight;if(w<=0||a<=0){console.warn("Sand bars container has zero dimensions after rAF. Aborting physics setup."),b.stop();return}const e=y.preferences?.sandParticleSize||5,n=3*Math.sqrt(3)/2*e*e,r=w/k.SAND_COLORS.length,f=Math.max(0,r-15-e*.25),c=Math.max(0,a-e*.2),d=f*c,l=.94;k.visualMaxParticlesPerSegment=Math.max(10,Math.floor(d*l/n)),k.totalParticlesForPeriod=k.visualMaxParticlesPerSegment*k.SAND_COLORS.length,console.log(`Est. Max Particles Per Segment (Hex): ${k.visualMaxParticlesPerSegment}, Total Target: ${k.totalParticlesForPeriod}, Particle Area: ${n.toFixed(2)}`),b.init(B.sandBarsCanvas,w,a,{mode:"sand",segments:k.SAND_COLORS.length}),b.start(),z.handleColorSchemeChange();const t=p||V.getCurrentPeriodInfo(se());t?t.end.getTime()-t.start.getTime()>0?(z.checkAndAddParticles(),k.physicsCheckIntervalId=setInterval(z.checkAndAddParticles,k.physicsCheckIntervalMs)):(console.log("Period duration is zero or negative, stopping sand physics."),b.stop()):(console.log("No current period found, stopping sand physics."),b.stop())})},setupPhysicsWaterFill:function(p){if(z.stopPhysicsCheckInterval(),b.clearDynamicBodies(),k.physicsParticlesAdded=0,k.totalParticlesForPeriod=0,!y.preferences.showWaterFill||!B.waterFillCanvas||!B.waterFillContainerEl){b.stop();return}const v=y.preferences?.sandHeight||150,m=y.preferences?.sandWidth||80;B.waterFillContainerEl.style.height=`${v}px`,B.waterFillContainerEl.style.width=`${m}%`,requestAnimationFrame(()=>{const w=B.waterFillContainerEl.offsetWidth,a=B.waterFillContainerEl.offsetHeight;if(w<=0||a<=0){console.warn("Water fill container has zero dimensions after rAF. Aborting physics setup."),b.stop();return}const e=Math.max(2,(y.preferences?.sandParticleSize||5)*.8),n=Math.PI*e*e,i=Math.max(0,w-15-e*.1),f=Math.max(0,a-e*.05),c=.74;k.totalParticlesForPeriod=Math.max(20,Math.floor(i*f*c/n)),k.visualMaxParticlesPerSegment=k.totalParticlesForPeriod,console.log(`Est. Max Water Particles: ${k.totalParticlesForPeriod}, Particle Area: ${n.toFixed(2)}`),b.init(B.waterFillCanvas,w,a,{mode:"water",segments:1}),b.start(),z.handleColorSchemeChange();const d=p||V.getCurrentPeriodInfo(se());d?d.end.getTime()-d.start.getTime()>0?(z.checkAndAddWaterParticles(),k.physicsCheckIntervalId=setInterval(z.checkAndAddWaterParticles,k.physicsCheckIntervalMs)):(console.log("Period duration is zero or negative, stopping water physics."),b.stop()):(console.log("No current period found, stopping water physics."),b.stop())})},isSandBarsNearTop:function(){if(!b.isInitialized||!b.isRunning)return!1;const p=b.getSegmentTopYs();if(!p||p.length!==k.SAND_COLORS.length)return!1;const v=y.preferences?.sandParticleSize||5,m=Math.max(2,v*1.2);return p.every(w=>Number.isFinite(w)&&w<=m)},isWaterNearTop:function(){if(!b.isInitialized||!b.isRunning)return!1;const p=b.getTopY();if(!Number.isFinite(p))return!1;const v=Math.max(2,(y.preferences?.sandParticleSize||5)*.8),m=Math.max(1,v*.2);return p<=m},checkAndAddParticles:function(){if(!y.preferences.showSandBars||!b.isRunning||k.totalParticlesForPeriod<=0){z.stopPhysicsCheckInterval();return}const p=se(),v=V.getCurrentPeriodInfo(p);if(!v){z.stopPhysicsCheckInterval();return}const m=v.start.getTime(),a=v.end.getTime()-m;if(a<=0){z.stopPhysicsCheckInterval();return}if(z.isSandBarsNearTop()){z.stopPhysicsCheckInterval();return}const n=Math.max(0,p.getTime()-m),r=Math.min(1,n/a),i=Math.floor(r*k.totalParticlesForPeriod),f=Math.ceil(k.totalParticlesForPeriod*1.35);let c=i;r>=.9&&c<=k.physicsParticlesAdded&&(c=Math.min(f,k.physicsParticlesAdded+6)),c=Math.min(c,f);const d=c-k.physicsParticlesAdded;if(d<=0)return;const l=6;for(let t=0;t<Math.min(d,l)&&!(k.physicsParticlesAdded>=f);++t){const s=a/k.SAND_COLORS.length,o=k.physicsParticlesAdded;let u;if(o<k.totalParticlesForPeriod){const g=(o+.5)/k.totalParticlesForPeriod*a;u=Math.min(k.SAND_COLORS.length-1,Math.floor(g/s))}else u=o%k.SAND_COLORS.length;if(u>=0)if(b.addParticle(u,k.SAND_COLORS[u]))k.physicsParticlesAdded++;else break}k.physicsParticlesAdded>=f&&z.stopPhysicsCheckInterval()},checkAndAddWaterParticles:function(){if(!y.preferences.showWaterFill||!b.isRunning||k.totalParticlesForPeriod<=0){z.stopPhysicsCheckInterval();return}const p=se(),v=V.getCurrentPeriodInfo(p);if(!v){z.stopPhysicsCheckInterval();return}const m=v.start.getTime(),a=v.end.getTime()-m;if(a<=0){z.stopPhysicsCheckInterval();return}if(z.isWaterNearTop()){z.stopPhysicsCheckInterval();return}const n=Math.max(0,p.getTime()-m),r=Math.min(1,n/a),i=Math.floor(r*k.totalParticlesForPeriod),f=Math.ceil(k.totalParticlesForPeriod*1.5);let c=i;r>=.9&&c<=k.physicsParticlesAdded&&(c=Math.min(f,k.physicsParticlesAdded+6)),c=Math.min(c,f);const d=c-k.physicsParticlesAdded;if(d<=0)return;const l=8;for(let t=0;t<Math.min(d,l)&&!(k.physicsParticlesAdded>=f);++t)if(b.addWaterParticle(De))k.physicsParticlesAdded++;else break;k.physicsParticlesAdded>=f&&z.stopPhysicsCheckInterval()},stopPhysicsCheckInterval:function(){k.physicsCheckIntervalId&&(clearInterval(k.physicsCheckIntervalId),k.physicsCheckIntervalId=null)},handlePeriodChange:function(p){if(y.preferences.showSandBars){z.setupPhysicsSandBars(p);return}if(y.preferences.showWaterFill){z.setupPhysicsWaterFill(p);return}z.stopPhysicsCheckInterval(),b.clearDynamicBodies(),b.stop()},handleDisplayToggle:function(){const p=V.getCurrentPeriodInfo(se());if(y.preferences.showSandBars){z.setupPhysicsSandBars(p);return}if(y.preferences.showWaterFill){z.setupPhysicsWaterFill(p);return}z.stopPhysicsCheckInterval(),b.clearDynamicBodies(),b.stop()},handleColorSchemeChange:function(){const p=y.getActiveColourScheme().text||"#FFFFFF";document.querySelectorAll(".sand-bar-outline-segment, .water-fill-outline-segment").forEach(v=>{v.style.borderColor=p}),y.preferences.showScheduleCircles&&z.renderScheduleCircles()}},ie={update:function(){const p=y.preferences;if(!B.clockDisplayArea){console.warn("DOM cache not ready in Layout.update");return}[{el:B.dateEl,pref:"showDate"},{el:B.scheduleCirclesDisplayEl,pref:"showScheduleCircles"},{el:B.timeEl,pref:"showTime"}].forEach(n=>{n.el?.classList.toggle("element-hidden",!p[n.pref])});const m=p.showScheduleLabel||p.showProgressBar||p.showSandBars||p.showWaterFill;B.periodContainerEl?.classList.toggle("element-hidden",!m),m?B.periodLabelEl?.classList.toggle("element-hidden",!p.showScheduleLabel):B.periodLabelEl?.classList.add("element-hidden");const w=p.showProgressBar&&!p.showSandBars&&!p.showWaterFill,a=p.showSandBars,e=p.showWaterFill;B.progressBarEl?.classList.toggle("element-hidden",!w),B.sandBarsContainerEl?.classList.toggle("element-hidden",!a),B.waterFillContainerEl?.classList.toggle("element-hidden",!e),B.sandBarsCanvas&&(B.sandBarsCanvas.style.display=a?"block":"none"),B.waterFillCanvas&&(B.waterFillCanvas.style.display=e?"block":"none"),ie.applyFontAndSizePreferences()},applyFontAndSizePreferences:function(){const p=y.preferences;y.getActiveColourScheme(),B.clockDisplayArea&&(p.showDate&&B.dateEl&&(B.dateEl.style.fontSize=p.dateFontSize+"px"),p.showTime&&B.timeEl&&(B.timeEl.style.fontSize=p.timeFontSize+"px"),p.showScheduleLabel&&B.periodLabelEl&&(B.periodLabelEl.style.fontSize=p.scheduleLabelFontSize+"px"),p.showProgressBar&&!p.showSandBars&&!p.showWaterFill&&(B.timeLeftEl&&(B.timeLeftEl.style.fontSize=p.timeLeftFontSize+"px"),B.progressBarEl&&(B.progressBarEl.style.height=p.progressBarHeight+"px")),document.body.style.fontFamily=p.fontFamily,p.showScheduleCircles&&B.scheduleCirclesDisplayEl&&z.renderScheduleCircles())}},G={attachListeners:function(){B.addScheduleRowBtn?.addEventListener("click",G.addRow),B.deleteScheduleRowBtn?.addEventListener("click",G.deleteRow)},renderTable:function(){const p=B.scheduleTableBody;if(!p){console.error("Schedule table body not found");return}p.innerHTML="",(y.schedule||[]).forEach((m,w)=>{const a=document.createElement("tr");a.dataset.index=w,a.setAttribute("draggable","true"),w===k.selectedScheduleRowIndex&&a.classList.add("selected"),a.appendChild(G.createDragCell()),a.appendChild(G.createLabelCell(m,w)),a.appendChild(G.createTimeCell(m,w,"start")),a.appendChild(G.createTimeCell(m,w,"end")),a.appendChild(G.createSchemeCell(m,w)),a.appendChild(G.createAlertCell(m,w)),a.appendChild(G.createCirclesCell(m,w)),a.addEventListener("click",G.handleRowClick),a.addEventListener("dragstart",G.handleDragStart),a.addEventListener("dragover",G.handleDragOver),a.addEventListener("dragleave",G.handleDragLeave),a.addEventListener("drop",G.handleDrop),a.addEventListener("dragend",G.handleDragEnd),p.appendChild(a)}),p.removeEventListener("dragleave",G.handleTableDragLeave),p.addEventListener("dragleave",G.handleTableDragLeave)},createDragCell:function(){const p=document.createElement("td");return p.innerHTML="â˜°",p.className="drag-handle",p.title="Drag to reorder",p},createLabelCell:function(p,v){const m=document.createElement("td"),w=document.createElement("input");return w.type="text",w.value=p.label||"",w.placeholder="Period Label",w.addEventListener("change",function(){y.schedule&&y.schedule[v]&&(y.schedule[v].label=this.value,y.save(),V.update())}),m.appendChild(w),m},createTimeCell:function(p,v,m){const w=document.createElement("td"),a=document.createElement("input");return a.type="time",a.value=p[m]||"00:00",a.addEventListener("change",function(){y.schedule&&y.schedule[v]&&(y.schedule[v][m]=this.value,y.save(),V.update())}),w.appendChild(a),w},createSchemeCell:function(p,v){const m=document.createElement("td"),w=document.createElement("div");w.className="scheme-swatch";const a=y.preferences?.colourSchemes||[],e=a.find(n=>n.id===p.colourSchemeId)||a.find(n=>n.id===1)||a[0];return w.style.backgroundColor=e?e.background:"#ff00ff",w.style.borderColor=e?e.text:"#ffffff",w.title=`Scheme: ${e?e.name:"Unknown"} (ID: ${p.colourSchemeId}). Click to cycle.`,w.addEventListener("click",n=>{n.stopPropagation(),G.cycleSchemeForRow(v)}),m.appendChild(w),m},createAlertCell:function(p,v){const m=document.createElement("td"),w=document.createElement("button"),a=y.alerts[v]?.colour?.enabled||!1;return w.innerHTML=a?"ðŸ”´":"ðŸŸ¢",w.title=`Visual Alert: ${a?"Enabled":"Disabled"}. Click to edit.`,w.className="alert-edit-btn",w.addEventListener("click",e=>{e.stopPropagation(),Q.openModal(v)}),m.appendChild(w),m.style.textAlign="center",m},createCirclesCell:function(p,v){const m=document.createElement("td"),w=document.createElement("input");return w.type="checkbox",w.checked=p.showCircles||!1,w.title="Show this period in the Schedule Circles display",w.addEventListener("change",function(a){a.stopPropagation(),y.schedule&&y.schedule[v]&&(y.schedule[v].showCircles=this.checked,y.save(),z.renderScheduleCircles())}),m.appendChild(w),m.style.textAlign="center",m},handleRowClick:function(p){const v=parseInt(this.dataset.index,10);if(p.target.tagName==="INPUT"||p.target.tagName==="BUTTON"||p.target.classList.contains("scheme-swatch")||p.target.classList.contains("drag-handle")){if(this.classList.contains("selected")){k.selectedScheduleRowIndex=v;return}}else{const m=B.scheduleTableBody?.querySelector("tr.selected");m&&m.classList.remove("selected"),this.classList.add("selected"),k.selectedScheduleRowIndex=v}},cycleSchemeForRow:function(p){if(!y.schedule||p<0||p>=y.schedule.length)return;const v=y.schedule[p].colourSchemeId||1,m=y.preferences?.colourSchemes||[];if(m.length===0)return;let a=(m.findIndex(e=>e.id===v)+1)%m.length;y.schedule[p].colourSchemeId=m[a]?.id||m[0]?.id||1,y.save(),G.renderTable(),V.update()},addRow:function(){const p={label:"New Period",start:"00:00",end:"00:00",colourSchemeId:1,showCircles:!1},v=k.selectedScheduleRowIndex===null||k.selectedScheduleRowIndex<0||k.selectedScheduleRowIndex>=y.schedule.length?y.schedule.length:k.selectedScheduleRowIndex+1;y.schedule.splice(v,0,p);const m={};Object.keys(y.alerts).forEach(w=>{const a=parseInt(w,10);m[a>=v?a+1:a]=y.alerts[w]}),y.alerts=m,k.selectedScheduleRowIndex=v,G.renderTable(),y.save()},deleteRow:function(){const p=k.selectedScheduleRowIndex;if(p!==null&&p>=0&&p<y.schedule.length){if(confirm(`Delete row "${y.schedule[p].label}"?`)){y.schedule.splice(p,1),delete y.alerts[p];const v={};Object.keys(y.alerts).forEach(m=>{const w=parseInt(m,10);v[w>p?w-1:w]=y.alerts[m]}),y.alerts=v,k.selectedScheduleRowIndex=null,G.renderTable(),y.save(),V.update()}}else q.showButtonFeedback(B.deleteScheduleRowBtn,"Select Row First!",2e3)},handleDragStart:function(p){if(k.dragStartIndex=parseInt(this.dataset.index,10),!isNaN(k.dragStartIndex)&&(p.dataTransfer.effectAllowed="move",p.dataTransfer.setData("text/plain",k.dragStartIndex),this.classList.add("dragging"),!this.classList.contains("selected"))){const v=B.scheduleTableBody?.querySelector("tr.selected");v&&v.classList.remove("selected"),this.classList.add("selected"),k.selectedScheduleRowIndex=k.dragStartIndex}},handleDragOver:function(p){p.preventDefault(),p.dataTransfer.dropEffect="move",this.classList.add("drag-over")},handleDragLeave:function(p){this.classList.remove("drag-over")},handleDrop:function(p){p.preventDefault(),this.classList.remove("drag-over");const v=parseInt(this.dataset.index,10),m=k.dragStartIndex;if(m!==null&&!isNaN(v)&&m!==v){const w=y.schedule.splice(m,1)[0];y.schedule.splice(v,0,w);const a=y.alerts[m],e={};Object.keys(y.alerts).forEach(n=>{const r=parseInt(n,10);if(r===m)return;let i=r;m<r&&v>=r?i--:m>r&&v<=r&&i++,e[i]=y.alerts[n]}),a&&(e[v]=a),y.alerts=e,k.selectedScheduleRowIndex=v,G.renderTable(),y.save(),V.update()}k.dragStartIndex=null},handleDragEnd:function(p){this.classList.remove("dragging"),document.querySelectorAll("#schedule-table tbody tr.drag-over").forEach(v=>{v.classList.remove("drag-over")}),k.dragStartIndex=null},handleTableDragLeave:function(p){B.scheduleTableBody&&!B.scheduleTableBody.contains(p.relatedTarget)&&document.querySelectorAll("#schedule-table tbody tr.drag-over").forEach(v=>{v.classList.remove("drag-over")})}},Q={attachListeners:function(){B.alertModal?.addEventListener("click",p=>{(p.target===B.alertModal||B.closeModalBtn&&p.target===B.closeModalBtn)&&Q.closeModal()})},openModal:function(p){if(p===null||p<0||!y.schedule||p>=y.schedule.length)return;const v=y.schedule[p]?.label||`Row ${p+1}`;B.alertModalTitle&&(B.alertModalTitle.textContent=`Visual Alert Settings for "${v}"`),Q.renderModalForm(p),B.alertModal&&(B.alertModal.style.display="block")},closeModal:function(){B.alertModal&&(B.alertModal.style.display="none"),B.alertModalBody&&(B.alertModalBody.innerHTML="")},renderModalForm:function(p){if(!B.alertModalBody||!y.schedule||p>=y.schedule.length)return;const v=y.defaultPreferences?.defaultAlertSettings?.colour||{},m=y.alerts[p]?.colour||{},w={...v,...m},a=w.durationMs||v.durationMs||1500,e=w.intervalMs||v.intervalMs||500,n=a/1e3,r=!!y.alerts[p]?.colour;B.alertModalBody.innerHTML=`
            <div class="alert-settings-form" data-index="${p}">
            <label><input type="checkbox" id="alert-colour-enabled" ${w.enabled?"checked":""}> Enable Visual Alert</label><hr>
            <label>Flash Background Colour: <input type="color" id="alert-bg-color" value="${w.background}"></label>
            <label>Flash Text Colour: <input type="color" id="alert-label-color" value="${w.text}"></label>
            <label>Flash Duration (s): <input type="number" id="alert-flash-duration-sec" min="0.5" max="10" step="0.1" value="${n.toFixed(1)}"></label>
            <label>Flash Interval (ms): <input type="number" id="alert-flash-interval" min="100" max="2000" step="50" value="${e}"></label>
            <div class="button-group">
                <button id="save-alert" data-option="colour">Save Visual Alert</button>
                <button id="preview-alert" data-option="colour">Preview Flash</button>
                <button id="remove-alert" data-option="colour" ${r?"":"disabled"}>${w.enabled?"Disable Alert":r?"Remove Custom Settings":"Using Defaults"}</button>
            </div>
            <div class="feedback-message" style="display: none;"></div></div>`;const i=B.alertModalBody.querySelector(".alert-settings-form");i?.querySelector("#alert-colour-enabled")?.addEventListener("change",Q.handleModalEnableToggle),i?.querySelector("#save-alert")?.addEventListener("click",Q.handleModalSave),i?.querySelector("#preview-alert")?.addEventListener("click",Q.handleModalPreview),i?.querySelector("#remove-alert")?.addEventListener("click",Q.handleModalRemove),Q.updateModalControlsState(i,w.enabled,r)},handleModalEnableToggle:function(p){const v=p.target.closest(".alert-settings-form"),m=p.target.checked,w=parseInt(v.dataset.index,10);Q.updateModalControlsState(v,m,!!y.alerts[w]?.colour)},updateModalControlsState:function(p,v,m){if(!p)return;const w=p.querySelectorAll('input[type="color"], input[type="number"]'),a=p.querySelector("#preview-alert"),e=p.querySelector("#remove-alert");w.forEach(n=>n.disabled=!v),a&&(a.disabled=!v),e&&(e.disabled=!m,e.textContent=v?"Disable Alert":m?"Remove Custom Settings":"Using Defaults")},handleModalSave:function(){const p=this.closest(".alert-settings-form");if(!p)return;const v=parseInt(p.dataset.index,10);if(isNaN(v))return;const m=p.querySelector("#alert-colour-enabled"),w=p.querySelector("#alert-flash-duration-sec"),a=p.querySelector("#alert-flash-interval"),e=p.querySelector("#alert-bg-color"),n=p.querySelector("#alert-label-color");if(p.querySelector(".feedback-message"),!m||!w||!a||!e||!n){console.error("Modal form elements not found for saving.");return}y.alerts[v]||(y.alerts[v]={});const r=y.defaultPreferences?.defaultAlertSettings?.colour||{},i=r.durationMs||1500,f=r.intervalMs||500;let c=parseFloat(w.value);c=isNaN(c)?i/1e3:Math.max(.5,Math.min(10,c));let d=parseInt(a.value,10);d=isNaN(d)?f:Math.max(100,Math.min(2e3,d));let l={enabled:m.checked,background:e.value||r.background||"#ff0000",text:n.value||r.text||"#ffffff",durationMs:Math.round(c*1e3),intervalMs:d};y.alerts[v].colour=l,y.save(),G.renderTable(),q.showButtonFeedback(this,"Saved!"),setTimeout(Q.closeModal,1600)},handleModalPreview:function(){const p=this.closest(".alert-settings-form");if(!p)return;const v=p.querySelector("#alert-colour-enabled"),m=p.querySelector(".feedback-message");if(!v||!v.checked){q.showFeedback(m,"Enable the alert first to preview.",!1);return}const w=parseFloat(p.querySelector("#alert-flash-duration-sec")?.value),a=parseInt(p.querySelector("#alert-flash-interval")?.value,10);if(isNaN(w)||isNaN(a)){q.showFeedback(m,"Invalid duration or interval value.",!1);return}let e={enabled:!0,background:p.querySelector("#alert-bg-color")?.value||"#ff0000",text:p.querySelector("#alert-label-color")?.value||"#ffffff",durationMs:Math.round(w*1e3),intervalMs:a};Q.triggerVisualAlert(e),q.showFeedback(m,"Previewing flash...",!0)},handleModalRemove:function(){const p=this.closest(".alert-settings-form");if(!p)return;const v=parseInt(p.dataset.index,10),m=p.querySelector("#alert-colour-enabled"),w=p.querySelector(".feedback-message");isNaN(v)||v>=y.schedule.length||(y.alerts[v]?.colour?m.checked?(m.checked=!1,Q.updateModalControlsState(p,!1,!0),q.showFeedback(w,"Alert disabled. Click Save to confirm.",!0)):confirm(`Remove custom visual alert settings for "${y.schedule[v].label}"? It will revert to defaults.`)&&(delete y.alerts[v].colour,Object.keys(y.alerts[v]).length===0&&delete y.alerts[v],y.save(),G.renderTable(),Q.closeModal()):(q.showFeedback(w,"No custom settings to remove. Using defaults.",!0),this&&(this.disabled=!0,this.textContent="Using Defaults")))},triggerVisualAlert:function(p){Q.clearVisualAlert();const{background:v,text:m,durationMs:w,intervalMs:a}=p,e=y.getActiveColourScheme();k.originalBodyStyles={background:document.body.style.backgroundColor,color:document.body.style.color,timeColor:B.timeEl?.style.color||"",dateColor:B.dateEl?.style.color||"",labelColor:B.periodLabelEl?.style.color||"",progressColor:B.progressEl?.style.backgroundColor||"",timeLeftColor:B.timeLeftEl?.style.color||""};let n=!1;const r=()=>{n=!n;const i=n?v:e.background,f=n?m:e.text;document.body.style.backgroundColor=i,document.body.style.color=f,B.timeEl&&y.preferences.showTime&&(B.timeEl.style.color=f),B.dateEl&&y.preferences.showDate&&(B.dateEl.style.color=f),B.periodLabelEl&&y.preferences.showScheduleLabel&&(B.periodLabelEl.style.color=f),B.progressEl&&y.preferences.showProgressBar&&!y.preferences.showSandBars&&!y.preferences.showWaterFill&&(B.progressEl.style.backgroundColor=f),B.timeLeftEl&&y.preferences.showProgressBar&&!y.preferences.showSandBars&&!y.preferences.showWaterFill&&(B.timeLeftEl.style.color=f),B.scheduleCirclesDisplayEl&&y.preferences.showScheduleCircles&&B.scheduleCirclesDisplayEl.querySelectorAll(".schedule-circle-symbol.active").forEach(c=>c.style.color=f)};r(),k.activeVisualAlertInterval=setInterval(r,a),k.activeVisualAlertTimeout=setTimeout(()=>{Q.clearVisualAlert(),Q.restoreOriginalStyles(e)},w)},clearVisualAlert:function(){clearTimeout(k.activeVisualAlertTimeout),clearInterval(k.activeVisualAlertInterval),k.activeVisualAlertInterval=null,k.activeVisualAlertTimeout=null},restoreOriginalStyles:function(p=null){const v=p||y.getActiveColourScheme();document.body.style.backgroundColor=v.background,document.body.style.color=v.text,B.timeEl&&y.preferences.showTime&&(B.timeEl.style.color=v.text),B.dateEl&&y.preferences.showDate&&(B.dateEl.style.color=v.text),B.periodLabelEl&&y.preferences.showScheduleLabel&&(B.periodLabelEl.style.color=v.text),B.progressEl&&y.preferences.showProgressBar&&!y.preferences.showSandBars&&!y.preferences.showWaterFill&&(B.progressEl.style.backgroundColor=v.text),B.timeLeftEl&&y.preferences.showProgressBar&&!y.preferences.showSandBars&&!y.preferences.showWaterFill&&(B.timeLeftEl.style.color=v.text),y.preferences.showScheduleCircles&&z.renderScheduleCircles()}},V={updateIntervalId:null,start:function(){V.updateIntervalId&&clearInterval(V.updateIntervalId),V.updateIntervalId=setInterval(V.update,1e3),V.update(),console.log("Clock started.")},stop:function(){V.updateIntervalId&&(clearInterval(V.updateIntervalId),V.updateIntervalId=null,console.log("Clock stopped."))},getCurrentPeriodInfo:function(p){if(!y.schedule||y.schedule.length===0)return null;for(let v=0;v<y.schedule.length;v++){const m=y.schedule[v];if(!(!m||typeof m.start!="string"||typeof m.end!="string"))try{const w=q.getTodayTime(m.start),a=q.getTodayTime(m.end);let e=new Date(a.getTime()),n=!1;a.getTime()<=w.getTime()&&(n=!0,a.getHours()===0&&a.getMinutes()===0&&a.getSeconds()===0?(e=q.getTodayTime(m.start),e.setDate(e.getDate()+1),e.setHours(0,0,0,0)):e.setDate(e.getDate()+1));let r=!1;if(n){const i=new Date(w);i.setHours(24,0,0,0);const f=new Date(w);f.setDate(f.getDate()+1),f.setHours(0,0,0,0),(p>=w&&p<i||p>=f&&p<e)&&(r=!0)}else p>=w&&p<e&&(r=!0);if(!r&&(m.end==="23:59"||m.end==="23:59:59")){const i=new Date(w);i.setHours(23,59,59,999),p>=w&&p<=i&&(r=!0,e=i)}if(r)return{label:m.label,start:w,end:e,index:v}}catch(w){console.error("Error processing period:",m?.label,m?.start,m?.end,w)}}return null},update:function(){if(!y||!ie||!Q||!z||!k||!B){console.error("Core modules not available in Clock.update");return}const p=se(),v=y.getActiveColourScheme();ie.update(),k.activeVisualAlertInterval||Q.restoreOriginalStyles(v),y.preferences.showTime&&B.timeEl&&(B.timeEl.textContent=q.formatTime(p)),y.preferences.showDate&&B.dateEl&&(B.dateEl.textContent=q.formatDate(p)),z.update(p);const m=V.getCurrentPeriodInfo(p),w=m?m.index:null;w!==k.currentPeriodIndex&&(k.currentPeriodLabel=m?m.label:null,k.currentPeriodIndex=w,m&&y.alerts[m.index]?.colour?.enabled?Q.triggerVisualAlert(y.alerts[m.index].colour):k.activeVisualAlertInterval&&(Q.clearVisualAlert(),Q.restoreOriginalStyles()),z.handlePeriodChange(m)),V.updatePeriodDisplay(p,m)},updatePeriodDisplay:function(p,v){if(B.periodLabelEl)if(v)if(y.preferences.showScheduleLabel?B.periodLabelEl.textContent=v.label:B.periodLabelEl.textContent="",y.preferences.showProgressBar&&!y.preferences.showSandBars&&!y.preferences.showWaterFill){if(B.progressEl&&B.progressBarEl&&B.timeLeftEl){const m=v.start.getTime(),w=v.end.getTime(),a=p.getTime(),e=w-m,n=Math.max(0,a-m);if(e>0){const r=Math.min(100,Math.max(0,n/e*100));B.progressEl.style.width=r+"%";const i=B.progressBarEl.offsetWidth,f=B.timeLeftEl.offsetWidth>0?B.timeLeftEl.offsetWidth:60;let c=r/100*i-f/2;c=Math.max(0,Math.min(i-f,c)),B.timeLeftEl.style.left=c+"px";const d=Math.max(0,w-a),l=Math.floor(d/1e3),t=Math.floor(l/60),s=l%60;B.timeLeftEl.textContent=`${t}:${s<10?"0"+s:s}`}else{B.progressEl.style.width=a>=m?"100%":"0%",B.timeLeftEl.textContent="0:00";const r=B.progressBarEl.offsetWidth,i=B.timeLeftEl.offsetWidth>0?B.timeLeftEl.offsetWidth:60;B.timeLeftEl.style.left=`${r-i}px`}}}else B.progressEl&&(B.progressEl.style.width="0%"),B.timeLeftEl&&(B.timeLeftEl.textContent="");else B.periodLabelEl&&(B.periodLabelEl.textContent=""),B.progressEl&&y.preferences.showProgressBar&&(B.progressEl.style.width="0%"),B.timeLeftEl&&y.preferences.showProgressBar&&(B.timeLeftEl.textContent="")}},Re=new Set(["Atkinson Hyperlegible Next","Arial","Helvetica","Times New Roman","Courier New","Verdana","Tahoma","Trebuchet MS","Georgia","Palatino","Garamond","Comic Sans MS","Impact","Lucida Console","Digital-7","OCR A Std","Monaco"]),y={schedule:[{label:"Before",start:"00:00",end:"08:50",colourSchemeId:1,showCircles:!1},{label:"Period 1",start:"08:50",end:"10:05",colourSchemeId:1,showCircles:!0},{label:"Break",start:"10:05",end:"10:15",colourSchemeId:2,showCircles:!1},{label:"Period 2",start:"10:15",end:"11:30",colourSchemeId:1,showCircles:!0},{label:"Lunch",start:"11:30",end:"12:20",colourSchemeId:2,showCircles:!1},{label:"Period 3",start:"12:20",end:"13:35",colourSchemeId:1,showCircles:!0},{label:"Break",start:"13:35",end:"13:45",colourSchemeId:2,showCircles:!1},{label:"Period 4",start:"13:45",end:"15:00",colourSchemeId:1,showCircles:!0},{label:"After",start:"15:00",end:"23:59",colourSchemeId:1,showCircles:!1}],preferences:{},alerts:{},defaultPreferences:{fontFamily:"Atkinson Hyperlegible Next",dateFontSize:64,timeFontSize:200,scheduleLabelFontSize:48,timeLeftFontSize:40,progressBarHeight:120,timeOffsetMs:0,showDate:!0,showTime:!0,showScheduleLabel:!0,showProgressBar:!0,showScheduleCircles:!1,showSandBars:!1,showWaterFill:!1,sandWidth:80,sandHeight:150,sandParticleSize:5,colourSchemes:[{id:1,name:"Default Dark",background:"#000000",text:"#FFFFFF"},{id:2,name:"Default Light",background:"#F0F0F0",text:"#000000"}],defaultAlertSettings:{colour:{enabled:!1,background:"#ff0000",text:"#ffffff",durationMs:1500,intervalMs:500}}},load:function(){y.preferences=JSON.parse(JSON.stringify(y.defaultPreferences));const p=JSON.parse(JSON.stringify(y.schedule));y.alerts={};const v=localStorage.getItem("clockSchedule");let m=!1;if(v)try{const e=JSON.parse(v);Array.isArray(e)&&e.length>0&&(y.schedule=e.map(n=>({label:n.label||"Unnamed",start:n.start||"00:00",end:n.end||"00:00",colourSchemeId:n.colourSchemeId||1,showCircles:typeof n.showCircles=="boolean"?n.showCircles:!1})),m=!0)}catch(e){console.error("Error parsing saved schedule.",e)}m||(y.schedule=p);const w=localStorage.getItem("clockPreferences");if(w)try{const e=JSON.parse(w);if(typeof e=="object"&&e!==null){const n={...JSON.parse(JSON.stringify(y.defaultPreferences)),...e,defaultAlertSettings:{colour:{...y.defaultPreferences.defaultAlertSettings.colour,...e.defaultAlertSettings?.colour||{}}},colourSchemes:e.colourSchemes&&Array.isArray(e.colourSchemes)&&e.colourSchemes.length>0?e.colourSchemes.map(r=>({id:r.id||Date.now()+Math.random(),name:r.name||"Unnamed Scheme",background:r.background||"#000000",text:r.text||"#FFFFFF"})):y.defaultPreferences.colourSchemes};for(const r of["showDate","showTime","showScheduleLabel","showProgressBar","showScheduleCircles","showSandBars","showWaterFill"])typeof n[r]!="boolean"&&(n[r]=y.defaultPreferences[r]);for(const r of["dateFontSize","timeFontSize","scheduleLabelFontSize","timeLeftFontSize","progressBarHeight","sandWidth","sandHeight","sandParticleSize"])n[r]=Number(n[r])||y.defaultPreferences[r];n.timeOffsetMs=Number(n.timeOffsetMs)||0,n.fontFamily==="Atkinson Hyperlegible"&&(n.fontFamily="Atkinson Hyperlegible Next"),Re.has(n.fontFamily)||(n.fontFamily=y.defaultPreferences.fontFamily),n.showSandBars&&n.showWaterFill&&(n.showWaterFill=!1),n.showProgressBar&&(n.showSandBars||n.showWaterFill)&&(n.showProgressBar=!1),n.sandWidth=Math.max(10,Math.min(100,n.sandWidth)),n.sandHeight=Math.max(50,Math.min(800,n.sandHeight)),n.sandParticleSize=Math.max(1,Math.min(20,n.sandParticleSize)),y.preferences=n}}catch(e){console.error("Error parsing saved preferences.",e)}const a=localStorage.getItem("clockAlerts");if(a)try{const e=JSON.parse(a);typeof e=="object"&&e!==null&&(y.alerts=e,Object.keys(y.alerts).forEach(n=>{y.alerts[n]?.noise&&delete y.alerts[n].noise,y.alerts[n]&&typeof y.alerts[n]=="object"&&Object.keys(y.alerts[n]).length===0&&delete y.alerts[n]}))}catch(e){console.error("Error parsing saved alerts settings.",e)}console.log("Settings loaded")},save:function(){try{y.preferences.hasOwnProperty("sandDropInterval")&&delete y.preferences.sandDropInterval;const p={};Object.keys(y.alerts).forEach(m=>{y.alerts[m]&&typeof y.alerts[m]=="object"&&Object.keys(y.alerts[m]).length>0&&(p[m]=y.alerts[m])});const v=y.schedule.map(m=>({label:m.label,start:m.start,end:m.end,colourSchemeId:m.colourSchemeId,showCircles:m.showCircles}));localStorage.setItem("clockSchedule",JSON.stringify(v)),localStorage.setItem("clockPreferences",JSON.stringify(y.preferences)),localStorage.setItem("clockAlerts",JSON.stringify(p))}catch(p){console.error("Error saving settings:",p)}},getActiveColourScheme:function(){const p=se(),v=typeof V<"u"?V.getCurrentPeriodInfo(p):null;let m=1;if(v&&v.index!==void 0&&y.schedule[v.index]){const e=y.schedule[v.index];e.colourSchemeId&&(m=e.colourSchemeId)}const w=y.preferences?.colourSchemes||y.defaultPreferences.colourSchemes;let a=w.find(e=>e.id===m);return a||(a=w.find(e=>e.id===1)),a||(a=w[0]),a||{id:0,name:"Error",background:"#ff00ff",text:"#000000"}}},te={attachListeners:function(){B.colorSchemeContentContainer?.addEventListener("click",te.handleContentClick),B.colorSchemeContentContainer?.addEventListener("input",te.handleContentInput)},renderTabs:function(){const p=B.colorSchemeTabsContainer,v=B.colorSchemeContentContainer;if(!p||!v)return;p.innerHTML="",(y.preferences?.colourSchemes||[]).forEach((e,n)=>{const r=document.createElement("button");r.className="colour-tab",r.textContent=e.name||`Scheme ${e.id}`,r.dataset.id=e.id,r.dataset.index=n,r.addEventListener("click",function(){p.querySelectorAll(".colour-tab.active").forEach(i=>i.classList.remove("active")),this.classList.add("active"),te.renderContent(n)}),p.appendChild(r)});const w=document.createElement("button");w.className="colour-tab add-colour",w.textContent="+",w.title="Add New Colour Scheme",w.addEventListener("click",te.addScheme),p.appendChild(w);const a=p.querySelector(".colour-tab:not(.add-colour)");a?a.click():v.innerHTML="<p>No colour schemes defined. Click '+' to add one.</p>"},renderContent:function(p){const v=B.colorSchemeContentContainer,m=y.preferences?.colourSchemes||[];if(!v||p<0||p>=m.length)return;const w=m[p];if(!w)return;const a=m.length>1&&w.id!==1&&w.id!==2,e=`
            <button
                id="delete-scheme-${p}"
                data-index="${p}"
                ${a?"":'disabled title="Cannot delete default schemes or the last remaining scheme"'}>
                Delete Scheme
            </button>`;v.innerHTML=`
          <div class="colour-scheme-form">
            <label>Scheme Name: <input type="text" id="scheme-name-${p}" value="${w.name||""}"></label>
            <label>Background Colour: <input type="color" id="scheme-bg-color-${p}" value="${w.background||"#000000"}"></label>
            <label>Main Text Colour (Date, Time, Label, Progress, Active Circles): <input type="color" id="scheme-text-color-${p}" value="${w.text||"#ffffff"}"></label>
            <button id="save-scheme-settings-${p}" data-index="${p}">Save Scheme</button>
            ${a?e:""}
             <div class="feedback-message" style="display: none;"></div>
           </div>`},handleContentInput:function(p){const v=p.target,m=v.closest(".colour-scheme-form");if(!m||!v.id||!(v.id.startsWith("scheme-name")||v.id.startsWith("scheme-bg-color")||v.id.startsWith("scheme-text-color")))return;const w=m.querySelector('button[id^="save-scheme-settings"]');if(!w)return;const a=parseInt(w.dataset.index,10);if(!isNaN(a)&&a>=0&&a<y.preferences.colourSchemes.length){const e=y.preferences.colourSchemes[a];v.id.startsWith("scheme-name")&&(e.name=v.value),v.id.startsWith("scheme-bg-color")&&(e.background=v.value),v.id.startsWith("scheme-text-color")&&(e.text=v.value);const n=B.colorSchemeTabsContainer?.querySelector(`.colour-tab[data-index="${a}"]`);n&&v.id.startsWith("scheme-name")&&(n.textContent=v.value||`Scheme ${e.id}`),V.update()}},handleContentClick:function(p){const v=p.target;if(v.tagName!=="BUTTON"||!v.id||!v.closest(".colour-scheme-form"))return;const m=parseInt(v.dataset.index,10);if(v.closest(".colour-scheme-form")?.querySelector(".feedback-message"),!isNaN(m))if(v.id.startsWith("save-scheme-settings")){y.save(),q.showButtonFeedback(v,"Saved!");const w=B.colorSchemeTabsContainer?.querySelector(`.colour-tab[data-index="${m}"]`);w&&!w.classList.contains("active")&&(B.colorSchemeTabsContainer?.querySelectorAll(".colour-tab.active").forEach(a=>a.classList.remove("active")),w.classList.add("active"))}else v.id.startsWith("delete-scheme")&&te.deleteScheme(m,v)},addScheme:function(){const p=(y.preferences.colourSchemes.reduce((w,a)=>Math.max(w,a.id||0),0)||0)+1,v={id:p,name:"New Scheme "+p,background:"#222222",text:"#EEEEEE"};y.preferences.colourSchemes.push(v),y.save(),te.renderTabs(),B.colorSchemeTabsContainer?.querySelector(`.colour-tab[data-id="${p}"]`)?.click()},deleteScheme:function(p,v){const m=y.preferences.colourSchemes;if(p<0||p>=m.length)return;const w=m[p];if(m.length>1&&w.id!==1&&w.id!==2){if(confirm(`Delete scheme "${w.name||`Scheme ${p+1}`}"? Periods using it will revert to Scheme 1.`)){const e=w.id;m.splice(p,1),y.schedule.forEach(n=>{n.colourSchemeId===e&&(n.colourSchemeId=1)}),y.save(),G.renderTable(),te.renderTabs(),V.update()}}else alert("Cannot delete default schemes or the last remaining scheme.")},resetDefaults:function(){confirm("Reset ALL Colour Schemes to the defaults? This cannot be undone.")&&(y.preferences.colourSchemes=JSON.parse(JSON.stringify(y.defaultPreferences.colourSchemes)),y.schedule.forEach(p=>p.colourSchemeId=1),y.save(),G.renderTable(),te.renderTabs(),V.update(),q.showButtonFeedback(B.resetSchemesBtn,"Reset!"))}},oe={attachListeners:function(){B.fontSelect?.addEventListener("input",function(){y.preferences&&(y.preferences.fontFamily=this.value,ie.applyFontAndSizePreferences(),y.save())}),document.querySelectorAll(".number-input-wrapper").forEach(p=>{const v=p.querySelector('input[type="number"]'),m=p.querySelector(".num-btn.minus"),w=p.querySelector(".num-btn.plus");if(!v||!v.dataset||!v.dataset.pref||!m||!w)return;const a=v.dataset.pref;let e=null,n=null;const r=500,i=100;if(!y.preferences||!y.defaultPreferences||!y.preferences.hasOwnProperty(a)){console.warn(`Preference key "${a}" not found in settings for input ${v.id}`);return}const f=t=>{if(!y.preferences.hasOwnProperty(a))return;parseInt(v.step);const s=v.min?parseInt(v.min,10):-1/0,o=v.max?parseInt(v.max,10):1/0;let u=parseInt(t,10);u=isNaN(u)?y.defaultPreferences[a]:Math.max(s,Math.min(o,u)),y.preferences[a]!==u&&(y.preferences[a]=u,v.value=u,ie.applyFontAndSizePreferences(),["sandWidth","sandHeight","sandParticleSize"].includes(a)&&(console.log(`Physics fill pref changed (${a}), triggering physics setup...`),requestAnimationFrame(()=>{z.handleDisplayToggle()})),y.save())},c=t=>{f(parseInt(v.value,10)+t),d(),n=setTimeout(()=>{e=setInterval(()=>{f(parseInt(v.value,10)+t)},i)},r)},d=()=>{clearTimeout(n),clearInterval(e),n=e=null};v.addEventListener("change",()=>f(v.value)),m.addEventListener("mousedown",()=>c(-(parseInt(v.step)||1))),w.addEventListener("mousedown",()=>c(parseInt(v.step)||1)),["mouseup","mouseleave","blur","touchend","touchcancel"].forEach(t=>{m.addEventListener(t,d),w.addEventListener(t,d)})}),B.displayElementsChecklist?.querySelectorAll('input[type="checkbox"]').forEach(p=>{p.addEventListener("change",oe.handleDisplayToggleChange)}),B.resetAppearanceBtn?.addEventListener("click",oe.resetFontAndSizeDefaults),B.resetSchemesBtn?.addEventListener("click",te.resetDefaults),document.getElementById("reset-sandbar-defaults")?.addEventListener("click",oe.resetSandBarDefaults)},handleDisplayToggleChange:function(){const p=this.dataset.pref;if(!p||!y.preferences||!y.preferences.hasOwnProperty(p))return;y.preferences[p]=this.checked;const v=B.displayElementsChecklist?.querySelector("#pref-show-progress-bar"),m=B.displayElementsChecklist?.querySelector("#pref-show-sand-bars"),w=B.displayElementsChecklist?.querySelector("#pref-show-water-fill"),a=()=>{y.preferences.showProgressBar&&(y.preferences.showProgressBar=!1,v&&(v.checked=!1))},e=()=>{y.preferences.showSandBars&&(y.preferences.showSandBars=!1,m&&(m.checked=!1))},n=()=>{y.preferences.showWaterFill&&(y.preferences.showWaterFill=!1,w&&(w.checked=!1))};p==="showSandBars"&&this.checked?(a(),n()):p==="showWaterFill"&&this.checked?(a(),e()):p==="showProgressBar"&&this.checked&&(e(),n()),document.getElementById("sand-bar-options")?.classList.toggle("element-hidden",!(y.preferences.showSandBars||y.preferences.showWaterFill)),ie.update(),z.handleDisplayToggle(),y.save()},updateInputs:function(){if(!y.preferences)return;B.fontSelect&&(B.fontSelect.value=y.preferences.fontFamily),B.dateFontSizeInput&&(B.dateFontSizeInput.value=y.preferences.dateFontSize),B.timeFontSizeInput&&(B.timeFontSizeInput.value=y.preferences.timeFontSize),B.labelFontSizeInput&&(B.labelFontSizeInput.value=y.preferences.scheduleLabelFontSize),B.timeLeftFontSizeInput&&(B.timeLeftFontSizeInput.value=y.preferences.timeLeftFontSize),B.progressHeightInput&&(B.progressHeightInput.value=y.preferences.progressBarHeight),B.displayElementsChecklist?.querySelectorAll('input[type="checkbox"]').forEach(v=>{const m=v.dataset.pref;m&&y.preferences.hasOwnProperty(m)&&(v.checked=y.preferences[m])});const p=document.getElementById("sand-bar-options");if(p){p.classList.toggle("element-hidden",!(y.preferences.showSandBars||y.preferences.showWaterFill));const v=p.querySelector("#pref-sand-width"),m=p.querySelector("#pref-sand-height"),w=p.querySelector("#pref-sand-particle-size");v&&(v.value=y.preferences.sandWidth),m&&(m.value=y.preferences.sandHeight),w&&(w.value=y.preferences.sandParticleSize)}},resetFontAndSizeDefaults:function(){if(confirm("Reset Font & Size settings to defaults?")){if(!y.preferences||!y.defaultPreferences)return;y.preferences.fontFamily=y.defaultPreferences.fontFamily,y.preferences.dateFontSize=y.defaultPreferences.dateFontSize,y.preferences.timeFontSize=y.defaultPreferences.timeFontSize,y.preferences.scheduleLabelFontSize=y.defaultPreferences.scheduleLabelFontSize,y.preferences.timeLeftFontSize=y.defaultPreferences.timeLeftFontSize,y.preferences.progressBarHeight=y.defaultPreferences.progressBarHeight,oe.updateInputs(),ie.applyFontAndSizePreferences(),y.save(),q.showButtonFeedback(B.resetAppearanceBtn,"Reset!")}},resetSandBarDefaults:function(){if(confirm("Reset Physics Fill settings to defaults?")){if(!y.preferences||!y.defaultPreferences)return;y.preferences.sandWidth=y.defaultPreferences.sandWidth,y.preferences.sandHeight=y.defaultPreferences.sandHeight,y.preferences.sandParticleSize=y.defaultPreferences.sandParticleSize,oe.updateInputs(),(y.preferences.showSandBars||y.preferences.showWaterFill)&&requestAnimationFrame(()=>{z.handleDisplayToggle()}),y.save(),q.showButtonFeedback(document.getElementById("reset-sandbar-defaults"),"Reset!")}}},_={attachListeners:function(){B.syncToBellBtn?.addEventListener("click",_.syncToNearestBell),B.resetOffsetBtn?.addEventListener("click",_.resetOffset),_.addManualOffsetListener(B.offsetMinDownBtn,-6e4),_.addManualOffsetListener(B.offsetMinUpBtn,6e4),_.addManualOffsetListener(B.offsetSecDownBtn,-1e3),_.addManualOffsetListener(B.offsetSecUpBtn,1e3)},addManualOffsetListener:function(p,v){p&&p.addEventListener("click",()=>_.adjustOffset(v))},adjustOffset:function(p){typeof y.preferences.timeOffsetMs!="number"&&(y.preferences.timeOffsetMs=0),y.preferences.timeOffsetMs+=p,_.updateOffsetDisplay(),V.update(),y.save()},resetOffset:function(){y.preferences.timeOffsetMs!==0?(y.preferences.timeOffsetMs=0,_.updateOffsetDisplay(),V.update(),y.save(),q.showButtonFeedback(B.resetOffsetBtn,"Offset Reset!",1500)):q.showButtonFeedback(B.resetOffsetBtn,"Already Zero!",1e3)},syncToNearestBell:function(){if(!y.schedule||y.schedule.length===0){q.showButtonFeedback(B.syncToBellBtn,"Add Schedule First!",2e3);return}const v=new Date().getTime();let m=1/0,w=null;if(y.schedule.forEach(a=>{if(!(!a||!a.start||!a.end||!/^\d{2}:\d{2}$/.test(a.start)||!/^\d{2}:\d{2}$/.test(a.end)))try{const e=q.getTodayTime(a.start),n=q.getTodayTime(a.end),r=e.getTime(),i=n.getTime();let f=Math.abs(r-v);if(f<m&&(m=f,w=e),!y.schedule.some(d=>d.start===a.end)){let d=Math.abs(i-v);d<m&&(m=d,w=n)}}catch(e){console.error("Sync error parsing time for period:",a.label,e)}}),w!==null){const a=w.getTime()-v;y.preferences.timeOffsetMs=a,_.updateOffsetDisplay(),V.update(),y.save(),q.showButtonFeedback(B.syncToBellBtn,"Synced!")}else q.showButtonFeedback(B.syncToBellBtn,"No Valid Times!",2e3)},updateOffsetDisplay:function(){const p=Number(y.preferences?.timeOffsetMs)||0,v=Math.round(p/1e3),m=v>=0?"+":"-",w=Math.abs(v),a=Math.floor(w/60),e=w%60,n=e<10?"0"+e:e,r=`${m}${a}m ${n}s`;B.currentOffsetDisplay&&(B.currentOffsetDisplay.textContent=r)}},ae={init:function(){console.log("Classroom Clock Initializing..."),Ae(),y.load(),oe.updateInputs(),te.renderTabs(),G.renderTable(),_.updateOffsetDisplay(),oe.attachListeners(),te.attachListeners(),G.attachListeners(),Q.attachListeners(),_.attachListeners(),ae.attachGlobalListeners(),ie.update(),z.handleDisplayToggle(),V.start(),console.log("Classroom Clock Initialized.")},attachGlobalListeners:function(){B.menuToggle?.addEventListener("click",()=>{const p=B.settingsMenu?.classList.toggle("open");B.menuToggle&&(B.menuToggle.innerHTML=p?"â–²":"â–¼")}),B.menuResizer?.addEventListener("mousedown",ae.handleResizeMouseDown),document.addEventListener("mousemove",ae.handleResizeMouseMove),document.addEventListener("mouseup",ae.handleResizeMouseUp),document.addEventListener("mouseleave",ae.handleResizeMouseUp),B.tabsContainer?.querySelectorAll(".tab-button").forEach(p=>{p.addEventListener("click",ae.handleTabClick)})},handleTabClick:function(){if(!B.tabsContainer||!B.tabContentsContainer)return;B.tabsContainer.querySelectorAll(".tab-button.active").forEach(v=>v.classList.remove("active")),B.tabContentsContainer.querySelectorAll(".tab-content.active").forEach(v=>v.classList.remove("active")),this.classList.add("active");const p=this.getAttribute("data-tab");if(p){const v=B.tabContentsContainer.querySelector(`#${p}`);v&&v.classList.add("active")}},handleResizeMouseDown:function(p){k.isResizingMenu=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none",document.body.style.setProperty("-webkit-user-select","none")},handleResizeMouseMove:function(p){if(!k.isResizingMenu||!B.settingsMenu)return;const v=window.innerWidth-p.clientX,m=400,w=Math.min(950,window.innerWidth-50);v>=m&&v<=w&&(B.settingsMenu.style.width=v+"px")},handleResizeMouseUp:function(p){k.isResizingMenu&&(k.isResizingMenu=!1,document.body.style.cursor="default",document.body.style.userSelect="",document.body.style.removeProperty("-webkit-user-select"))}};document.addEventListener("DOMContentLoaded",ae.init);
